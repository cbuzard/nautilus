<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>&lt;a href= http://code.google.com/p/nautilus/&gt;Nautilus&lt;/a&gt;: structure.f90 Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname"><a href= http://code.google.com/p/nautilus/>Nautilus</a></div>
   <div id="projectbrief">1D gas-grain chemical model</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Types&#160;List</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">structure.f90</div>  </div>
</div>
<div class="contents">
<a href="structure_8f90.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">!******************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">! MODULE: structure</span>
<a name="l00003"></a>00003 <span class="comment">!******************************************************************************</span>
<a name="l00004"></a>00004 <span class="comment">!</span>
<a name="l00005"></a>00005 <span class="comment">! DESCRIPTION: </span>
<a name="l00010"></a>00010 
<a name="l00011"></a><a class="code" href="namespacestructure.html">00011</a> <span class="keyword">module</span> structure
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 use <span class="keywordflow">iso_fortran_env</span>
<a name="l00014"></a>00014 use <span class="keywordflow">numerical_types</span>
<a name="l00015"></a>00015 use <span class="keywordflow">global_variables</span>
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="keyword">implicit none</span>
<a name="l00018"></a>00018 
<a name="l00019"></a><a class="code" href="namespacestructure.html#a0a6f3812a191d58bf36836aac8545aab">00019</a> <span class="keywordtype">integer</span> :: structure_sample <span class="comment">!&lt; the number of points from structure_evolution.dat, about the time evolution of the physical structure properties</span>
<a name="l00020"></a>00020 
<a name="l00021"></a><a class="code" href="namespacestructure.html#a28ecafa4dc5856385464cc7f20156d66">00021</a> <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:)</span> :: structure_time <span class="comment">!&lt; dim(structure_sample) time [s] read from structure_evolution.dat</span>
<a name="l00022"></a><a class="code" href="namespacestructure.html#aa42592d500338ebcba62b07d44ebce47">00022</a> <span class="keywordtype">real(double_precision)</span> :: structure_sample_step <span class="comment">!&lt; time [s] between each sample point for the structure evolution</span>
<a name="l00023"></a>00023 
<a name="l00024"></a><a class="code" href="namespacestructure.html#a9c1da5f8cbf8d5d1364d2f5641fc7f10">00024</a> <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:)</span> :: structure_log_Av <span class="comment">!&lt; dim(structure_sample) log10(Av) [log10(mag)] read from structure_evolution.dat</span>
<a name="l00025"></a><a class="code" href="namespacestructure.html#a9aa87ecf57c3b576ef4cb00fbb9fca09">00025</a> <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:)</span> :: structure_log_density <span class="comment">!&lt; dim(structure_sample) log10(density) [log10(part/cm^3)] read from structure_evolution.dat</span>
<a name="l00026"></a><a class="code" href="namespacestructure.html#ab09eece455197b263e74ef1c710604f3">00026</a> <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:)</span> :: structure_log_gas_temperature <span class="comment">!&lt; dim(structure_sample) log10(gas temperature) [log10(K)] read from structure_evolution.dat</span>
<a name="l00027"></a>00027 
<a name="l00028"></a><a class="code" href="namespacestructure.html#a199f75ebbad20e0c5594776ff4abe723">00028</a> <span class="keywordtype">logical</span> :: read_dust <span class="comment">!&lt; If dust temperature must be read directly from the data file (or not)</span>
<a name="l00029"></a><a class="code" href="namespacestructure.html#a14ff74561ceba26a8dbcd644f3c145dc">00029</a> <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:)</span> :: structure_log_dust_temperature <span class="comment">!&lt; dim(structure_sample) log10(dust temperature) [log10(K)] read from structure_evolution.dat</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="keyword">contains</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="comment">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<a name="l00051"></a><a class="code" href="namespacestructure.html#a1f638bbe1b4faaf8a48e2fe268982015">00051</a> <span class="keyword">subroutine </span><a class="code" href="namespacestructure.html#a1f638bbe1b4faaf8a48e2fe268982015">init_structure_evolution</a>()
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 use <span class="keywordflow">utilities</span>
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="keyword">implicit none</span>
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="keywordtype">character(len=80)</span> :: filename = <span class="stringliteral">&#39;structure_evolution.dat&#39;</span> <span class="comment">!&lt; name of the file in which time evolution is stored</span>
<a name="l00059"></a>00059 <span class="keywordtype">character(len=80)</span> :: line
<a name="l00060"></a>00060 <span class="keywordtype">character(len=1)</span>, <span class="keywordtype">parameter</span> :: comment_character = <span class="stringliteral">&#39;!&#39;</span> <span class="comment">!&lt; character that will indicate that the rest of the line is a comment</span>
<a name="l00061"></a>00061 <span class="keywordtype">integer</span> :: comment_position <span class="comment">!&lt; the index of the comment character on the line. if zero, there is none on the current string</span>
<a name="l00062"></a>00062 <span class="keywordtype">integer</span> :: error <span class="comment">!&lt; to store the state of a read instruction</span>
<a name="l00063"></a>00063 <span class="keywordtype">integer</span> :: nb_columns
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 <span class="keywordtype">integer</span> :: i <span class="comment">!&lt; loop index</span>
<a name="l00066"></a>00066 <span class="keywordtype">logical</span> :: isDefined
<a name="l00067"></a>00067 <span class="comment">!------------------------------------------------------------------------------</span>
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 <span class="keyword">inquire</span>(file=filename, exist=isDefined)
<a name="l00070"></a>00070 <span class="keyword">if</span> (isDefined) <span class="keyword">then</span>
<a name="l00071"></a>00071   
<a name="l00072"></a>00072   call <a class="code" href="namespaceutilities.html#aadbaa796071651209db7abd2c5dc004e">get_linenumber</a>(filename=filename, nb_lines=<a class="code" href="namespacestructure.html#a0a6f3812a191d58bf36836aac8545aab">structure_sample</a>)
<a name="l00073"></a>00073   nb_columns = <a class="code" href="namespaceutilities.html#a811b0dd252293960fa46375ff203a463">get_nb_columns</a>(filename)
<a name="l00074"></a>00074   
<a name="l00075"></a>00075   <span class="keyword">if</span> (nb_columns.ge.5) <span class="keyword">then</span>
<a name="l00076"></a>00076     <a class="code" href="namespacestructure.html#a199f75ebbad20e0c5594776ff4abe723">read_dust</a> = .true.
<a name="l00077"></a>00077   <span class="keyword">else</span>
<a name="l00078"></a>00078     <a class="code" href="namespacestructure.html#a199f75ebbad20e0c5594776ff4abe723">read_dust</a> = .false.
<a name="l00079"></a>00079   <span class="keyword">endif</span>
<a name="l00080"></a>00080   
<a name="l00081"></a>00081   <span class="comment">! If by any chance the routine is run several times, this test is here to avoid bugs</span>
<a name="l00082"></a>00082   <span class="keyword">if</span> (<span class="keyword">allocated</span>(<a class="code" href="namespacestructure.html#a28ecafa4dc5856385464cc7f20156d66">structure_time</a>)) <span class="keyword">then</span>
<a name="l00083"></a>00083     <span class="keyword">deallocate</span>(<a class="code" href="namespacestructure.html#a28ecafa4dc5856385464cc7f20156d66">structure_time</a>)
<a name="l00084"></a>00084     <span class="keyword">deallocate</span>(<a class="code" href="namespacestructure.html#a9aa87ecf57c3b576ef4cb00fbb9fca09">structure_log_density</a>)
<a name="l00085"></a>00085     <span class="keyword">deallocate</span>(<a class="code" href="namespacestructure.html#ab09eece455197b263e74ef1c710604f3">structure_log_gas_temperature</a>)
<a name="l00086"></a>00086     <span class="keyword">deallocate</span>(<a class="code" href="namespacestructure.html#a9c1da5f8cbf8d5d1364d2f5641fc7f10">structure_log_Av</a>)
<a name="l00087"></a>00087   <span class="keyword">end if</span>
<a name="l00088"></a>00088   <span class="keyword">allocate</span>(<a class="code" href="namespacestructure.html#a28ecafa4dc5856385464cc7f20156d66">structure_time</a>(<a class="code" href="namespacestructure.html#a0a6f3812a191d58bf36836aac8545aab">structure_sample</a>))
<a name="l00089"></a>00089   <span class="keyword">allocate</span>(<a class="code" href="namespacestructure.html#a9aa87ecf57c3b576ef4cb00fbb9fca09">structure_log_density</a>(<a class="code" href="namespacestructure.html#a0a6f3812a191d58bf36836aac8545aab">structure_sample</a>))
<a name="l00090"></a>00090   <span class="keyword">allocate</span>(<a class="code" href="namespacestructure.html#ab09eece455197b263e74ef1c710604f3">structure_log_gas_temperature</a>(<a class="code" href="namespacestructure.html#a0a6f3812a191d58bf36836aac8545aab">structure_sample</a>))
<a name="l00091"></a>00091   <span class="keyword">allocate</span>(<a class="code" href="namespacestructure.html#a9c1da5f8cbf8d5d1364d2f5641fc7f10">structure_log_Av</a>(<a class="code" href="namespacestructure.html#a0a6f3812a191d58bf36836aac8545aab">structure_sample</a>))
<a name="l00092"></a>00092   
<a name="l00093"></a>00093   
<a name="l00094"></a>00094   <a class="code" href="namespacestructure.html#a28ecafa4dc5856385464cc7f20156d66">structure_time</a>(1:<a class="code" href="namespacestructure.html#a0a6f3812a191d58bf36836aac8545aab">structure_sample</a>) = 0.d0
<a name="l00095"></a>00095   <a class="code" href="namespacestructure.html#a9aa87ecf57c3b576ef4cb00fbb9fca09">structure_log_density</a>(1:<a class="code" href="namespacestructure.html#a0a6f3812a191d58bf36836aac8545aab">structure_sample</a>) = 0.d0
<a name="l00096"></a>00096   <a class="code" href="namespacestructure.html#ab09eece455197b263e74ef1c710604f3">structure_log_gas_temperature</a>(1:<a class="code" href="namespacestructure.html#a0a6f3812a191d58bf36836aac8545aab">structure_sample</a>) = 0.d0
<a name="l00097"></a>00097   <a class="code" href="namespacestructure.html#a9c1da5f8cbf8d5d1364d2f5641fc7f10">structure_log_Av</a>(1:<a class="code" href="namespacestructure.html#a0a6f3812a191d58bf36836aac8545aab">structure_sample</a>) = 0.d0
<a name="l00098"></a>00098   
<a name="l00099"></a>00099   <span class="keyword">if</span> (<a class="code" href="namespacestructure.html#a199f75ebbad20e0c5594776ff4abe723">read_dust</a>) <span class="keyword">then</span>
<a name="l00100"></a>00100     <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a02c0cc712a2834b310910f905cd3ef42">GRAIN_TEMPERATURE_TYPE</a>.ne.<span class="stringliteral">&#39;table&#39;</span>) <span class="keyword">then</span>
<a name="l00101"></a>00101       <span class="keyword">write</span>(Error_unit, *) <span class="stringliteral">&#39;Error: The grain temperature column exist&#39;</span>
<a name="l00102"></a>00102       <span class="keyword">write</span>(Error_unit, *) <span class="stringliteral">&#39;in structure_evolution.dat but &#39;</span>
<a name="l00103"></a>00103       <span class="keyword">write</span>(Error_unit, *) <span class="stringliteral">&#39;GRAIN_TEMPERATURE_TYPE = &#39;</span>,trim(<a class="code" href="namespaceglobal__variables.html#a02c0cc712a2834b310910f905cd3ef42">GRAIN_TEMPERATURE_TYPE</a>)
<a name="l00104"></a>00104       call exit(10)
<a name="l00105"></a>00105     <span class="keyword">endif</span>
<a name="l00106"></a>00106     
<a name="l00107"></a>00107     <span class="keyword">if</span> (<span class="keyword">allocated</span>(<a class="code" href="namespacestructure.html#a14ff74561ceba26a8dbcd644f3c145dc">structure_log_dust_temperature</a>)) <span class="keyword">then</span>
<a name="l00108"></a>00108       <span class="keyword">deallocate</span>(<a class="code" href="namespacestructure.html#a14ff74561ceba26a8dbcd644f3c145dc">structure_log_dust_temperature</a>)
<a name="l00109"></a>00109     <span class="keyword">endif</span>
<a name="l00110"></a>00110     
<a name="l00111"></a>00111     <span class="keyword">allocate</span>(<a class="code" href="namespacestructure.html#a14ff74561ceba26a8dbcd644f3c145dc">structure_log_dust_temperature</a>(<a class="code" href="namespacestructure.html#a0a6f3812a191d58bf36836aac8545aab">structure_sample</a>))
<a name="l00112"></a>00112     <a class="code" href="namespacestructure.html#a14ff74561ceba26a8dbcd644f3c145dc">structure_log_dust_temperature</a>(1:<a class="code" href="namespacestructure.html#a0a6f3812a191d58bf36836aac8545aab">structure_sample</a>) = 0.d0
<a name="l00113"></a>00113   <span class="keyword">endif</span>
<a name="l00114"></a>00114   
<a name="l00115"></a>00115   <span class="keyword">open</span>(10, file=filename, status=<span class="stringliteral">&#39;old&#39;</span>)
<a name="l00116"></a>00116   i = 1
<a name="l00117"></a>00117   <span class="keyword">do</span> 
<a name="l00118"></a>00118     <span class="keyword">read</span>(10, <span class="stringliteral">&#39;(a)&#39;</span>, iostat=error) line
<a name="l00119"></a>00119     <span class="keyword">if</span> (error /= 0) exit
<a name="l00120"></a>00120       
<a name="l00121"></a>00121     <span class="comment">! We get only what is on the left of an eventual comment parameter</span>
<a name="l00122"></a>00122       comment_position = index(line, comment_character)
<a name="l00123"></a>00123     
<a name="l00124"></a>00124     <span class="comment">! if there are comments on the current line, we get rid of them</span>
<a name="l00125"></a>00125     <span class="keyword">if</span> (comment_position.ne.0) <span class="keyword">then</span>
<a name="l00126"></a>00126       line = line(1:comment_position - 1)
<a name="l00127"></a>00127     <span class="keyword">end if</span>
<a name="l00128"></a>00128     
<a name="l00129"></a>00129     <span class="keyword">if</span> (line.ne.<span class="stringliteral">&#39;&#39;</span>) <span class="keyword">then</span>
<a name="l00130"></a>00130       <span class="keyword">if</span> (<a class="code" href="namespacestructure.html#a199f75ebbad20e0c5594776ff4abe723">read_dust</a>) <span class="keyword">then</span>
<a name="l00131"></a>00131         <span class="keyword">read</span>(line, *) <a class="code" href="namespacestructure.html#a28ecafa4dc5856385464cc7f20156d66">structure_time</a>(i), <a class="code" href="namespacestructure.html#a9c1da5f8cbf8d5d1364d2f5641fc7f10">structure_log_Av</a>(i), <a class="code" href="namespacestructure.html#a9aa87ecf57c3b576ef4cb00fbb9fca09">structure_log_density</a>(i), <a class="code" href="namespacestructure.html#ab09eece455197b263e74ef1c710604f3">structure_log_gas_temperature</a>(i), &amp;
<a name="l00132"></a>00132                       <a class="code" href="namespacestructure.html#a14ff74561ceba26a8dbcd644f3c145dc">structure_log_dust_temperature</a>(i)
<a name="l00133"></a>00133       <span class="keyword">else</span>
<a name="l00134"></a>00134         <span class="keyword">read</span>(line, *) <a class="code" href="namespacestructure.html#a28ecafa4dc5856385464cc7f20156d66">structure_time</a>(i), <a class="code" href="namespacestructure.html#a9c1da5f8cbf8d5d1364d2f5641fc7f10">structure_log_Av</a>(i), <a class="code" href="namespacestructure.html#a9aa87ecf57c3b576ef4cb00fbb9fca09">structure_log_density</a>(i), <a class="code" href="namespacestructure.html#ab09eece455197b263e74ef1c710604f3">structure_log_gas_temperature</a>(i)
<a name="l00135"></a>00135       <span class="keyword">endif</span>
<a name="l00136"></a>00136       i = i + 1
<a name="l00137"></a>00137     <span class="keyword">endif</span>
<a name="l00138"></a>00138   <span class="keyword">enddo</span>
<a name="l00139"></a>00139   <span class="keyword">close</span>(10)
<a name="l00140"></a>00140   
<a name="l00141"></a>00141   <span class="comment">! We convert time in million year to time in seconds</span>
<a name="l00142"></a>00142   <a class="code" href="namespacestructure.html#a28ecafa4dc5856385464cc7f20156d66">structure_time</a>(1:<a class="code" href="namespacestructure.html#a0a6f3812a191d58bf36836aac8545aab">structure_sample</a>) = (1.d6 * <a class="code" href="namespaceglobal__variables.html#a8d10fc5e3e9e9679f1f0b9178c899387">YEAR</a>) * <a class="code" href="namespacestructure.html#a28ecafa4dc5856385464cc7f20156d66">structure_time</a>(1:<a class="code" href="namespacestructure.html#a0a6f3812a191d58bf36836aac8545aab">structure_sample</a>)
<a name="l00143"></a>00143   
<a name="l00144"></a>00144   <span class="comment">! We get the space between all times for the structure evolution. This has some sense only if times are linearly and equally spaced.</span>
<a name="l00145"></a>00145   <a class="code" href="namespacestructure.html#aa42592d500338ebcba62b07d44ebce47">structure_sample_step</a> = (<a class="code" href="namespacestructure.html#a28ecafa4dc5856385464cc7f20156d66">structure_time</a>(<a class="code" href="namespacestructure.html#a0a6f3812a191d58bf36836aac8545aab">structure_sample</a>) - <a class="code" href="namespacestructure.html#a28ecafa4dc5856385464cc7f20156d66">structure_time</a>(1)) / dfloat(<a class="code" href="namespacestructure.html#a0a6f3812a191d58bf36836aac8545aab">structure_sample</a> - 1)
<a name="l00146"></a>00146   
<a name="l00147"></a>00147 <span class="keyword">else</span>
<a name="l00148"></a>00148   <span class="keyword">write</span> (<a class="code" href="namespaceiso__fortran__env.html#a318638a59520df2daa779c692d146414">Error_Unit</a>,*) <span class="stringliteral">&#39;Error: The file &quot;structure_evolution.dat&quot; does not exist.&#39;</span>
<a name="l00149"></a>00149   call exit(7)
<a name="l00150"></a>00150 <span class="keyword">end if</span>
<a name="l00151"></a>00151 
<a name="l00152"></a>00152 return
<a name="l00153"></a>00153 <span class="keyword">end subroutine init_structure_evolution</span>
<a name="l00154"></a>00154 
<a name="l00155"></a>00155 <span class="comment">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<a name="l00167"></a><a class="code" href="namespacestructure.html#a6213b784ef520ad6198765747c318f7d">00167</a> <span class="keyword">subroutine </span><a class="code" href="namespacestructure.html#a6213b784ef520ad6198765747c318f7d">get_structure_properties_table</a>(time, Av, density, gas_temperature, grain_temperature)
<a name="l00168"></a>00168 
<a name="l00169"></a>00169   <span class="keyword">implicit none</span>
<a name="l00170"></a>00170 
<a name="l00171"></a>00171   <span class="comment">! Inputs</span>
<a name="l00172"></a>00172   <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(in)</span> :: time <span class="comment">!&lt;[in] Current time of the simulation [s]</span>
<a name="l00173"></a>00173   
<a name="l00174"></a>00174   <span class="comment">! Outputs</span>
<a name="l00175"></a>00175   <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(out)</span> :: Av <span class="comment">!&lt;[out] Visual extinction [mag]</span>
<a name="l00176"></a>00176   <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(out)</span> :: gas_temperature <span class="comment">!&lt;[out] gas temperature [K]</span>
<a name="l00177"></a>00177   <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(out)</span> :: grain_temperature <span class="comment">!&lt;[out] grain temperature [K]</span>
<a name="l00178"></a>00178   <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(out)</span> :: density <span class="comment">!&lt;[out] gas density [part/cm^3]</span>
<a name="l00179"></a>00179   
<a name="l00180"></a>00180   <span class="comment">! Local</span>
<a name="l00181"></a>00181   <span class="keywordtype">integer</span> :: closest_low_id <span class="comment">! the index of the first closest lower value of radius regarding the radius value given in parameter of the subroutine. </span>
<a name="l00182"></a>00182   <span class="keywordtype">real(double_precision)</span> :: t1, t2, log_y1, log_y2
<a name="l00183"></a>00183   <span class="keywordtype">real(double_precision)</span> :: interpolation_tmp <span class="comment">! Tmp value that contain a small part of the linear interpolation, to avoid computing it three times</span>
<a name="l00184"></a>00184   <span class="comment">!------------------------------------------------------------------------------</span>
<a name="l00185"></a>00185 
<a name="l00186"></a>00186   <span class="keyword">if</span> (time .lt. <a class="code" href="namespacestructure.html#a28ecafa4dc5856385464cc7f20156d66">structure_time</a>(<a class="code" href="namespacestructure.html#a0a6f3812a191d58bf36836aac8545aab">structure_sample</a>)) <span class="keyword">then</span>
<a name="l00187"></a>00187     
<a name="l00188"></a>00188     <span class="comment">! in the range</span>
<a name="l00189"></a>00189     closest_low_id = 1 + int((time - <a class="code" href="namespacestructure.html#a28ecafa4dc5856385464cc7f20156d66">structure_time</a>(1)) / <a class="code" href="namespacestructure.html#aa42592d500338ebcba62b07d44ebce47">structure_sample_step</a>)
<a name="l00190"></a>00190     
<a name="l00191"></a>00191     <span class="comment">! We get the closest times (left and right) from the current one</span>
<a name="l00192"></a>00192     t1 = <a class="code" href="namespacestructure.html#a28ecafa4dc5856385464cc7f20156d66">structure_time</a>(closest_low_id)
<a name="l00193"></a>00193     t2 = <a class="code" href="namespacestructure.html#a28ecafa4dc5856385464cc7f20156d66">structure_time</a>(closest_low_id + 1)
<a name="l00194"></a>00194     
<a name="l00195"></a>00195     interpolation_tmp = (time - t2) / (t1 - t2)
<a name="l00196"></a>00196     
<a name="l00197"></a>00197     <span class="comment">! For the density</span>
<a name="l00198"></a>00198     log_y1 = <a class="code" href="namespacestructure.html#a9aa87ecf57c3b576ef4cb00fbb9fca09">structure_log_density</a>(closest_low_id)
<a name="l00199"></a>00199     log_y2 = <a class="code" href="namespacestructure.html#a9aa87ecf57c3b576ef4cb00fbb9fca09">structure_log_density</a>(closest_low_id + 1)
<a name="l00200"></a>00200     density = 10.0d0**(log_y2 + (log_y1 - log_y2) * interpolation_tmp)
<a name="l00201"></a>00201     
<a name="l00202"></a>00202     <span class="comment">! For the visual extinction</span>
<a name="l00203"></a>00203     log_y1 = <a class="code" href="namespacestructure.html#a9c1da5f8cbf8d5d1364d2f5641fc7f10">structure_log_Av</a>(closest_low_id)
<a name="l00204"></a>00204     log_y2 = <a class="code" href="namespacestructure.html#a9c1da5f8cbf8d5d1364d2f5641fc7f10">structure_log_Av</a>(closest_low_id + 1)
<a name="l00205"></a>00205     Av = 10.0d0**(log_y2 + (log_y1 - log_y2) * interpolation_tmp)
<a name="l00206"></a>00206     
<a name="l00207"></a>00207     <span class="comment">! For the gas temperature</span>
<a name="l00208"></a>00208     log_y1 = <a class="code" href="namespacestructure.html#ab09eece455197b263e74ef1c710604f3">structure_log_gas_temperature</a>(closest_low_id)
<a name="l00209"></a>00209     log_y2 = <a class="code" href="namespacestructure.html#ab09eece455197b263e74ef1c710604f3">structure_log_gas_temperature</a>(closest_low_id + 1)
<a name="l00210"></a>00210     gas_temperature = 10.0d0**(log_y2 + (log_y1 - log_y2) * interpolation_tmp)
<a name="l00211"></a>00211     
<a name="l00212"></a>00212   <span class="keyword">else</span> <span class="keyword">if</span> (time .ge. <a class="code" href="namespacestructure.html#a28ecafa4dc5856385464cc7f20156d66">structure_time</a>(<a class="code" href="namespacestructure.html#a0a6f3812a191d58bf36836aac8545aab">structure_sample</a>)) <span class="keyword">then</span>
<a name="l00213"></a>00213     density = 10.0d0**(<a class="code" href="namespacestructure.html#a9aa87ecf57c3b576ef4cb00fbb9fca09">structure_log_density</a>(<a class="code" href="namespacestructure.html#a0a6f3812a191d58bf36836aac8545aab">structure_sample</a>))
<a name="l00214"></a>00214     Av = 10.0d0**(<a class="code" href="namespacestructure.html#a9c1da5f8cbf8d5d1364d2f5641fc7f10">structure_log_Av</a>(<a class="code" href="namespacestructure.html#a0a6f3812a191d58bf36836aac8545aab">structure_sample</a>))
<a name="l00215"></a>00215     gas_temperature = 10.0d0**(<a class="code" href="namespacestructure.html#ab09eece455197b263e74ef1c710604f3">structure_log_gas_temperature</a>(<a class="code" href="namespacestructure.html#a0a6f3812a191d58bf36836aac8545aab">structure_sample</a>))
<a name="l00216"></a>00216   <span class="keyword">end if</span>
<a name="l00217"></a>00217   
<a name="l00218"></a>00218   call <a class="code" href="namespaceglobal__variables.html#aaefa456c87039de5fe65fe097bc01c7d">get_grain_temperature</a>(time=time, gas_temperature=gas_temperature, grain_temperature=grain_temperature)
<a name="l00219"></a>00219 
<a name="l00220"></a>00220   return
<a name="l00221"></a>00221 <span class="keyword">end subroutine get_structure_properties_table</span>
<a name="l00222"></a>00222 
<a name="l00223"></a>00223 <span class="comment">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<a name="l00234"></a><a class="code" href="namespacestructure.html#a10887e487d6eb13899ae45c15714a1fe">00234</a> <span class="keyword">subroutine </span><a class="code" href="namespacestructure.html#a10887e487d6eb13899ae45c15714a1fe">get_structure_properties_fixed</a>(time, Av, density, gas_temperature, grain_temperature)
<a name="l00235"></a>00235 
<a name="l00236"></a>00236   <span class="keyword">implicit none</span>
<a name="l00237"></a>00237 
<a name="l00238"></a>00238   <span class="comment">! Inputs</span>
<a name="l00239"></a>00239   <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(in)</span> :: time <span class="comment">!&lt;[in] Current time of the simulation [s]</span>
<a name="l00240"></a>00240   
<a name="l00241"></a>00241   <span class="comment">! Outputs</span>
<a name="l00242"></a>00242   <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(out)</span> :: Av <span class="comment">!&lt;[out] Visual extinction [mag]</span>
<a name="l00243"></a>00243   <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(out)</span> :: gas_temperature <span class="comment">!&lt;[out] gas temperature [K]</span>
<a name="l00244"></a>00244   <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(out)</span> :: grain_temperature <span class="comment">!&lt;[out] grain temperature [K]</span>
<a name="l00245"></a>00245   <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(out)</span> :: density <span class="comment">!&lt;[out] gas density [part/cm^3]</span>
<a name="l00246"></a>00246 
<a name="l00247"></a>00247   <span class="comment">!------------------------------------------------------------------------------</span>
<a name="l00248"></a>00248 
<a name="l00249"></a>00249   density = <a class="code" href="namespaceglobal__variables.html#a408609ea169ac05b71940a129eae349f">initial_gas_density</a>
<a name="l00250"></a>00250   Av = <a class="code" href="namespaceglobal__variables.html#a9ea77b72e491267d134633833dd9c04b">INITIAL_VISUAL_EXTINCTION</a>
<a name="l00251"></a>00251   gas_temperature = <a class="code" href="namespaceglobal__variables.html#ac472b6ac150f184da9ec93d75ac42adf">initial_gas_temperature</a>
<a name="l00252"></a>00252   
<a name="l00253"></a>00253   call <a class="code" href="namespaceglobal__variables.html#aaefa456c87039de5fe65fe097bc01c7d">get_grain_temperature</a>(time=time, gas_temperature=gas_temperature, grain_temperature=grain_temperature)
<a name="l00254"></a>00254 
<a name="l00255"></a>00255   return
<a name="l00256"></a>00256 <span class="keyword">end subroutine get_structure_properties_fixed</span>
<a name="l00257"></a>00257 
<a name="l00258"></a>00258 <span class="comment">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<a name="l00269"></a><a class="code" href="namespacestructure.html#a05ba1735a8c6b1e689ac393b075c02f6">00269</a> <span class="keyword">subroutine </span><a class="code" href="namespacestructure.html#a05ba1735a8c6b1e689ac393b075c02f6">get_grain_temperature_gas</a>(time, gas_temperature, grain_temperature)
<a name="l00270"></a>00270 
<a name="l00271"></a>00271   <span class="keyword">implicit none</span>
<a name="l00272"></a>00272 
<a name="l00273"></a>00273   <span class="comment">! Inputs</span>
<a name="l00274"></a>00274   <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(in)</span> :: time <span class="comment">!&lt;[in] current time of the simulation [s]</span>
<a name="l00275"></a>00275   <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(in)</span> :: gas_temperature <span class="comment">!&lt;[in] gas temperature [K]</span>
<a name="l00276"></a>00276   
<a name="l00277"></a>00277   <span class="comment">! Outputs</span>
<a name="l00278"></a>00278   <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(out)</span> :: grain_temperature <span class="comment">!&lt;[out] grain temperature [K]</span>
<a name="l00279"></a>00279   <span class="comment">!------------------------------------------------------------------------------</span>
<a name="l00280"></a>00280   
<a name="l00281"></a>00281   grain_temperature = gas_temperature
<a name="l00282"></a>00282   
<a name="l00283"></a>00283   return
<a name="l00284"></a>00284 <span class="keyword">end subroutine get_grain_temperature_gas</span>
<a name="l00285"></a>00285 
<a name="l00286"></a>00286 <span class="comment">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<a name="l00297"></a><a class="code" href="namespacestructure.html#a3a7a44c5b1459c8df7c7e36c84200ccb">00297</a> <span class="keyword">subroutine </span><a class="code" href="namespacestructure.html#a3a7a44c5b1459c8df7c7e36c84200ccb">get_grain_temperature_fixed</a>(time, gas_temperature, grain_temperature)
<a name="l00298"></a>00298 
<a name="l00299"></a>00299   <span class="keyword">implicit none</span>
<a name="l00300"></a>00300 
<a name="l00301"></a>00301   <span class="comment">! Inputs</span>
<a name="l00302"></a>00302   <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(in)</span> :: time <span class="comment">!&lt;[in] current time of the simulation [s]</span>
<a name="l00303"></a>00303   <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(in)</span> :: gas_temperature <span class="comment">!&lt;[in] gas temperature [K]</span>
<a name="l00304"></a>00304   
<a name="l00305"></a>00305   <span class="comment">! Outputs</span>
<a name="l00306"></a>00306   <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(out)</span> :: grain_temperature <span class="comment">!&lt;[out] grain temperature [K]</span>
<a name="l00307"></a>00307   <span class="comment">!------------------------------------------------------------------------------</span>
<a name="l00308"></a>00308   
<a name="l00309"></a>00309   grain_temperature = <a class="code" href="namespaceglobal__variables.html#ac58b1010408bf3f4a86bd39a53b710c7">initial_dust_temperature</a>
<a name="l00310"></a>00310   
<a name="l00311"></a>00311   return
<a name="l00312"></a>00312 <span class="keyword">end subroutine get_grain_temperature_fixed</span>
<a name="l00313"></a>00313 
<a name="l00314"></a>00314 <span class="comment">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<a name="l00325"></a><a class="code" href="namespacestructure.html#a597ce1e4b011484991c88a3ed6fa4789">00325</a> <span class="keyword">subroutine </span><a class="code" href="namespacestructure.html#a597ce1e4b011484991c88a3ed6fa4789">get_grain_temperature_table</a>(time, gas_temperature, grain_temperature)
<a name="l00326"></a>00326 
<a name="l00327"></a>00327   <span class="keyword">implicit none</span>
<a name="l00328"></a>00328 
<a name="l00329"></a>00329   <span class="comment">! Inputs</span>
<a name="l00330"></a>00330   <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(in)</span> :: time <span class="comment">!&lt;[in] current time of the simulation [s]</span>
<a name="l00331"></a>00331   <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(in)</span> :: gas_temperature <span class="comment">!&lt;[in] gas temperature [K]</span>
<a name="l00332"></a>00332   
<a name="l00333"></a>00333   <span class="comment">! Outputs</span>
<a name="l00334"></a>00334   <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(out)</span> :: grain_temperature <span class="comment">!&lt;[out] grain temperature [K]</span>
<a name="l00335"></a>00335   <span class="comment">!------------------------------------------------------------------------------</span>
<a name="l00336"></a>00336   
<a name="l00337"></a>00337   <span class="comment">! Local</span>
<a name="l00338"></a>00338   <span class="keywordtype">integer</span> :: closest_low_id <span class="comment">! the index of the first closest lower value of radius regarding the radius value given in parameter of the subroutine. </span>
<a name="l00339"></a>00339   <span class="keywordtype">real(double_precision)</span> :: t1, t2, log_y1, log_y2
<a name="l00340"></a>00340   <span class="keywordtype">real(double_precision)</span> :: interpolation_tmp <span class="comment">! Tmp value that contain a small part of the linear interpolation, to avoid computing it three times</span>
<a name="l00341"></a>00341   <span class="comment">!------------------------------------------------------------------------------</span>
<a name="l00342"></a>00342 
<a name="l00343"></a>00343   <span class="keyword">if</span> (time .lt. <a class="code" href="namespacestructure.html#a28ecafa4dc5856385464cc7f20156d66">structure_time</a>(<a class="code" href="namespacestructure.html#a0a6f3812a191d58bf36836aac8545aab">structure_sample</a>)) <span class="keyword">then</span>
<a name="l00344"></a>00344     
<a name="l00345"></a>00345     <span class="comment">! in the range</span>
<a name="l00346"></a>00346     closest_low_id = 1 + int((time - <a class="code" href="namespacestructure.html#a28ecafa4dc5856385464cc7f20156d66">structure_time</a>(1)) / <a class="code" href="namespacestructure.html#aa42592d500338ebcba62b07d44ebce47">structure_sample_step</a>)
<a name="l00347"></a>00347     
<a name="l00348"></a>00348     <span class="comment">! We get the closest times (left and right) from the current one</span>
<a name="l00349"></a>00349     t1 = <a class="code" href="namespacestructure.html#a28ecafa4dc5856385464cc7f20156d66">structure_time</a>(closest_low_id)
<a name="l00350"></a>00350     t2 = <a class="code" href="namespacestructure.html#a28ecafa4dc5856385464cc7f20156d66">structure_time</a>(closest_low_id + 1)
<a name="l00351"></a>00351     
<a name="l00352"></a>00352     interpolation_tmp = (time - t2) / (t1 - t2)
<a name="l00353"></a>00353     
<a name="l00354"></a>00354     <span class="comment">! For the grain temperature</span>
<a name="l00355"></a>00355     log_y1 = <a class="code" href="namespacestructure.html#a14ff74561ceba26a8dbcd644f3c145dc">structure_log_dust_temperature</a>(closest_low_id)
<a name="l00356"></a>00356     log_y2 = <a class="code" href="namespacestructure.html#a14ff74561ceba26a8dbcd644f3c145dc">structure_log_dust_temperature</a>(closest_low_id + 1)
<a name="l00357"></a>00357     grain_temperature = 10.0d0**(log_y2 + (log_y1 - log_y2) * interpolation_tmp)
<a name="l00358"></a>00358     
<a name="l00359"></a>00359   <span class="keyword">else</span> <span class="keyword">if</span> (time .ge. <a class="code" href="namespacestructure.html#a28ecafa4dc5856385464cc7f20156d66">structure_time</a>(<a class="code" href="namespacestructure.html#a0a6f3812a191d58bf36836aac8545aab">structure_sample</a>)) <span class="keyword">then</span>
<a name="l00360"></a>00360     grain_temperature = 10.0d0**(<a class="code" href="namespacestructure.html#a14ff74561ceba26a8dbcd644f3c145dc">structure_log_dust_temperature</a>(<a class="code" href="namespacestructure.html#a0a6f3812a191d58bf36836aac8545aab">structure_sample</a>))
<a name="l00361"></a>00361   <span class="keyword">end if</span>  
<a name="l00362"></a>00362   return
<a name="l00363"></a>00363 <span class="keyword">end subroutine get_grain_temperature_table</span>
<a name="l00364"></a>00364 <span class="keyword">end module structure</span>
</pre></div></div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Wed May 28 2014 for <a href= http://code.google.com/p/nautilus/>Nautilus</a> by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
