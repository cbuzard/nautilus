<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>&lt;a href= http://code.google.com/p/nautilus/&gt;Nautilus&lt;/a&gt;: ode_solver.f90 Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname"><a href= http://code.google.com/p/nautilus/>Nautilus</a></div>
   <div id="projectbrief">1D gas-grain chemical model</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Types&#160;List</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">ode_solver.f90</div>  </div>
</div>
<div class="contents">
<a href="ode__solver_8f90.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="namespaceode__solver.html">00001</a> <span class="keyword">module</span> ode_solver
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 use <span class="keywordflow">shielding</span>
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 <span class="keyword">implicit none</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="keyword">contains</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="comment">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<a name="l00019"></a><a class="code" href="namespaceode__solver.html#a7e9f5bc8e28b55183b04c3f8855c26f2">00019</a> <span class="keyword">subroutine </span><a class="code" href="namespaceode__solver.html#a7e9f5bc8e28b55183b04c3f8855c26f2">set_chemical_reagents</a>()
<a name="l00020"></a>00020 use <span class="keywordflow">global_variables</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="keyword">implicit none</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="comment">! Locals</span>
<a name="l00025"></a>00025 <span class="keywordtype">integer</span> :: I,J,L
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="keywordtype">integer</span> :: no_species
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 no_species = <a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a> + 1
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="comment">! By default, non existing reagents (dummy species) will be assigned (nb_species+1)</span>
<a name="l00032"></a>00032 <a class="code" href="namespaceglobal__variables.html#ab899443e7a09652b2ce82d94964f9605">REACTION_SUBSTANCES_ID</a>(1:7, 1:<a class="code" href="namespaceglobal__variables.html#a817eda6b6bf84e137c7e0f9445e36916">nb_reactions</a>) = no_species
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="keyword">do</span> I=1,<a class="code" href="namespaceglobal__variables.html#a817eda6b6bf84e137c7e0f9445e36916">nb_reactions</a>
<a name="l00035"></a>00035   <span class="keyword">do</span> J=1,<a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037     <span class="keyword">do</span> L=1,7
<a name="l00038"></a>00038       <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(L,I).EQ.<a class="code" href="namespaceglobal__variables.html#a04617384cd2be82e5e894bfd695d9a5d">species_name</a>(J)) <span class="keyword">then</span>
<a name="l00039"></a>00039         <a class="code" href="namespaceglobal__variables.html#ab899443e7a09652b2ce82d94964f9605">REACTION_SUBSTANCES_ID</a>(L,I) = J
<a name="l00040"></a>00040       <span class="keyword">endif</span>
<a name="l00041"></a>00041     <span class="keyword">enddo</span>
<a name="l00042"></a>00042 
<a name="l00043"></a>00043   <span class="keyword">enddo</span>
<a name="l00044"></a>00044 <span class="keyword">enddo</span>   
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 return
<a name="l00047"></a>00047 <span class="keyword">end subroutine set_chemical_reagents</span>
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="comment">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<a name="l00060"></a><a class="code" href="namespaceode__solver.html#a189c718d380fc76ca74216614500dc51">00060</a> <span class="keyword">subroutine </span><a class="code" href="namespaceode__solver.html#a189c718d380fc76ca74216614500dc51">count_nonzeros</a>()
<a name="l00061"></a>00061 use <span class="keywordflow">global_variables</span>
<a name="l00062"></a>00062 <span class="keyword">implicit none</span>
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 <span class="comment">! Locals</span>
<a name="l00065"></a>00065 <span class="keywordtype">integer</span> :: i
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 <span class="comment">! Dummy parameters for restricted call of get_jacobian</span>
<a name="l00068"></a>00068 <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">dimension(nb_species)</span> :: DUMMYPDJ, DUMMYY
<a name="l00069"></a>00069 <span class="keywordtype">integer</span> IDUMMY
<a name="l00070"></a>00070 <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: dummy_n = 3
<a name="l00071"></a>00071 <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">parameter</span> :: dummy_t = 0.d0
<a name="l00072"></a>00072 <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">dimension(dummy_n)</span> :: dummy_ian, dummy_jan
<a name="l00073"></a>00073 
<a name="l00074"></a>00074 <span class="keywordtype">integer</span> :: max_nonzeros, NUMBERJAC
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 <span class="comment">! TODO comment not needed anymore maybe include it in the routine doxygen documentation</span>
<a name="l00077"></a>00077 <span class="comment">! Dimension of the work arrays for the solver </span>
<a name="l00078"></a>00078 <span class="comment">! The number of non zero values is checked with the testjac flag</span>
<a name="l00079"></a>00079 <span class="comment">! nb_nonzeros_values should be around the largest printed value</span>
<a name="l00080"></a>00080 
<a name="l00081"></a>00081 <span class="comment">! Forced initialisation of global variables that will be needed, especially for the &#39;set_constant_rates&#39; part. We donc care about specific values, </span>
<a name="l00082"></a>00082 <span class="comment">!! all that counts is that we can retrieve the number of non-zeros elements.</span>
<a name="l00083"></a>00083 
<a name="l00084"></a>00084 max_nonzeros = 0
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 dummyy(1:<a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>) = 1.d-5
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 call <a class="code" href="namespaceode__solver.html#a206b100daf9bc03a1aca5e40c4732222">set_constant_rates</a>()
<a name="l00089"></a>00089 call <a class="code" href="namespaceode__solver.html#a64d20641c5a00a70ff85ee375eb619d5">set_dependant_rates</a>(dummyy)
<a name="l00090"></a>00090 
<a name="l00091"></a>00091 <span class="keyword">do</span> IDUMMY=1,<a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>
<a name="l00092"></a>00092   call <a class="code" href="namespaceode__solver.html#ab4f6e9df4bbbf021406f9838848da9fd">get_jacobian</a>(n=dummy_n, t=dummy_t, y=dummyy,j=idummy,ian=dummy_ian, jan=dummy_jan, pdj=dummypdj)
<a name="l00093"></a>00093     
<a name="l00094"></a>00094   NUMBERJAC=0
<a name="l00095"></a>00095   <span class="keyword">do</span> i=1,<a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>
<a name="l00096"></a>00096     <span class="keyword">if</span> (dummypdj(i).ne.0.d0) <span class="keyword">then</span>
<a name="l00097"></a>00097       NUMBERJAC = NUMBERJAC + 1
<a name="l00098"></a>00098     <span class="keyword">endif</span>
<a name="l00099"></a>00099   <span class="keyword">enddo</span>
<a name="l00100"></a>00100 
<a name="l00101"></a>00101   <span class="keyword">if</span> (NUMBERJAC.gt.max_nonzeros) <span class="keyword">then</span>
<a name="l00102"></a>00102     max_nonzeros = NUMBERJAC
<a name="l00103"></a>00103   <span class="keyword">endif</span>
<a name="l00104"></a>00104   
<a name="l00105"></a>00105 <span class="keyword">enddo</span>
<a name="l00106"></a>00106 
<a name="l00107"></a>00107 <a class="code" href="namespaceglobal__variables.html#aa0be0f02b1f6186d5f588b6b461281ea">nb_nonzeros_values</a> = max_nonzeros
<a name="l00108"></a>00108 
<a name="l00109"></a>00109 return
<a name="l00110"></a>00110 <span class="keyword">end subroutine count_nonzeros</span>
<a name="l00111"></a>00111 
<a name="l00112"></a>00112 <span class="comment">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<a name="l00147"></a><a class="code" href="namespaceode__solver.html#ab4f6e9df4bbbf021406f9838848da9fd">00147</a> <span class="keyword">subroutine </span><a class="code" href="namespaceode__solver.html#ab4f6e9df4bbbf021406f9838848da9fd">get_jacobian</a>(N, T, Y, J, IAN, JAN, PDJ)
<a name="l00148"></a>00148 use <span class="keywordflow">global_variables</span>
<a name="l00149"></a>00149 <span class="keyword">implicit none</span>
<a name="l00150"></a>00150 
<a name="l00151"></a>00151 <span class="comment">! Inputs</span>
<a name="l00152"></a>00152 <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: N <span class="comment">!&lt;[in] number of first order ODEs.</span>
<a name="l00153"></a>00153 <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: J <span class="comment">!&lt;[in] Index representing the J-th column of the jacobian</span>
<a name="l00154"></a>00154 <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(in)</span> :: T <span class="comment">!&lt;[in] the initial value of the independent variable t.</span>
<a name="l00155"></a>00155 <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(in)</span>, <span class="keywordtype">dimension(N)</span> :: IAN <span class="comment">!&lt;[in] structure descriptor array of size N + 1.</span>
<a name="l00156"></a>00156 <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(in)</span>, <span class="keywordtype">dimension(N)</span> :: JAN <span class="comment">!&lt;[in] structure descriptor array of size NNZ.</span>
<a name="l00157"></a>00157 <span class="comment">!!\n IAN and JAN together describe the sparsity</span>
<a name="l00158"></a>00158 <span class="comment">!!\n structure of the Jacobian matrix, as used by</span>
<a name="l00159"></a>00159 <span class="comment">!!\n DLSODES when MITER = 1 or 2.</span>
<a name="l00160"></a>00160 <span class="comment">!!\n JAN contains the row indices of the nonzero</span>
<a name="l00161"></a>00161 <span class="comment">!!\n locations, reading in columnwise order, and</span>
<a name="l00162"></a>00162 <span class="comment">!!\n IAN contains the starting locations in JAN of</span>
<a name="l00163"></a>00163 <span class="comment">!!\n the descriptions of columns 1,...,NEQ, in</span>
<a name="l00164"></a>00164 <span class="comment">!!\n that order, with IAN(1) = 1.  Thus for each</span>
<a name="l00165"></a>00165 <span class="comment">!!\n j = 1,...,NEQ, the row indices i of the</span>
<a name="l00166"></a>00166 <span class="comment">!!\n nonzero locations in column j are</span>
<a name="l00167"></a>00167 <span class="comment">!!\n i = JAN(k),  IAN(j) .le. k .lt. IAN(j+1).</span>
<a name="l00168"></a>00168 <span class="comment">!!\n Note that IAN(NEQ+1) = NNZ + 1.</span>
<a name="l00169"></a>00169 <span class="comment">!!\n (If MOSS = 0, IAN/JAN may differ from the</span>
<a name="l00170"></a>00170 <span class="comment">!!\n input IA/JA because of a different ordering</span>
<a name="l00171"></a>00171 <span class="comment">!!\n in each column, and added diagonal entries.)</span>
<a name="l00172"></a>00172 <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(in)</span>, <span class="keywordtype">dimension(nb_species)</span> :: Y <span class="comment">!&lt; [in] abundances</span>
<a name="l00173"></a>00173 
<a name="l00174"></a>00174 <span class="comment">! Outputs</span>
<a name="l00175"></a>00175 <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(out)</span>, <span class="keywordtype">dimension(nb_species)</span> :: PDJ <span class="comment">!&lt;[out] J-th column of df/dy</span>
<a name="l00176"></a>00176 
<a name="l00177"></a>00177 <span class="comment">! Locals</span>
<a name="l00178"></a>00178 <span class="keywordtype">integer</span> :: no_species
<a name="l00179"></a>00179 
<a name="l00180"></a>00180 <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">dimension(nb_species+1)</span> :: PDJ2
<a name="l00181"></a>00181 <span class="keywordtype">integer</span> :: i
<a name="l00182"></a>00182 <span class="keywordtype">integer</span> :: reagent1_idx, reagent2_idx, reagent3_idx, product1_idx, product2_idx, product3_idx, product4_idx
<a name="l00183"></a>00183 <span class="keywordtype">integer</span> :: reaction_idx <span class="comment">! The index of a given reaction</span>
<a name="l00184"></a>00184 
<a name="l00185"></a>00185 <span class="comment">! Temp values to increase speed</span>
<a name="l00186"></a>00186 <span class="keywordtype">real(double_precision)</span> :: H_number_density_squared <span class="comment">! H_number_density*H_number_density, to gain speed</span>
<a name="l00187"></a>00187 <span class="keywordtype">real(double_precision)</span> :: tmp_value <span class="comment">! To optimize speed, temporary variable is created to avoid multiple calculation of the same thing</span>
<a name="l00188"></a>00188 
<a name="l00189"></a>00189 no_species=<a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>+1 <span class="comment">! Index corresponding to no species (meaning that there is no 3rd reagent for instance</span>
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 H_number_density_squared = <a class="code" href="namespaceglobal__variables.html#ad8c6e0f43cbfebacfed34e1f1921ef92">H_number_density</a> * <a class="code" href="namespaceglobal__variables.html#ad8c6e0f43cbfebacfed34e1f1921ef92">H_number_density</a>
<a name="l00192"></a>00192 
<a name="l00193"></a>00193 PDJ2(1:<a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>+1) = 0.d0
<a name="l00194"></a>00194 
<a name="l00195"></a>00195 <span class="keyword">do</span> i=1,<a class="code" href="namespaceglobal__variables.html#a5272ac866f093cc83feb14708002dd40">nb_reactions_using_species</a>(j)
<a name="l00196"></a>00196   reaction_idx = <a class="code" href="namespaceglobal__variables.html#a76e501e660f37a222b9cedb83599d22c">relevant_reactions</a>(i, j) <span class="comment">! j being the species index, given as a parameter</span>
<a name="l00197"></a>00197 
<a name="l00198"></a>00198   reagent1_idx = <a class="code" href="namespaceglobal__variables.html#ab899443e7a09652b2ce82d94964f9605">REACTION_SUBSTANCES_ID</a>(1, reaction_idx)
<a name="l00199"></a>00199   reagent2_idx = <a class="code" href="namespaceglobal__variables.html#ab899443e7a09652b2ce82d94964f9605">REACTION_SUBSTANCES_ID</a>(2, reaction_idx)
<a name="l00200"></a>00200   reagent3_idx = <a class="code" href="namespaceglobal__variables.html#ab899443e7a09652b2ce82d94964f9605">REACTION_SUBSTANCES_ID</a>(3, reaction_idx)
<a name="l00201"></a>00201   product1_idx = <a class="code" href="namespaceglobal__variables.html#ab899443e7a09652b2ce82d94964f9605">REACTION_SUBSTANCES_ID</a>(4, reaction_idx)
<a name="l00202"></a>00202   product2_idx = <a class="code" href="namespaceglobal__variables.html#ab899443e7a09652b2ce82d94964f9605">REACTION_SUBSTANCES_ID</a>(5, reaction_idx)
<a name="l00203"></a>00203   product3_idx = <a class="code" href="namespaceglobal__variables.html#ab899443e7a09652b2ce82d94964f9605">REACTION_SUBSTANCES_ID</a>(6, reaction_idx)
<a name="l00204"></a>00204   product4_idx = <a class="code" href="namespaceglobal__variables.html#ab899443e7a09652b2ce82d94964f9605">REACTION_SUBSTANCES_ID</a>(7, reaction_idx)
<a name="l00205"></a>00205   
<a name="l00206"></a>00206   <span class="comment">! if statements are written in a specific order to increase speed. The goal is to test first the most probable event, and </span>
<a name="l00207"></a>00207   <span class="comment">!! then always go to &#39;else&#39; statement, not to test if we have already found our case. One, then two bodies reactions are the most </span>
<a name="l00208"></a>00208   <span class="comment">!! abundants reactions. </span>
<a name="l00209"></a>00209 
<a name="l00210"></a>00210   <span class="comment">! One reagent only</span>
<a name="l00211"></a>00211   <span class="keyword">if</span> (reagent2_idx.eq.no_species) <span class="keyword">then</span>
<a name="l00212"></a>00212     <span class="keyword">if</span> (reagent1_idx.eq.J) <span class="keyword">then</span> 
<a name="l00213"></a>00213       tmp_value = <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(reaction_idx)
<a name="l00214"></a>00214       PDJ2(product1_idx)   = PDJ2(product1_idx) + tmp_value
<a name="l00215"></a>00215       PDJ2(product2_idx)   = PDJ2(product2_idx) + tmp_value
<a name="l00216"></a>00216       PDJ2(product3_idx)   = PDJ2(product3_idx) + tmp_value
<a name="l00217"></a>00217       PDJ2(product4_idx)   = PDJ2(product4_idx) + tmp_value
<a name="l00218"></a>00218       PDJ2(reagent1_idx) = PDJ2(reagent1_idx) - tmp_value
<a name="l00219"></a>00219     <span class="keyword">endif</span>
<a name="l00220"></a>00220   
<a name="l00221"></a>00221   <span class="comment">! Two bodies reaction</span>
<a name="l00222"></a>00222   <span class="keyword">else</span> <span class="keyword">if</span> (reagent3_idx.eq.no_species) <span class="keyword">then</span>
<a name="l00223"></a>00223     <span class="keyword">if</span> (reagent1_idx.eq.J) <span class="keyword">then</span> 
<a name="l00224"></a>00224       tmp_value = <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(reaction_idx) * Y(reagent2_idx) * <a class="code" href="namespaceglobal__variables.html#ad8c6e0f43cbfebacfed34e1f1921ef92">H_number_density</a>
<a name="l00225"></a>00225       PDJ2(product1_idx) = PDJ2(product1_idx) + tmp_value
<a name="l00226"></a>00226       PDJ2(product2_idx) = PDJ2(product2_idx) + tmp_value
<a name="l00227"></a>00227       PDJ2(product3_idx) = PDJ2(product3_idx) + tmp_value
<a name="l00228"></a>00228       PDJ2(product4_idx) = PDJ2(product4_idx) + tmp_value
<a name="l00229"></a>00229       PDJ2(reagent1_idx) = PDJ2(reagent1_idx) - tmp_value
<a name="l00230"></a>00230       PDJ2(reagent2_idx) = PDJ2(reagent2_idx) - tmp_value
<a name="l00231"></a>00231     <span class="keyword">endif</span>
<a name="l00232"></a>00232 
<a name="l00233"></a>00233     <span class="keyword">if</span> (reagent2_idx.eq.J) <span class="keyword">then</span> 
<a name="l00234"></a>00234       tmp_value = <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(reaction_idx) * Y(reagent1_idx) * <a class="code" href="namespaceglobal__variables.html#ad8c6e0f43cbfebacfed34e1f1921ef92">H_number_density</a>
<a name="l00235"></a>00235       PDJ2(product1_idx) = PDJ2(product1_idx) + tmp_value
<a name="l00236"></a>00236       PDJ2(product2_idx) = PDJ2(product2_idx) + tmp_value
<a name="l00237"></a>00237       PDJ2(product3_idx) = PDJ2(product3_idx) + tmp_value
<a name="l00238"></a>00238       PDJ2(product4_idx) = PDJ2(product4_idx) + tmp_value
<a name="l00239"></a>00239       PDJ2(reagent1_idx) = PDJ2(reagent1_idx) - tmp_value
<a name="l00240"></a>00240       PDJ2(reagent2_idx) = PDJ2(reagent2_idx) - tmp_value
<a name="l00241"></a>00241     <span class="keyword">endif</span>
<a name="l00242"></a>00242   
<a name="l00243"></a>00243   <span class="comment">! Three bodies reaction</span>
<a name="l00244"></a>00244   <span class="keyword">else</span>
<a name="l00245"></a>00245     <span class="keyword">if</span> (reagent1_idx.eq.J) <span class="keyword">then</span> 
<a name="l00246"></a>00246       tmp_value = <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(reaction_idx) * Y(reagent2_idx) * Y(reagent3_idx) * H_number_density_squared
<a name="l00247"></a>00247       PDJ2(product1_idx) = PDJ2(product1_idx) + tmp_value
<a name="l00248"></a>00248       PDJ2(product2_idx) = PDJ2(product2_idx) + tmp_value
<a name="l00249"></a>00249       PDJ2(product3_idx) = PDJ2(product3_idx) + tmp_value
<a name="l00250"></a>00250       PDJ2(product4_idx) = PDJ2(product4_idx) + tmp_value
<a name="l00251"></a>00251       PDJ2(reagent1_idx) = PDJ2(reagent1_idx) - tmp_value
<a name="l00252"></a>00252       PDJ2(reagent2_idx) = PDJ2(reagent2_idx) - tmp_value
<a name="l00253"></a>00253       PDJ2(reagent3_idx) = PDJ2(reagent3_idx) - tmp_value
<a name="l00254"></a>00254     <span class="keyword">endif</span>
<a name="l00255"></a>00255 
<a name="l00256"></a>00256     <span class="keyword">if</span> (reagent2_idx.eq.J) <span class="keyword">then</span> 
<a name="l00257"></a>00257       tmp_value = <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(reaction_idx) * Y(reagent1_idx) * Y(reagent3_idx) * H_number_density_squared
<a name="l00258"></a>00258       PDJ2(product1_idx) = PDJ2(product1_idx) + tmp_value
<a name="l00259"></a>00259       PDJ2(product2_idx) = PDJ2(product2_idx) + tmp_value
<a name="l00260"></a>00260       PDJ2(product3_idx) = PDJ2(product3_idx) + tmp_value
<a name="l00261"></a>00261       PDJ2(product4_idx) = PDJ2(product4_idx) + tmp_value
<a name="l00262"></a>00262       PDJ2(reagent1_idx) = PDJ2(reagent1_idx) - tmp_value
<a name="l00263"></a>00263       PDJ2(reagent2_idx) = PDJ2(reagent2_idx) - tmp_value
<a name="l00264"></a>00264       PDJ2(reagent3_idx) = PDJ2(reagent3_idx) - tmp_value
<a name="l00265"></a>00265     <span class="keyword">endif</span>
<a name="l00266"></a>00266 
<a name="l00267"></a>00267     <span class="keyword">if</span> (reagent3_idx.eq.J) <span class="keyword">then</span> 
<a name="l00268"></a>00268       tmp_value = <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(reaction_idx) * Y(reagent1_idx) * Y(reagent2_idx) * H_number_density_squared
<a name="l00269"></a>00269       PDJ2(product1_idx) = PDJ2(product1_idx) + tmp_value
<a name="l00270"></a>00270       PDJ2(product2_idx) = PDJ2(product2_idx) + tmp_value
<a name="l00271"></a>00271       PDJ2(product3_idx) = PDJ2(product3_idx) + tmp_value
<a name="l00272"></a>00272       PDJ2(product4_idx) = PDJ2(product4_idx) + tmp_value
<a name="l00273"></a>00273       PDJ2(reagent1_idx) = PDJ2(reagent1_idx) - tmp_value
<a name="l00274"></a>00274       PDJ2(reagent2_idx) = PDJ2(reagent2_idx) - tmp_value
<a name="l00275"></a>00275       PDJ2(reagent3_idx) = PDJ2(reagent3_idx) - tmp_value
<a name="l00276"></a>00276     <span class="keyword">endif</span>
<a name="l00277"></a>00277 
<a name="l00278"></a>00278   <span class="keyword">endif</span>
<a name="l00279"></a>00279 
<a name="l00280"></a>00280 <span class="keyword">enddo</span>
<a name="l00281"></a>00281 
<a name="l00282"></a>00282 PDJ(1:<a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>)=PDJ2(1:<a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>)
<a name="l00283"></a>00283 
<a name="l00284"></a>00284 return
<a name="l00285"></a>00285 <span class="keyword">end subroutine get_jacobian</span>
<a name="l00286"></a>00286 
<a name="l00287"></a>00287 <span class="comment">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<a name="l00301"></a><a class="code" href="namespaceode__solver.html#a91d7fbde01a8dbba46768a40fe2ff9f1">00301</a> <span class="keyword">subroutine </span><a class="code" href="namespaceode__solver.html#a91d7fbde01a8dbba46768a40fe2ff9f1">init_relevant_reactions</a>()
<a name="l00302"></a>00302 use <span class="keywordflow">global_variables</span>
<a name="l00303"></a>00303 <span class="keyword">implicit none</span>
<a name="l00304"></a>00304 
<a name="l00305"></a>00305 <span class="comment">! Locals</span>
<a name="l00306"></a>00306 <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(nb_reactions, nb_species+1)</span> :: is_species_used <span class="comment">! For each species, tell which reactions use it or not </span>
<a name="l00307"></a>00307 <span class="comment">!! (0 if not used, 1 if used at least once)</span>
<a name="l00308"></a>00308 
<a name="l00309"></a>00309 <span class="keywordtype">integer</span> :: reaction, species, idx
<a name="l00310"></a>00310 <span class="keywordtype">integer</span> :: reagent1_idx, reagent2_idx, reagent3_idx
<a name="l00311"></a>00311 
<a name="l00312"></a>00312 is_species_used(1:<a class="code" href="namespaceglobal__variables.html#a817eda6b6bf84e137c7e0f9445e36916">nb_reactions</a>, 1:<a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>+1) = 0
<a name="l00313"></a>00313 
<a name="l00314"></a>00314 <span class="keyword">do</span> reaction=1,<a class="code" href="namespaceglobal__variables.html#a817eda6b6bf84e137c7e0f9445e36916">nb_reactions</a>
<a name="l00315"></a>00315 
<a name="l00316"></a>00316   reagent1_idx = <a class="code" href="namespaceglobal__variables.html#ab899443e7a09652b2ce82d94964f9605">REACTION_SUBSTANCES_ID</a>(1, reaction)
<a name="l00317"></a>00317   reagent2_idx = <a class="code" href="namespaceglobal__variables.html#ab899443e7a09652b2ce82d94964f9605">REACTION_SUBSTANCES_ID</a>(2, reaction)
<a name="l00318"></a>00318   reagent3_idx = <a class="code" href="namespaceglobal__variables.html#ab899443e7a09652b2ce82d94964f9605">REACTION_SUBSTANCES_ID</a>(3, reaction)
<a name="l00319"></a>00319   
<a name="l00320"></a>00320   is_species_used(reaction, reagent1_idx) = 1
<a name="l00321"></a>00321   is_species_used(reaction, reagent2_idx) = 1
<a name="l00322"></a>00322   is_species_used(reaction, reagent3_idx) = 1
<a name="l00323"></a>00323 
<a name="l00324"></a>00324 <span class="keyword">enddo</span>
<a name="l00325"></a>00325 
<a name="l00326"></a>00326 <span class="comment">! We get the total number of reactions in which each species can be involved</span>
<a name="l00327"></a>00327 <span class="comment">! We skip the &#39;nb_species+1&#39; species that is only a fake species for &quot;no reagent&quot;</span>
<a name="l00328"></a>00328 <a class="code" href="namespaceglobal__variables.html#a5272ac866f093cc83feb14708002dd40">nb_reactions_using_species</a>(1:<a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>) = sum(is_species_used(1:<a class="code" href="namespaceglobal__variables.html#a817eda6b6bf84e137c7e0f9445e36916">nb_reactions</a>, 1:<a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>), 1)
<a name="l00329"></a>00329 
<a name="l00330"></a>00330 <span class="comment">! What is the maximum number of reactions involving one particular species?</span>
<a name="l00331"></a>00331 <a class="code" href="namespaceglobal__variables.html#a57473363de41374f2a30bcb0bb498e94">max_reactions_same_species</a> = maxval(<a class="code" href="namespaceglobal__variables.html#a5272ac866f093cc83feb14708002dd40">nb_reactions_using_species</a>(1:<a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>))
<a name="l00332"></a>00332 
<a name="l00333"></a>00333 <span class="keyword">allocate</span>(<a class="code" href="namespaceglobal__variables.html#a76e501e660f37a222b9cedb83599d22c">relevant_reactions</a>(<a class="code" href="namespaceglobal__variables.html#a57473363de41374f2a30bcb0bb498e94">max_reactions_same_species</a>, <a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>))
<a name="l00334"></a>00334 
<a name="l00335"></a>00335 <a class="code" href="namespaceglobal__variables.html#a76e501e660f37a222b9cedb83599d22c">relevant_reactions</a>(1:<a class="code" href="namespaceglobal__variables.html#a57473363de41374f2a30bcb0bb498e94">max_reactions_same_species</a>, 1:<a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>) = 0 <span class="comment">! For the extra elements (because not all species </span>
<a name="l00336"></a>00336 <span class="comment">!! will have &#39;max_reactions&#39; reactions involving it).</span>
<a name="l00337"></a>00337 
<a name="l00338"></a>00338 <span class="comment">! For each species, we get the references of reactions that have it as a reagent. The number of reactions is different for each species </span>
<a name="l00339"></a>00339 <span class="comment">!! Thus, at least one species will have a full line of meaningfull indexes. The other will have the rest of their line completed by zeros.</span>
<a name="l00340"></a>00340 <span class="keyword">do</span> species=1,<a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>
<a name="l00341"></a>00341   idx = 1
<a name="l00342"></a>00342   <span class="keyword">do</span> reaction=1, <a class="code" href="namespaceglobal__variables.html#a817eda6b6bf84e137c7e0f9445e36916">nb_reactions</a>
<a name="l00343"></a>00343     <span class="keyword">if</span> (is_species_used(reaction, species).eq.1) <span class="keyword">then</span>
<a name="l00344"></a>00344       <a class="code" href="namespaceglobal__variables.html#a76e501e660f37a222b9cedb83599d22c">relevant_reactions</a>(idx, species) = reaction
<a name="l00345"></a>00345       idx = idx + 1
<a name="l00346"></a>00346     <span class="keyword">endif</span>
<a name="l00347"></a>00347   <span class="keyword">enddo</span>
<a name="l00348"></a>00348 <span class="keyword">enddo</span>
<a name="l00349"></a>00349 
<a name="l00350"></a>00350 
<a name="l00351"></a>00351 return
<a name="l00352"></a>00352 <span class="keyword">end subroutine init_relevant_reactions</span>
<a name="l00353"></a>00353 
<a name="l00354"></a>00354 <span class="comment">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<a name="l00365"></a><a class="code" href="namespaceode__solver.html#a2f07fb06a308990d501a106e1d37a235">00365</a> <span class="keyword">subroutine </span><a class="code" href="namespaceode__solver.html#a2f07fb06a308990d501a106e1d37a235">initialize_work_arrays</a>()
<a name="l00366"></a>00366 use <span class="keywordflow">global_variables</span>
<a name="l00367"></a>00367 <span class="keyword">implicit none</span>
<a name="l00368"></a>00368 
<a name="l00369"></a>00369 <a class="code" href="namespaceglobal__variables.html#ae85f1490b4545b6142ecdfa4ae710309">lrw</a> = 20 + 3 * <a class="code" href="namespaceglobal__variables.html#aa0be0f02b1f6186d5f588b6b461281ea">nb_nonzeros_values</a>*<a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a> + 21 * <a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>
<a name="l00370"></a>00370 <a class="code" href="namespaceglobal__variables.html#a37d2d19c92f879e6d01cce795dc800d0">liw</a> = 31 + 3 * <a class="code" href="namespaceglobal__variables.html#aa0be0f02b1f6186d5f588b6b461281ea">nb_nonzeros_values</a>*<a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a> + 21 * <a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>
<a name="l00371"></a>00371 
<a name="l00372"></a>00372 <span class="keyword">allocate</span>(iwork(<a class="code" href="namespaceglobal__variables.html#a37d2d19c92f879e6d01cce795dc800d0">liw</a>))
<a name="l00373"></a>00373 <span class="keyword">allocate</span>(rwork(<a class="code" href="namespaceglobal__variables.html#ae85f1490b4545b6142ecdfa4ae710309">lrw</a>))
<a name="l00374"></a>00374 
<a name="l00375"></a>00375 iwork(1:<a class="code" href="namespaceglobal__variables.html#a37d2d19c92f879e6d01cce795dc800d0">liw</a>) = 0
<a name="l00376"></a>00376 rwork(1:<a class="code" href="namespaceglobal__variables.html#ae85f1490b4545b6142ecdfa4ae710309">lrw</a>) = 0.d0
<a name="l00377"></a>00377 
<a name="l00378"></a>00378 return
<a name="l00379"></a>00379 <span class="keyword">end subroutine initialize_work_arrays</span>
<a name="l00380"></a>00380 
<a name="l00381"></a>00381 <span class="comment">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<a name="l00392"></a><a class="code" href="namespaceode__solver.html#a1a572eac36b0a5cad4862ce2c6f1199f">00392</a> <span class="keyword">subroutine </span><a class="code" href="namespaceode__solver.html#a1a572eac36b0a5cad4862ce2c6f1199f">set_work_arrays</a>(Y)
<a name="l00393"></a>00393 use <span class="keywordflow">global_variables</span>
<a name="l00394"></a>00394 <span class="keyword">implicit none</span>
<a name="l00395"></a>00395 
<a name="l00396"></a>00396 <span class="comment">! Inputs</span>
<a name="l00397"></a>00397 <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(in)</span>, <span class="keywordtype">dimension(nb_species)</span> :: Y <span class="comment">!&lt; [in] abundances</span>
<a name="l00398"></a>00398 
<a name="l00399"></a>00399 <span class="comment">! Locals</span>
<a name="l00400"></a>00400 <span class="keywordtype">integer</span> :: i,j,k
<a name="l00401"></a>00401 <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">dimension(nb_species)</span> :: PDJ
<a name="l00402"></a>00402 <span class="keywordtype">integer</span> :: NNZ
<a name="l00403"></a>00403 
<a name="l00404"></a>00404 <span class="comment">! Dummy parameters for restricted call of get_jacobian</span>
<a name="l00405"></a>00405 <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: dummy_n = 3
<a name="l00406"></a>00406 <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">parameter</span> :: dummy_t = 0.d0
<a name="l00407"></a>00407 <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">dimension(dummy_n)</span> :: dummy_ian, dummy_jan
<a name="l00408"></a>00408 
<a name="l00409"></a>00409 
<a name="l00410"></a>00410 <span class="comment">! For IA and JA</span>
<a name="l00411"></a>00411 <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(nb_species+1)</span> :: IA <span class="comment">!&lt; For each species, the number (minus 1) of non-zeros values for the previous species</span>
<a name="l00412"></a>00412 <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(liw)</span> :: JA <span class="comment">!&lt; List the non-zeros values. For each non-zeros values, tell to what species it correspond </span>
<a name="l00413"></a>00413 
<a name="l00414"></a>00414 call <a class="code" href="namespaceode__solver.html#a206b100daf9bc03a1aca5e40c4732222">set_constant_rates</a>()
<a name="l00415"></a>00415 call <a class="code" href="namespaceode__solver.html#a64d20641c5a00a70ff85ee375eb619d5">set_dependant_rates</a>(Y)
<a name="l00416"></a>00416 
<a name="l00417"></a>00417 <span class="comment">! Initialize work arrays</span>
<a name="l00418"></a>00418 
<a name="l00419"></a>00419 iwork(1:<a class="code" href="namespaceglobal__variables.html#a37d2d19c92f879e6d01cce795dc800d0">liw</a>) = 0
<a name="l00420"></a>00420 rwork(1:<a class="code" href="namespaceglobal__variables.html#ae85f1490b4545b6142ecdfa4ae710309">lrw</a>) = 0.d0
<a name="l00421"></a>00421 <a class="code" href="namespaceglobal__variables.html#ad2ab051c914a40f8c5f1afbcc7b0d1cd">IWORK</a>(5) = 5
<a name="l00422"></a>00422 <a class="code" href="namespaceglobal__variables.html#a9f741fdb815ceee60ca6562d733196b8">RWORK</a>(6) = 3.154D14
<a name="l00423"></a>00423 <a class="code" href="namespaceglobal__variables.html#ad2ab051c914a40f8c5f1afbcc7b0d1cd">IWORK</a>(6) = 10000
<a name="l00424"></a>00424 <a class="code" href="namespaceglobal__variables.html#ad2ab051c914a40f8c5f1afbcc7b0d1cd">IWORK</a>(7) = 2
<a name="l00425"></a>00425 
<a name="l00426"></a>00426 <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#aa4c5d6aebbab967a09d481f86f109eb3">timestep</a>.eq.1) <span class="keyword">then</span>
<a name="l00427"></a>00427   <a class="code" href="namespaceglobal__variables.html#ad2ab051c914a40f8c5f1afbcc7b0d1cd">IWORK</a>(6)=2000
<a name="l00428"></a>00428 <span class="keyword">endif</span>
<a name="l00429"></a>00429 
<a name="l00430"></a>00430 k=1
<a name="l00431"></a>00431 
<a name="l00432"></a>00432 <span class="keyword">do</span> j=1,<a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>
<a name="l00433"></a>00433   call <a class="code" href="namespaceode__solver.html#ab4f6e9df4bbbf021406f9838848da9fd">get_jacobian</a>(n=dummy_n, t=dummy_t, y=Y,j=J,ian=dummy_ian, jan=dummy_jan, pdj=PDJ)
<a name="l00434"></a>00434 
<a name="l00435"></a>00435   IA(j)=k
<a name="l00436"></a>00436 
<a name="l00437"></a>00437   <span class="keyword">do</span> i=1,<a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>
<a name="l00438"></a>00438     <span class="keyword">if</span> (abs(PDJ(i)).gt.1.d-99) <span class="keyword">then</span>
<a name="l00439"></a>00439       JA(k)=i
<a name="l00440"></a>00440       k=k+1
<a name="l00441"></a>00441     <span class="keyword">endif</span>
<a name="l00442"></a>00442   <span class="keyword">enddo</span>
<a name="l00443"></a>00443 
<a name="l00444"></a>00444 <span class="keyword">enddo</span>
<a name="l00445"></a>00445 
<a name="l00446"></a>00446 IA(<a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>+1)=k
<a name="l00447"></a>00447 
<a name="l00448"></a>00448 NNZ=IA(<a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>+1)-1
<a name="l00449"></a>00449 iwork(30+1:30+<a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>+1)=IA(1:<a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>+1)
<a name="l00450"></a>00450 iwork(31+<a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>+1:31+<a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>+NNZ)=JA(1:NNZ)
<a name="l00451"></a>00451 
<a name="l00452"></a>00452 return
<a name="l00453"></a>00453 <span class="keyword">end subroutine set_work_arrays</span>
<a name="l00454"></a>00454 
<a name="l00455"></a>00455 <span class="comment">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<a name="l00466"></a><a class="code" href="namespaceode__solver.html#a6058cfe03a6f2d7768e6569b08d72859">00466</a> <span class="keyword">subroutine </span><a class="code" href="namespaceode__solver.html#a6058cfe03a6f2d7768e6569b08d72859">get_temporal_derivatives</a>(N,T,Y,YDOT)
<a name="l00467"></a>00467 use <span class="keywordflow">global_variables</span>
<a name="l00468"></a>00468 
<a name="l00469"></a>00469 <span class="keyword">implicit none</span>
<a name="l00470"></a>00470 
<a name="l00471"></a>00471 <span class="comment">! Inputs</span>
<a name="l00472"></a>00472 <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: N <span class="comment">!&lt;[in] number of first order ODEs.</span>
<a name="l00473"></a>00473 <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(in)</span>, <span class="keywordtype">dimension(nb_species)</span> :: Y <span class="comment">!&lt; [in] abundances</span>
<a name="l00474"></a>00474 <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(in)</span> :: T <span class="comment">!&lt;[in] Not used by the code, but needed for the ODEPACK call format expected for FCHEM in dlsodes</span>
<a name="l00475"></a>00475 
<a name="l00476"></a>00476 <span class="comment">! Outputs</span>
<a name="l00477"></a>00477 <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(out)</span>, <span class="keywordtype">dimension(nb_species)</span> :: YDOT <span class="comment">!&lt;[out] derivative of the abundances</span>
<a name="l00478"></a>00478 
<a name="l00479"></a>00479 <span class="comment">! Locals</span>
<a name="l00480"></a>00480 <span class="keywordtype">integer</span> :: no_species
<a name="l00481"></a>00481 <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">dimension(nb_species+1)</span> :: YD2
<a name="l00482"></a>00482 <span class="keywordtype">integer</span> :: i
<a name="l00483"></a>00483 <span class="keywordtype">integer</span> :: reagent1_idx, reagent2_idx, reagent3_idx, product1_idx, product2_idx, product3_idx, product4_idx
<a name="l00484"></a>00484 <span class="keywordtype">real(double_precision)</span> :: rate
<a name="l00485"></a>00485 
<a name="l00486"></a>00486 call <a class="code" href="namespaceode__solver.html#a64d20641c5a00a70ff85ee375eb619d5">set_dependant_rates</a>(y)
<a name="l00487"></a>00487 
<a name="l00488"></a>00488 
<a name="l00489"></a>00489 no_species = <a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a> + 1
<a name="l00490"></a>00490 
<a name="l00491"></a>00491 ydot(1:<a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>) = 0.d0
<a name="l00492"></a>00492 yd2(1:<a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>) = 0.d0
<a name="l00493"></a>00493 
<a name="l00494"></a>00494 <span class="comment">! The differential equations are calculated in a loop here</span>
<a name="l00495"></a>00495 <span class="keyword">do</span> I=1,<a class="code" href="namespaceglobal__variables.html#a817eda6b6bf84e137c7e0f9445e36916">nb_reactions</a>
<a name="l00496"></a>00496 
<a name="l00497"></a>00497   reagent1_idx = <a class="code" href="namespaceglobal__variables.html#ab899443e7a09652b2ce82d94964f9605">REACTION_SUBSTANCES_ID</a>(1, i)
<a name="l00498"></a>00498   reagent2_idx = <a class="code" href="namespaceglobal__variables.html#ab899443e7a09652b2ce82d94964f9605">REACTION_SUBSTANCES_ID</a>(2, i)
<a name="l00499"></a>00499   reagent3_idx = <a class="code" href="namespaceglobal__variables.html#ab899443e7a09652b2ce82d94964f9605">REACTION_SUBSTANCES_ID</a>(3, i)
<a name="l00500"></a>00500 
<a name="l00501"></a>00501   product1_idx = <a class="code" href="namespaceglobal__variables.html#ab899443e7a09652b2ce82d94964f9605">REACTION_SUBSTANCES_ID</a>(4, i)
<a name="l00502"></a>00502   product2_idx = <a class="code" href="namespaceglobal__variables.html#ab899443e7a09652b2ce82d94964f9605">REACTION_SUBSTANCES_ID</a>(5, i)
<a name="l00503"></a>00503   product3_idx = <a class="code" href="namespaceglobal__variables.html#ab899443e7a09652b2ce82d94964f9605">REACTION_SUBSTANCES_ID</a>(6, i)
<a name="l00504"></a>00504   product4_idx = <a class="code" href="namespaceglobal__variables.html#ab899443e7a09652b2ce82d94964f9605">REACTION_SUBSTANCES_ID</a>(7, i)
<a name="l00505"></a>00505 
<a name="l00506"></a>00506   <span class="comment">! One reagent only</span>
<a name="l00507"></a>00507   <span class="keyword">if</span> (reagent2_idx.eq.no_species) <span class="keyword">then</span>
<a name="l00508"></a>00508     RATE = <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(I) * Y(reagent1_idx)  
<a name="l00509"></a>00509   <span class="keyword">else</span>
<a name="l00510"></a>00510     <span class="keyword">if</span> (reagent3_idx.eq.no_species) <span class="keyword">then</span>
<a name="l00511"></a>00511       <span class="comment">! Two bodies reactions</span>
<a name="l00512"></a>00512       RATE = <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(I) * Y(reagent1_idx) * Y(reagent2_idx) * <a class="code" href="namespaceglobal__variables.html#ad8c6e0f43cbfebacfed34e1f1921ef92">H_number_density</a>
<a name="l00513"></a>00513     <span class="keyword">else</span> 
<a name="l00514"></a>00514       <span class="comment">! Three bodies reactions</span>
<a name="l00515"></a>00515       RATE = <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(I)*Y(reagent1_idx) * Y(reagent2_idx) * Y(reagent3_idx) * <a class="code" href="namespaceglobal__variables.html#ad8c6e0f43cbfebacfed34e1f1921ef92">H_number_density</a> * <a class="code" href="namespaceglobal__variables.html#ad8c6e0f43cbfebacfed34e1f1921ef92">H_number_density</a>
<a name="l00516"></a>00516     <span class="keyword">endif</span>
<a name="l00517"></a>00517   <span class="keyword">endif</span>
<a name="l00518"></a>00518 
<a name="l00519"></a>00519   YD2(product1_idx) = YD2(product1_idx) + RATE
<a name="l00520"></a>00520   YD2(product2_idx) = YD2(product2_idx) + RATE
<a name="l00521"></a>00521   YD2(product3_idx) = YD2(product3_idx) + RATE
<a name="l00522"></a>00522   YD2(product4_idx) = YD2(product4_idx) + RATE
<a name="l00523"></a>00523   YD2(reagent1_idx) = YD2(reagent1_idx) - RATE
<a name="l00524"></a>00524   YD2(reagent2_idx) = YD2(reagent2_idx) - RATE
<a name="l00525"></a>00525   YD2(reagent3_idx) = YD2(reagent3_idx) - RATE
<a name="l00526"></a>00526 <span class="keyword">enddo</span>   
<a name="l00527"></a>00527 
<a name="l00528"></a>00528 YDOT(1:<a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>) = YD2(1:<a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>)
<a name="l00529"></a>00529 
<a name="l00530"></a>00530 return
<a name="l00531"></a>00531 <span class="keyword">end subroutine get_temporal_derivatives</span>
<a name="l00532"></a>00532 
<a name="l00533"></a>00533 <span class="comment">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<a name="l00546"></a><a class="code" href="namespaceode__solver.html#a206b100daf9bc03a1aca5e40c4732222">00546</a>   <span class="keyword">subroutine </span><a class="code" href="namespaceode__solver.html#a206b100daf9bc03a1aca5e40c4732222">set_constant_rates</a>()
<a name="l00547"></a>00547 
<a name="l00548"></a>00548   use <span class="keywordflow">global_variables</span> 
<a name="l00549"></a>00549   
<a name="l00550"></a>00550   <span class="keyword">implicit none</span>
<a name="l00551"></a>00551 
<a name="l00552"></a>00552   <span class="comment">! Locals</span>
<a name="l00553"></a>00553   <span class="keywordtype">real(double_precision)</span> :: T300, TI, TSQ
<a name="l00554"></a>00554   <span class="keywordtype">integer</span> :: nsta, nfin
<a name="l00555"></a>00555   <span class="keywordtype">integer</span> :: k, j, w, m, n
<a name="l00556"></a>00556   <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(10)</span> :: indice
<a name="l00557"></a>00557   <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">dimension(10)</span> :: distmin, distmax
<a name="l00558"></a>00558 
<a name="l00559"></a>00559   T300=<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>/300.d0
<a name="l00560"></a>00560   TI=1.0d00/<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>
<a name="l00561"></a>00561   TSQ=SQRT(<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>)
<a name="l00562"></a>00562 
<a name="l00563"></a>00563   <span class="comment">! ====== Rxn ITYPE 0</span>
<a name="l00564"></a>00564   <span class="comment">! ITYPE 0: Gas phase reactions with GRAINS =) </span>
<a name="l00565"></a>00565   <span class="keyword">do</span> J=<a class="code" href="namespaceglobal__variables.html#a72678d4a3e42c7707c53312a0bfd820a">type_id_start</a>(0),<a class="code" href="namespaceglobal__variables.html#a8e042ab32439646714871e722e3b8c18">type_id_stop</a>(0)
<a name="l00566"></a>00566     <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J)=<a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)*(T300**<a class="code" href="namespaceglobal__variables.html#a0c9d606f40900a4e468d650830debcb9">RATE_B</a>(J))
<a name="l00567"></a>00567   <span class="keyword">enddo</span>
<a name="l00568"></a>00568 
<a name="l00569"></a>00569   <span class="comment">! In the case IS_GRAIN_REACTIONS eq 0, we still need the formation of H on the grains</span>
<a name="l00570"></a>00570   <span class="comment">! this is done with the XH species, reaction types 10 and 11</span>
<a name="l00571"></a>00571 
<a name="l00572"></a>00572   <span class="comment">! ====== Rxn ITYPE 10 and 11</span>
<a name="l00573"></a>00573   <span class="comment">! ITYPE 10 and 11: H2 formation on the grains when IS_GRAIN_REACTIONS eq 0</span>
<a name="l00574"></a>00574   <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#aad1529a525462ea536c9fa3f8a6d7595">IS_GRAIN_REACTIONS</a>.eq.0) <span class="keyword">then</span>
<a name="l00575"></a>00575     <span class="keyword">do</span> J=<a class="code" href="namespaceglobal__variables.html#a72678d4a3e42c7707c53312a0bfd820a">type_id_start</a>(10),<a class="code" href="namespaceglobal__variables.html#a8e042ab32439646714871e722e3b8c18">type_id_stop</a>(10)
<a name="l00576"></a>00576       <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J)=<a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)*1.186D7*exp(225.D0/<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>)**(-1)*<a class="code" href="namespaceglobal__variables.html#a9cfac828196dd36b6608931be24d610f">GTODN</a>/<a class="code" href="namespaceglobal__variables.html#ad8c6e0f43cbfebacfed34e1f1921ef92">H_number_density</a>
<a name="l00577"></a>00577     <span class="keyword">enddo</span>
<a name="l00578"></a>00578     <span class="keyword">do</span> J=<a class="code" href="namespaceglobal__variables.html#a72678d4a3e42c7707c53312a0bfd820a">type_id_start</a>(11),<a class="code" href="namespaceglobal__variables.html#a8e042ab32439646714871e722e3b8c18">type_id_stop</a>(11)       
<a name="l00579"></a>00579       <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J)=<a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)*(T300**<a class="code" href="namespaceglobal__variables.html#a0c9d606f40900a4e468d650830debcb9">RATE_B</a>(J))*<a class="code" href="namespaceglobal__variables.html#ad8c6e0f43cbfebacfed34e1f1921ef92">H_number_density</a>/<a class="code" href="namespaceglobal__variables.html#a9cfac828196dd36b6608931be24d610f">GTODN</a>
<a name="l00580"></a>00580     <span class="keyword">enddo</span>       
<a name="l00581"></a>00581   <span class="keyword">endif</span>
<a name="l00582"></a>00582 
<a name="l00583"></a>00583 
<a name="l00584"></a>00584   <span class="comment">! ====== Rxn ITYPE 1</span>
<a name="l00585"></a>00585   <span class="comment">! ITYPE 1: Photodissoc/ionisation with cosmic rays</span>
<a name="l00586"></a>00586   <span class="comment">! Add X-rays in case X_IONISATION_RATE is not 0</span>
<a name="l00587"></a>00587   <span class="keyword">do</span> J=<a class="code" href="namespaceglobal__variables.html#a72678d4a3e42c7707c53312a0bfd820a">type_id_start</a>(1),<a class="code" href="namespaceglobal__variables.html#a8e042ab32439646714871e722e3b8c18">type_id_stop</a>(1)
<a name="l00588"></a>00588     <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J)=<a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)*(<a class="code" href="namespaceglobal__variables.html#abcb701fe084819f14c57fb80f7c2b849">CR_IONISATION_RATE</a>+<a class="code" href="namespaceglobal__variables.html#a9ac1774271a2c98792808fb4ac91a316">X_IONISATION_RATE</a>)
<a name="l00589"></a>00589   <span class="keyword">enddo</span>
<a name="l00590"></a>00590   <span class="keyword">do</span> J=<a class="code" href="namespaceglobal__variables.html#a72678d4a3e42c7707c53312a0bfd820a">type_id_start</a>(2),<a class="code" href="namespaceglobal__variables.html#a8e042ab32439646714871e722e3b8c18">type_id_stop</a>(2)
<a name="l00591"></a>00591     <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J)=<a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)*(<a class="code" href="namespaceglobal__variables.html#abcb701fe084819f14c57fb80f7c2b849">CR_IONISATION_RATE</a>+<a class="code" href="namespaceglobal__variables.html#a9ac1774271a2c98792808fb4ac91a316">X_IONISATION_RATE</a>)
<a name="l00592"></a>00592   <span class="keyword">enddo</span>
<a name="l00593"></a>00593 
<a name="l00594"></a>00594   <span class="comment">! ====== Rxns ITYPE 4 - 8</span>
<a name="l00595"></a>00595   <span class="comment">! Bimolecular gas phase reactions - several possible formula </span>
<a name="l00596"></a>00596   W=1
<a name="l00597"></a>00597   NSTA=0
<a name="l00598"></a>00598   NFIN=0
<a name="l00599"></a>00599   distmin(:)=9999.d0
<a name="l00600"></a>00600   distmax(:)=9999.d0
<a name="l00601"></a>00601   <span class="keyword">do</span> J=4,8
<a name="l00602"></a>00602     <span class="keyword">if</span> ((<a class="code" href="namespaceglobal__variables.html#a72678d4a3e42c7707c53312a0bfd820a">type_id_start</a>(J).NE.0).AND.(NSTA.EQ.0)) NSTA=J
<a name="l00603"></a>00603     <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a8e042ab32439646714871e722e3b8c18">type_id_stop</a>(J).NE.0) NFIN=J
<a name="l00604"></a>00604   <span class="keyword">enddo</span>
<a name="l00605"></a>00605   <span class="keyword">do</span> J=<a class="code" href="namespaceglobal__variables.html#a72678d4a3e42c7707c53312a0bfd820a">type_id_start</a>(NSTA),<a class="code" href="namespaceglobal__variables.html#a8e042ab32439646714871e722e3b8c18">type_id_stop</a>(NFIN)
<a name="l00606"></a>00606 
<a name="l00607"></a>00607     <span class="comment">!---------------  KOOIJ FORMULA</span>
<a name="l00608"></a>00608     <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a1e033ea407b381eb3f391879a9299552">RATE_FORMULA</a>(J).eq.3) <span class="keyword">then</span>
<a name="l00609"></a>00609 
<a name="l00610"></a>00610       <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J)=<a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)*(T300**<a class="code" href="namespaceglobal__variables.html#a0c9d606f40900a4e468d650830debcb9">RATE_B</a>(J))*EXP(-<a class="code" href="namespaceglobal__variables.html#a6e0c0b9d7b2d7abb8cbc7e2a23f547f8">RATE_C</a>(J)/<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>)
<a name="l00611"></a>00611 
<a name="l00612"></a>00612       <span class="comment">! Check for temperature bounderies</span>
<a name="l00613"></a>00613       <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>.LT.<a class="code" href="namespaceglobal__variables.html#aa093eec56a61b33e3dac0a868586e505">REACTION_TMIN</a>(J)) <span class="keyword">then</span>
<a name="l00614"></a>00614         <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J)=<a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)*((<a class="code" href="namespaceglobal__variables.html#aa093eec56a61b33e3dac0a868586e505">REACTION_TMIN</a>(J)/300.D0)**<a class="code" href="namespaceglobal__variables.html#a0c9d606f40900a4e468d650830debcb9">RATE_B</a>(J))*EXP(-<a class="code" href="namespaceglobal__variables.html#a6e0c0b9d7b2d7abb8cbc7e2a23f547f8">RATE_C</a>(J)/<a class="code" href="namespaceglobal__variables.html#aa093eec56a61b33e3dac0a868586e505">REACTION_TMIN</a>(J))
<a name="l00615"></a>00615       <span class="keyword">endif</span>
<a name="l00616"></a>00616       <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>.GT.<a class="code" href="namespaceglobal__variables.html#ac12d031648f41ac6527b55a937780aa8">REACTION_TMAX</a>(J)) <span class="keyword">then</span>
<a name="l00617"></a>00617         <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J)=<a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)*((<a class="code" href="namespaceglobal__variables.html#ac12d031648f41ac6527b55a937780aa8">REACTION_TMAX</a>(J)/300.D0)**<a class="code" href="namespaceglobal__variables.html#a0c9d606f40900a4e468d650830debcb9">RATE_B</a>(J))*EXP(-<a class="code" href="namespaceglobal__variables.html#a6e0c0b9d7b2d7abb8cbc7e2a23f547f8">RATE_C</a>(J)/<a class="code" href="namespaceglobal__variables.html#ac12d031648f41ac6527b55a937780aa8">REACTION_TMAX</a>(J))
<a name="l00618"></a>00618       <span class="keyword">endif</span>
<a name="l00619"></a>00619 
<a name="l00620"></a>00620       <span class="comment">! Check for the presence of several rate coefficients present in the network for the</span>
<a name="l00621"></a>00621       <span class="comment">! the same reaction</span>
<a name="l00622"></a>00622       <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#ab57afaa2f7711c88f0187586a8f231f9">REACTION_ID</a>(J+1).EQ.<a class="code" href="namespaceglobal__variables.html#ab57afaa2f7711c88f0187586a8f231f9">REACTION_ID</a>(J)) <span class="keyword">then</span>
<a name="l00623"></a>00623         INDICE(W)=J
<a name="l00624"></a>00624         distmin(w)=<a class="code" href="namespaceglobal__variables.html#aa093eec56a61b33e3dac0a868586e505">REACTION_TMIN</a>(j)-<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>
<a name="l00625"></a>00625         distmax(w)=<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>-<a class="code" href="namespaceglobal__variables.html#ac12d031648f41ac6527b55a937780aa8">REACTION_TMAX</a>(j)
<a name="l00626"></a>00626         W = W + 1
<a name="l00627"></a>00627       <span class="keyword">endif</span>
<a name="l00628"></a>00628 
<a name="l00629"></a>00629       <span class="keyword">if</span> ((<a class="code" href="namespaceglobal__variables.html#ab57afaa2f7711c88f0187586a8f231f9">REACTION_ID</a>(J+1).NE.<a class="code" href="namespaceglobal__variables.html#ab57afaa2f7711c88f0187586a8f231f9">REACTION_ID</a>(J)).AND.(W.NE.1)) <span class="keyword">then</span>
<a name="l00630"></a>00630 
<a name="l00631"></a>00631         INDICE(W)=J
<a name="l00632"></a>00632         distmin(w)=<a class="code" href="namespaceglobal__variables.html#aa093eec56a61b33e3dac0a868586e505">REACTION_TMIN</a>(j)-<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>
<a name="l00633"></a>00633         distmax(w)=<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>-<a class="code" href="namespaceglobal__variables.html#ac12d031648f41ac6527b55a937780aa8">REACTION_TMAX</a>(j)
<a name="l00634"></a>00634 
<a name="l00635"></a>00635         <span class="keyword">do</span> M=1,W
<a name="l00636"></a>00636           N=INDICE(M)
<a name="l00637"></a>00637           <span class="comment">!if(IT==1) write(*,*) N,M, REACTION_SUBSTANCES_NAMES(:,N), REACTION_TMIN(N), REACTION_TMAX(N),distmin(M),distmax(M)</span>
<a name="l00638"></a>00638           <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>.LT.<a class="code" href="namespaceglobal__variables.html#aa093eec56a61b33e3dac0a868586e505">REACTION_TMIN</a>(N)) <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(N)=0.d0
<a name="l00639"></a>00639           <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>.GT.<a class="code" href="namespaceglobal__variables.html#ac12d031648f41ac6527b55a937780aa8">REACTION_TMAX</a>(N)) <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(N)=0.d0
<a name="l00640"></a>00640         <span class="keyword">enddo</span>
<a name="l00641"></a>00641 
<a name="l00642"></a>00642         <span class="keyword">if</span> (maxval(<a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(indice(1:w))).lt.1.d-99) <span class="keyword">then</span>
<a name="l00643"></a>00643 
<a name="l00644"></a>00644           <span class="keyword">if</span> (minval(abs(distmin)).lt.minval(abs(distmax))) <span class="keyword">then</span>
<a name="l00645"></a>00645             N=indice(minloc(abs(distmin),dim=1))
<a name="l00646"></a>00646             <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(N)=<a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(N)*((<a class="code" href="namespaceglobal__variables.html#aa093eec56a61b33e3dac0a868586e505">REACTION_TMIN</a>(N)/300.D0)**<a class="code" href="namespaceglobal__variables.html#a0c9d606f40900a4e468d650830debcb9">RATE_B</a>(N))*EXP(-<a class="code" href="namespaceglobal__variables.html#a6e0c0b9d7b2d7abb8cbc7e2a23f547f8">RATE_C</a>(N)/<a class="code" href="namespaceglobal__variables.html#aa093eec56a61b33e3dac0a868586e505">REACTION_TMIN</a>(N))
<a name="l00647"></a>00647           <span class="keyword">else</span>
<a name="l00648"></a>00648             N=indice(minloc(abs(distmax),dim=1))
<a name="l00649"></a>00649             <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(N)=<a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(N)*((<a class="code" href="namespaceglobal__variables.html#ac12d031648f41ac6527b55a937780aa8">REACTION_TMAX</a>(N)/300.D0)**<a class="code" href="namespaceglobal__variables.html#a0c9d606f40900a4e468d650830debcb9">RATE_B</a>(N))*EXP(-<a class="code" href="namespaceglobal__variables.html#a6e0c0b9d7b2d7abb8cbc7e2a23f547f8">RATE_C</a>(N)/<a class="code" href="namespaceglobal__variables.html#ac12d031648f41ac6527b55a937780aa8">REACTION_TMAX</a>(N))
<a name="l00650"></a>00650           <span class="keyword">endif</span>
<a name="l00651"></a>00651         <span class="keyword">endif</span>
<a name="l00652"></a>00652 
<a name="l00653"></a>00653         W=1
<a name="l00654"></a>00654         INDICE(:)=0
<a name="l00655"></a>00655         distmin(:)=9999.d0
<a name="l00656"></a>00656         distmax(:)=9999.d0
<a name="l00657"></a>00657       <span class="keyword">endif</span>
<a name="l00658"></a>00658     <span class="keyword">endif</span>
<a name="l00659"></a>00659 
<a name="l00660"></a>00660     <span class="comment">!---------------  IONPOL1 FORMULA</span>
<a name="l00661"></a>00661     <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a1e033ea407b381eb3f391879a9299552">RATE_FORMULA</a>(J).EQ.4) <span class="keyword">then</span>
<a name="l00662"></a>00662       <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J)=<a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)*<a class="code" href="namespaceglobal__variables.html#a0c9d606f40900a4e468d650830debcb9">RATE_B</a>(J)*(0.62d0+0.4767d0*<a class="code" href="namespaceglobal__variables.html#a6e0c0b9d7b2d7abb8cbc7e2a23f547f8">RATE_C</a>(J)*((300.D0/<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>)**0.5))
<a name="l00663"></a>00663 
<a name="l00664"></a>00664       <span class="comment">! Check for temperature bounderies</span>
<a name="l00665"></a>00665       <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>.LT.<a class="code" href="namespaceglobal__variables.html#aa093eec56a61b33e3dac0a868586e505">REACTION_TMIN</a>(J)) <span class="keyword">then</span>
<a name="l00666"></a>00666         <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J)=<a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)*<a class="code" href="namespaceglobal__variables.html#a0c9d606f40900a4e468d650830debcb9">RATE_B</a>(J)*(0.62d0+0.4767d0*<a class="code" href="namespaceglobal__variables.html#a6e0c0b9d7b2d7abb8cbc7e2a23f547f8">RATE_C</a>(J)*((300.D0/<a class="code" href="namespaceglobal__variables.html#aa093eec56a61b33e3dac0a868586e505">REACTION_TMIN</a>(J))**0.5))
<a name="l00667"></a>00667       <span class="keyword">endif</span>
<a name="l00668"></a>00668       <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>.GT.<a class="code" href="namespaceglobal__variables.html#ac12d031648f41ac6527b55a937780aa8">REACTION_TMAX</a>(J))  <span class="keyword">then</span>
<a name="l00669"></a>00669         <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J)=<a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)*<a class="code" href="namespaceglobal__variables.html#a0c9d606f40900a4e468d650830debcb9">RATE_B</a>(J)*(0.62d0+0.4767d0*<a class="code" href="namespaceglobal__variables.html#a6e0c0b9d7b2d7abb8cbc7e2a23f547f8">RATE_C</a>(J)*((300.D0/<a class="code" href="namespaceglobal__variables.html#ac12d031648f41ac6527b55a937780aa8">REACTION_TMAX</a>(J))**0.5))
<a name="l00670"></a>00670       <span class="keyword">endif</span>
<a name="l00671"></a>00671 
<a name="l00672"></a>00672       <span class="comment">! Check for the presence of several rate coefficients present in the network for the</span>
<a name="l00673"></a>00673       <span class="comment">! the same reaction</span>
<a name="l00674"></a>00674       <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#ab57afaa2f7711c88f0187586a8f231f9">REACTION_ID</a>(J+1).EQ.<a class="code" href="namespaceglobal__variables.html#ab57afaa2f7711c88f0187586a8f231f9">REACTION_ID</a>(J)) <span class="keyword">then</span>
<a name="l00675"></a>00675         INDICE(W)=J
<a name="l00676"></a>00676         distmin(w)=<a class="code" href="namespaceglobal__variables.html#aa093eec56a61b33e3dac0a868586e505">REACTION_TMIN</a>(j)-<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>
<a name="l00677"></a>00677         distmax(w)=<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>-<a class="code" href="namespaceglobal__variables.html#ac12d031648f41ac6527b55a937780aa8">REACTION_TMAX</a>(j)
<a name="l00678"></a>00678         W = W + 1
<a name="l00679"></a>00679       <span class="keyword">endif</span>
<a name="l00680"></a>00680 
<a name="l00681"></a>00681       <span class="keyword">if</span> ((<a class="code" href="namespaceglobal__variables.html#ab57afaa2f7711c88f0187586a8f231f9">REACTION_ID</a>(J+1).NE.<a class="code" href="namespaceglobal__variables.html#ab57afaa2f7711c88f0187586a8f231f9">REACTION_ID</a>(J)).AND.(W.NE.1)) <span class="keyword">then</span>
<a name="l00682"></a>00682 
<a name="l00683"></a>00683         INDICE(W)=J
<a name="l00684"></a>00684         distmin(w)=<a class="code" href="namespaceglobal__variables.html#aa093eec56a61b33e3dac0a868586e505">REACTION_TMIN</a>(j)-<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>
<a name="l00685"></a>00685         distmax(w)=<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>-<a class="code" href="namespaceglobal__variables.html#ac12d031648f41ac6527b55a937780aa8">REACTION_TMAX</a>(j)
<a name="l00686"></a>00686 
<a name="l00687"></a>00687         <span class="keyword">do</span> M=1,W
<a name="l00688"></a>00688           N=INDICE(M)
<a name="l00689"></a>00689           <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>.LT.<a class="code" href="namespaceglobal__variables.html#aa093eec56a61b33e3dac0a868586e505">REACTION_TMIN</a>(N)) <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(N)= 0.d0
<a name="l00690"></a>00690           <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>.GT.<a class="code" href="namespaceglobal__variables.html#ac12d031648f41ac6527b55a937780aa8">REACTION_TMAX</a>(N)) <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(N)= 0.d0
<a name="l00691"></a>00691         <span class="keyword">enddo</span>
<a name="l00692"></a>00692 
<a name="l00693"></a>00693         <span class="keyword">if</span> (maxval(<a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(indice(1:w))).lt.1.d-99) <span class="keyword">then</span>
<a name="l00694"></a>00694           <span class="keyword">if</span> (minval(abs(distmin)).lt.minval(abs(distmax))) <span class="keyword">then</span>
<a name="l00695"></a>00695             N=indice(minloc(abs(distmin),dim=1))
<a name="l00696"></a>00696             <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(N)=<a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(N)*<a class="code" href="namespaceglobal__variables.html#a0c9d606f40900a4e468d650830debcb9">RATE_B</a>(N)*(0.62d0+0.4767d0*<a class="code" href="namespaceglobal__variables.html#a6e0c0b9d7b2d7abb8cbc7e2a23f547f8">RATE_C</a>(N)*((300.D0/<a class="code" href="namespaceglobal__variables.html#aa093eec56a61b33e3dac0a868586e505">REACTION_TMIN</a>(N))**0.5))
<a name="l00697"></a>00697           <span class="keyword">else</span>
<a name="l00698"></a>00698             N=indice(minloc(abs(distmax),dim=1))
<a name="l00699"></a>00699             <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(N)=<a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(N)*<a class="code" href="namespaceglobal__variables.html#a0c9d606f40900a4e468d650830debcb9">RATE_B</a>(N)*(0.62d0+0.4767d0*<a class="code" href="namespaceglobal__variables.html#a6e0c0b9d7b2d7abb8cbc7e2a23f547f8">RATE_C</a>(N)*((300.D0/<a class="code" href="namespaceglobal__variables.html#ac12d031648f41ac6527b55a937780aa8">REACTION_TMAX</a>(N))**0.5))
<a name="l00700"></a>00700           <span class="keyword">endif</span>
<a name="l00701"></a>00701         <span class="keyword">endif</span>
<a name="l00702"></a>00702 
<a name="l00703"></a>00703         W=1
<a name="l00704"></a>00704         INDICE(:)=0
<a name="l00705"></a>00705         distmin(:)=9999.d0
<a name="l00706"></a>00706         distmax(:)=9999.d0
<a name="l00707"></a>00707       <span class="keyword">endif</span>
<a name="l00708"></a>00708     <span class="keyword">endif</span>
<a name="l00709"></a>00709 
<a name="l00710"></a>00710     <span class="comment">!---------------  IONPOL2 FORMULA</span>
<a name="l00711"></a>00711     <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a1e033ea407b381eb3f391879a9299552">RATE_FORMULA</a>(J).EQ.5) <span class="keyword">then</span>
<a name="l00712"></a>00712       
<a name="l00713"></a>00713       <span class="comment">! Check for temperature boundaries and apply the formula in consequence</span>
<a name="l00714"></a>00714       <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>.LT.<a class="code" href="namespaceglobal__variables.html#aa093eec56a61b33e3dac0a868586e505">REACTION_TMIN</a>(J)) <span class="keyword">then</span>
<a name="l00715"></a>00715         <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J) = <a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)*<a class="code" href="namespaceglobal__variables.html#a0c9d606f40900a4e468d650830debcb9">RATE_B</a>(J)*((1.d0+0.0967*<a class="code" href="namespaceglobal__variables.html#a6e0c0b9d7b2d7abb8cbc7e2a23f547f8">RATE_C</a>(J)*(300.D0/<a class="code" href="namespaceglobal__variables.html#aa093eec56a61b33e3dac0a868586e505">REACTION_TMIN</a>(J))**0.5)+&amp;
<a name="l00716"></a>00716                            (<a class="code" href="namespaceglobal__variables.html#a6e0c0b9d7b2d7abb8cbc7e2a23f547f8">RATE_C</a>(J)**2*300.d0/(10.526*<a class="code" href="namespaceglobal__variables.html#aa093eec56a61b33e3dac0a868586e505">REACTION_TMIN</a>(J))))
<a name="l00717"></a>00717       <span class="keyword">else</span> <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>.GT.<a class="code" href="namespaceglobal__variables.html#ac12d031648f41ac6527b55a937780aa8">REACTION_TMAX</a>(J)) <span class="keyword">then</span>
<a name="l00718"></a>00718         <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J) = <a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)*<a class="code" href="namespaceglobal__variables.html#a0c9d606f40900a4e468d650830debcb9">RATE_B</a>(J)*((1.d0+0.0967*<a class="code" href="namespaceglobal__variables.html#a6e0c0b9d7b2d7abb8cbc7e2a23f547f8">RATE_C</a>(J)*(300.D0/<a class="code" href="namespaceglobal__variables.html#ac12d031648f41ac6527b55a937780aa8">REACTION_TMAX</a>(J))**0.5)+&amp;
<a name="l00719"></a>00719                            (<a class="code" href="namespaceglobal__variables.html#a6e0c0b9d7b2d7abb8cbc7e2a23f547f8">RATE_C</a>(J)**2*300.d0/(10.526*<a class="code" href="namespaceglobal__variables.html#ac12d031648f41ac6527b55a937780aa8">REACTION_TMAX</a>(J))))
<a name="l00720"></a>00720       <span class="keyword">else</span>
<a name="l00721"></a>00721         <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J) = <a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)*<a class="code" href="namespaceglobal__variables.html#a0c9d606f40900a4e468d650830debcb9">RATE_B</a>(J)*((1.d0+0.0967*<a class="code" href="namespaceglobal__variables.html#a6e0c0b9d7b2d7abb8cbc7e2a23f547f8">RATE_C</a>(J)*(300.D0/<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>)**0.5)+&amp;
<a name="l00722"></a>00722                            (<a class="code" href="namespaceglobal__variables.html#a6e0c0b9d7b2d7abb8cbc7e2a23f547f8">RATE_C</a>(J)**2*300.d0/(10.526*<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>)))
<a name="l00723"></a>00723       <span class="keyword">endif</span>
<a name="l00724"></a>00724 
<a name="l00725"></a>00725       <span class="comment">! Check for the presence of several rate coefficients present in the network for the</span>
<a name="l00726"></a>00726       <span class="comment">!! the same reaction</span>
<a name="l00727"></a>00727       <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#ab57afaa2f7711c88f0187586a8f231f9">REACTION_ID</a>(J+1).EQ.<a class="code" href="namespaceglobal__variables.html#ab57afaa2f7711c88f0187586a8f231f9">REACTION_ID</a>(J)) <span class="keyword">then</span>
<a name="l00728"></a>00728         INDICE(W)=J
<a name="l00729"></a>00729         distmin(w)=<a class="code" href="namespaceglobal__variables.html#aa093eec56a61b33e3dac0a868586e505">REACTION_TMIN</a>(j)-<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>
<a name="l00730"></a>00730         distmax(w)=<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>-<a class="code" href="namespaceglobal__variables.html#ac12d031648f41ac6527b55a937780aa8">REACTION_TMAX</a>(j)
<a name="l00731"></a>00731         W = W + 1
<a name="l00732"></a>00732       <span class="keyword">endif</span>
<a name="l00733"></a>00733 
<a name="l00734"></a>00734       <span class="keyword">if</span> ((<a class="code" href="namespaceglobal__variables.html#ab57afaa2f7711c88f0187586a8f231f9">REACTION_ID</a>(J+1).NE.<a class="code" href="namespaceglobal__variables.html#ab57afaa2f7711c88f0187586a8f231f9">REACTION_ID</a>(J)).AND.(W.NE.1)) <span class="keyword">then</span>
<a name="l00735"></a>00735 
<a name="l00736"></a>00736         INDICE(W)=J
<a name="l00737"></a>00737         distmin(w)=<a class="code" href="namespaceglobal__variables.html#aa093eec56a61b33e3dac0a868586e505">REACTION_TMIN</a>(j)-<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>
<a name="l00738"></a>00738         distmax(w)=<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>-<a class="code" href="namespaceglobal__variables.html#ac12d031648f41ac6527b55a937780aa8">REACTION_TMAX</a>(j)
<a name="l00739"></a>00739 
<a name="l00740"></a>00740         <span class="keyword">do</span> M=1,W
<a name="l00741"></a>00741           N=INDICE(M)
<a name="l00742"></a>00742           <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>.LT.<a class="code" href="namespaceglobal__variables.html#aa093eec56a61b33e3dac0a868586e505">REACTION_TMIN</a>(N)) <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(N)= 0.d0
<a name="l00743"></a>00743           <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>.GT.<a class="code" href="namespaceglobal__variables.html#ac12d031648f41ac6527b55a937780aa8">REACTION_TMAX</a>(N)) <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(N)= 0.d0
<a name="l00744"></a>00744         <span class="keyword">enddo</span>
<a name="l00745"></a>00745 
<a name="l00746"></a>00746         <span class="keyword">if</span> (maxval(<a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(indice(1:w))).lt.1.d-99) <span class="keyword">then</span>
<a name="l00747"></a>00747           <span class="keyword">if</span> (minval(abs(distmin)).lt.minval(abs(distmax))) <span class="keyword">then</span>
<a name="l00748"></a>00748             N=indice(minloc(abs(distmin),dim=1))
<a name="l00749"></a>00749             <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(N)=<a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(N)*<a class="code" href="namespaceglobal__variables.html#a0c9d606f40900a4e468d650830debcb9">RATE_B</a>(N)*((1.d0+0.0967*<a class="code" href="namespaceglobal__variables.html#a6e0c0b9d7b2d7abb8cbc7e2a23f547f8">RATE_C</a>(N)*(300.D0/<a class="code" href="namespaceglobal__variables.html#aa093eec56a61b33e3dac0a868586e505">REACTION_TMIN</a>(N))**0.5) + &amp;
<a name="l00750"></a>00750                               (<a class="code" href="namespaceglobal__variables.html#a6e0c0b9d7b2d7abb8cbc7e2a23f547f8">RATE_C</a>(N)**2*300.d0/(10.526*<a class="code" href="namespaceglobal__variables.html#aa093eec56a61b33e3dac0a868586e505">REACTION_TMIN</a>(N))))
<a name="l00751"></a>00751           <span class="keyword">else</span>
<a name="l00752"></a>00752             N=indice(minloc(abs(distmax),dim=1))
<a name="l00753"></a>00753             <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(N)=<a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(N)*<a class="code" href="namespaceglobal__variables.html#a0c9d606f40900a4e468d650830debcb9">RATE_B</a>(N)*((1.d0+0.0967*<a class="code" href="namespaceglobal__variables.html#a6e0c0b9d7b2d7abb8cbc7e2a23f547f8">RATE_C</a>(N)*(300.D0/<a class="code" href="namespaceglobal__variables.html#ac12d031648f41ac6527b55a937780aa8">REACTION_TMAX</a>(N))**0.5) + &amp;
<a name="l00754"></a>00754                               (<a class="code" href="namespaceglobal__variables.html#a6e0c0b9d7b2d7abb8cbc7e2a23f547f8">RATE_C</a>(N)**2*300.d0/(10.526*<a class="code" href="namespaceglobal__variables.html#ac12d031648f41ac6527b55a937780aa8">REACTION_TMAX</a>(N))))
<a name="l00755"></a>00755           <span class="keyword">endif</span>
<a name="l00756"></a>00756         <span class="keyword">endif</span>
<a name="l00757"></a>00757 
<a name="l00758"></a>00758         W=1
<a name="l00759"></a>00759         INDICE(:)=0
<a name="l00760"></a>00760         distmin(:)=9999.d0
<a name="l00761"></a>00761         distmax(:)=9999.d0
<a name="l00762"></a>00762       <span class="keyword">endif</span>
<a name="l00763"></a>00763     <span class="keyword">endif</span>
<a name="l00764"></a>00764   <span class="keyword">enddo</span>
<a name="l00765"></a>00765 
<a name="l00766"></a>00766   <span class="comment">! === Grain surfaces</span>
<a name="l00767"></a>00767   <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#aad1529a525462ea536c9fa3f8a6d7595">IS_GRAIN_REACTIONS</a>.NE.0) <span class="keyword">then</span>
<a name="l00768"></a>00768 
<a name="l00769"></a>00769     <span class="comment">! ========= Set diffusion and evaporation rates (s-1)</span>
<a name="l00770"></a>00770     <span class="keyword">do</span> K=1,<a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>
<a name="l00771"></a>00771       <a class="code" href="namespaceglobal__variables.html#a61ca7748d102a947d8902ba4f2adda23">THERMAL_HOPING_RATE</a>(K)=<a class="code" href="namespaceglobal__variables.html#a9738bb8e36977d51077f387b8bdd3b6f">VIBRATION_FREQUENCY</a>(K)*EXP(-<a class="code" href="namespaceglobal__variables.html#aa6d4549f6514a683b826a4eb793af87b">DIFFUSION_BARRIER</a>(K)/<a class="code" href="namespaceglobal__variables.html#ab165b9b5b824a85985f8b99f82e1ae67">dust_temperature</a>)/<a class="code" href="namespaceglobal__variables.html#ad8d5a490d2fca20f34af76035faa7fa3">nb_sites_per_grain</a>
<a name="l00772"></a>00772       <a class="code" href="namespaceglobal__variables.html#a9cdae96536bbf5236fcac9adfc614c48">CR_HOPING_RATE</a>(K)=<a class="code" href="namespaceglobal__variables.html#a9738bb8e36977d51077f387b8bdd3b6f">VIBRATION_FREQUENCY</a>(K)*EXP(-<a class="code" href="namespaceglobal__variables.html#aa6d4549f6514a683b826a4eb793af87b">DIFFUSION_BARRIER</a>(K)/<a class="code" href="namespaceglobal__variables.html#a90a711b3b4b07b0409a3d620b63bc3a2">PEAK_GRAIN_TEMPERATURE</a>)/<a class="code" href="namespaceglobal__variables.html#ad8d5a490d2fca20f34af76035faa7fa3">nb_sites_per_grain</a>
<a name="l00773"></a>00773       <a class="code" href="namespaceglobal__variables.html#ad51816e8243bdccecada423cb0f8e067">EVAPORATION_RATES</a>(K)=<a class="code" href="namespaceglobal__variables.html#a9738bb8e36977d51077f387b8bdd3b6f">VIBRATION_FREQUENCY</a>(K)*EXP(-<a class="code" href="namespaceglobal__variables.html#a6179169c5c738be9ae0caa2b49c74e8b">DESORPTION_ENERGY</a>(K)/<a class="code" href="namespaceglobal__variables.html#ab165b9b5b824a85985f8b99f82e1ae67">dust_temperature</a>)
<a name="l00774"></a>00774       <a class="code" href="namespaceglobal__variables.html#a621bd19199d43b32968f92bd60fda8af">EVAPORATION_RATESCR</a>(K)=<a class="code" href="namespaceglobal__variables.html#a9738bb8e36977d51077f387b8bdd3b6f">VIBRATION_FREQUENCY</a>(K)*EXP(-<a class="code" href="namespaceglobal__variables.html#a6179169c5c738be9ae0caa2b49c74e8b">DESORPTION_ENERGY</a>(K)/<a class="code" href="namespaceglobal__variables.html#a90a711b3b4b07b0409a3d620b63bc3a2">PEAK_GRAIN_TEMPERATURE</a>)
<a name="l00775"></a>00775     <span class="keyword">enddo</span>
<a name="l00776"></a>00776 
<a name="l00777"></a>00777     <span class="comment">! ========= Rxn ITYPE 15 - thermal evaporation</span>
<a name="l00778"></a>00778     <span class="comment">! ITYPE 15: Thermal evaporation</span>
<a name="l00779"></a>00779     <span class="keyword">do</span> J=<a class="code" href="namespaceglobal__variables.html#a72678d4a3e42c7707c53312a0bfd820a">type_id_start</a>(15),<a class="code" href="namespaceglobal__variables.html#a8e042ab32439646714871e722e3b8c18">type_id_stop</a>(15)
<a name="l00780"></a>00780       <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J)=<a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)*<a class="code" href="namespaceglobal__variables.html#ad7d83bc1fcb7d6d1545cba39d875052a">branching_ratio</a>(J)*<a class="code" href="namespaceglobal__variables.html#ad51816e8243bdccecada423cb0f8e067">EVAPORATION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))
<a name="l00781"></a>00781     <span class="keyword">enddo</span>
<a name="l00782"></a>00782 
<a name="l00783"></a>00783     <span class="comment">! ========= Rxn ITYPE 16</span>
<a name="l00784"></a>00784     <span class="comment">! ITYPE 16: Cosmic-ray evaporation</span>
<a name="l00785"></a>00785     <span class="keyword">do</span> J=<a class="code" href="namespaceglobal__variables.html#a72678d4a3e42c7707c53312a0bfd820a">type_id_start</a>(16),<a class="code" href="namespaceglobal__variables.html#a8e042ab32439646714871e722e3b8c18">type_id_stop</a>(16)
<a name="l00786"></a>00786       <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J)=<a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)*<a class="code" href="namespaceglobal__variables.html#ad7d83bc1fcb7d6d1545cba39d875052a">branching_ratio</a>(J)*((<a class="code" href="namespaceglobal__variables.html#abcb701fe084819f14c57fb80f7c2b849">CR_IONISATION_RATE</a>+<a class="code" href="namespaceglobal__variables.html#a9ac1774271a2c98792808fb4ac91a316">X_IONISATION_RATE</a>)/1.3D-17)&amp;
<a name="l00787"></a>00787       *<a class="code" href="namespaceglobal__variables.html#a9738bb8e36977d51077f387b8bdd3b6f">VIBRATION_FREQUENCY</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))*<a class="code" href="namespaceglobal__variables.html#a403f3bbb5987b974e2929ce8aa4b930b">CRFE</a>*<a class="code" href="namespaceglobal__variables.html#a54a6d7ffd8bd175bdd1a736d0f9c7653">PEAK_DURATION</a>*EXP(-<a class="code" href="namespaceglobal__variables.html#a6179169c5c738be9ae0caa2b49c74e8b">DESORPTION_ENERGY</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))/<a class="code" href="namespaceglobal__variables.html#a90a711b3b4b07b0409a3d620b63bc3a2">PEAK_GRAIN_TEMPERATURE</a>)
<a name="l00788"></a>00788     <span class="keyword">enddo</span>
<a name="l00789"></a>00789 
<a name="l00790"></a>00790 
<a name="l00791"></a>00791     <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a72678d4a3e42c7707c53312a0bfd820a">type_id_start</a>(98).ne.0) <span class="keyword">then</span>
<a name="l00792"></a>00792       <span class="comment">! ========= Rxn ITYPE 98 test the storage of H2S under a refractory form</span>
<a name="l00793"></a>00793       <span class="comment">! ITYPE 98: storage of H2S under a refractory form</span>
<a name="l00794"></a>00794       <span class="keyword">do</span> j=<a class="code" href="namespaceglobal__variables.html#a72678d4a3e42c7707c53312a0bfd820a">type_id_start</a>(98),<a class="code" href="namespaceglobal__variables.html#a8e042ab32439646714871e722e3b8c18">type_id_stop</a>(98)
<a name="l00795"></a>00795         <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J)=<a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)*(T300**<a class="code" href="namespaceglobal__variables.html#a0c9d606f40900a4e468d650830debcb9">RATE_B</a>(J))*EXP(-<a class="code" href="namespaceglobal__variables.html#a6e0c0b9d7b2d7abb8cbc7e2a23f547f8">RATE_C</a>(J)*TI)
<a name="l00796"></a>00796       <span class="keyword">enddo</span>
<a name="l00797"></a>00797     <span class="keyword">endif</span>
<a name="l00798"></a>00798 
<a name="l00799"></a>00799 
<a name="l00800"></a>00800     <span class="comment">! ====== Rxn ITYPE 17</span>
<a name="l00801"></a>00801     <span class="comment">! ITYPE 17: Photodissociations by Cosmic rays on grain surfaces</span>
<a name="l00802"></a>00802     <span class="comment">! Add X-rays in case X_IONISATION_RATE is not 0</span>
<a name="l00803"></a>00803     <span class="keyword">do</span> J=<a class="code" href="namespaceglobal__variables.html#a72678d4a3e42c7707c53312a0bfd820a">type_id_start</a>(17),<a class="code" href="namespaceglobal__variables.html#a8e042ab32439646714871e722e3b8c18">type_id_stop</a>(17)
<a name="l00804"></a>00804       <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J)=<a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)*(<a class="code" href="namespaceglobal__variables.html#abcb701fe084819f14c57fb80f7c2b849">CR_IONISATION_RATE</a> + <a class="code" href="namespaceglobal__variables.html#a9ac1774271a2c98792808fb4ac91a316">X_IONISATION_RATE</a>)
<a name="l00805"></a>00805     <span class="keyword">enddo</span>
<a name="l00806"></a>00806 
<a name="l00807"></a>00807     <span class="comment">! ====== Rxn ITYPE 18</span>
<a name="l00808"></a>00808     <span class="comment">! ITYPE 18: Photodissociations by Cosmic rays on grain surfaces</span>
<a name="l00809"></a>00809     <span class="keyword">do</span> J=<a class="code" href="namespaceglobal__variables.html#a72678d4a3e42c7707c53312a0bfd820a">type_id_start</a>(18),<a class="code" href="namespaceglobal__variables.html#a8e042ab32439646714871e722e3b8c18">type_id_stop</a>(18)
<a name="l00810"></a>00810       <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J)=<a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)*(<a class="code" href="namespaceglobal__variables.html#abcb701fe084819f14c57fb80f7c2b849">CR_IONISATION_RATE</a>+<a class="code" href="namespaceglobal__variables.html#a9ac1774271a2c98792808fb4ac91a316">X_IONISATION_RATE</a>)
<a name="l00811"></a>00811     <span class="keyword">enddo</span>
<a name="l00812"></a>00812 
<a name="l00813"></a>00813   <span class="keyword">endif</span>
<a name="l00814"></a>00814 
<a name="l00815"></a>00815   <span class="comment">! When dust is turned off, zero all dust rates==========================</span>
<a name="l00816"></a>00816   <span class="keyword">if</span> ((<a class="code" href="namespaceglobal__variables.html#aad1529a525462ea536c9fa3f8a6d7595">IS_GRAIN_REACTIONS</a>.EQ.0).AND.(<a class="code" href="namespaceglobal__variables.html#aa4c5d6aebbab967a09d481f86f109eb3">timestep</a>.EQ.1)) <span class="keyword">then</span>
<a name="l00817"></a>00817     <span class="keyword">do</span> J=<a class="code" href="namespaceglobal__variables.html#a72678d4a3e42c7707c53312a0bfd820a">type_id_start</a>(14),<a class="code" href="namespaceglobal__variables.html#a8e042ab32439646714871e722e3b8c18">type_id_stop</a>(99)
<a name="l00818"></a>00818       <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J)=0.d0
<a name="l00819"></a>00819       <a class="code" href="namespaceglobal__variables.html#ad7d83bc1fcb7d6d1545cba39d875052a">branching_ratio</a>(J)=0.d0
<a name="l00820"></a>00820     <span class="keyword">enddo</span>
<a name="l00821"></a>00821   <span class="keyword">endif</span>
<a name="l00822"></a>00822 
<a name="l00823"></a>00823 
<a name="l00824"></a>00824   return
<a name="l00825"></a>00825 <span class="keyword">  end subroutine set_constant_rates</span>
<a name="l00826"></a>00826   
<a name="l00827"></a>00827 <span class="comment">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<a name="l00838"></a><a class="code" href="namespaceode__solver.html#a64d20641c5a00a70ff85ee375eb619d5">00838</a>   <span class="keyword">subroutine </span><a class="code" href="namespaceode__solver.html#a64d20641c5a00a70ff85ee375eb619d5">set_dependant_rates</a>(Y)
<a name="l00839"></a>00839 
<a name="l00840"></a>00840   use <span class="keywordflow">global_variables</span> 
<a name="l00841"></a>00841   
<a name="l00842"></a>00842   <span class="keyword">implicit none</span>
<a name="l00843"></a>00843   
<a name="l00844"></a>00844   <span class="comment">! Inputs</span>
<a name="l00845"></a>00845   <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(in)</span>, <span class="keywordtype">dimension(nb_species)</span> :: Y <span class="comment">!&lt; [in] abundances</span>
<a name="l00846"></a>00846 
<a name="l00847"></a>00847   <span class="comment">! Locals</span>
<a name="l00848"></a>00848   <span class="keywordtype">real(double_precision)</span> :: ACTIV,BARR,DIFF,ACTIVCR,BARRCR,DIFFCR
<a name="l00849"></a>00849   <span class="keywordtype">real(double_precision)</span> :: XNH2,XNCO
<a name="l00850"></a>00850   <span class="keywordtype">real(double_precision)</span> :: TETABIS,TETABIS1,TETABIS2,TETABIS3
<a name="l00851"></a>00851   <span class="keywordtype">real(double_precision)</span> :: T300, TI, TSQ
<a name="l00852"></a>00852   <span class="keywordtype">real(double_precision)</span> :: YMOD1, YMOD2
<a name="l00853"></a>00853   <span class="keywordtype">integer</span> IMOD1,IMOD2
<a name="l00854"></a>00854   <span class="keywordtype">integer</span> :: j, l
<a name="l00855"></a>00855   <span class="keywordtype">REAL(double_precision)</span> :: XNDTOT         <span class="comment">! Sum of all abundances on grain surfaces</span>
<a name="l00856"></a>00856                                            <span class="comment">! Used to compute the photodesorption by FUV photons</span>
<a name="l00857"></a>00857                                            <span class="comment">! proposed by Hassel,G and following Oberg mesurments</span>
<a name="l00858"></a>00858   <span class="keywordtype">REAL(double_precision)</span> :: MLAY           <span class="comment">! Number of layers from which species can desorb</span>
<a name="l00859"></a>00859   <span class="keywordtype">REAL(double_precision)</span> :: SUMLAY         <span class="comment">! Total number of layers on the grain surface</span>
<a name="l00860"></a>00860   <span class="keywordtype">REAL(double_precision)</span> :: UVCR           <span class="comment">! Scaling factor for CR generated UV</span>
<a name="l00861"></a>00861                                            <span class="comment">! The reference used is 1.3x10^-17 s-1</span>
<a name="l00862"></a>00862 
<a name="l00863"></a>00863 
<a name="l00864"></a>00864   T300=<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>/300.d0
<a name="l00865"></a>00865   TI=1.0d00/<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>
<a name="l00866"></a>00866   TSQ=SQRT(<a class="code" href="namespaceglobal__variables.html#ab9dd50afd8abd86bbd3380d959de6a92">gas_temperature</a>)
<a name="l00867"></a>00867 
<a name="l00868"></a>00868   XNH2=Y(indH2)
<a name="l00869"></a>00869   XNCO=Y(indCO)
<a name="l00870"></a>00870   
<a name="l00871"></a>00871   XNDTOT = 0.d0
<a name="l00872"></a>00872   <span class="keyword">do</span> J = <a class="code" href="namespaceglobal__variables.html#a92f61eb7a88fe738db011101272fe3c2">nb_gaseous_species</a>+1,<a class="code" href="namespaceglobal__variables.html#ad04596284d512f27430cf16e116b11b8">nb_species</a>
<a name="l00873"></a>00873     <span class="keyword">if</span>(<a class="code" href="namespaceglobal__variables.html#a04617384cd2be82e5e894bfd695d9a5d">species_name</a>(J)(:1).NE.<span class="stringliteral">&#39;J          &#39;</span>) PRINT*, <span class="stringliteral">&quot;Warning: sum of all the species present on &quot;</span>, &amp;
<a name="l00874"></a>00874                                                   &amp; <span class="stringliteral">&quot;grain surface include gas-phase species&quot;</span>
<a name="l00875"></a>00875     XNDTOT = XNDTOT + Y(J)
<a name="l00876"></a>00876   <span class="keyword">enddo</span>
<a name="l00877"></a>00877 
<a name="l00878"></a>00878   MLAY = 5.d0
<a name="l00879"></a>00879   SUMLAY = XNDTOT*<a class="code" href="namespaceglobal__variables.html#a9cfac828196dd36b6608931be24d610f">GTODN</a>/<a class="code" href="namespaceglobal__variables.html#ad8d5a490d2fca20f34af76035faa7fa3">nb_sites_per_grain</a>
<a name="l00880"></a>00880   UVCR = 1.300d-17 / <a class="code" href="namespaceglobal__variables.html#abcb701fe084819f14c57fb80f7c2b849">CR_IONISATION_RATE</a>
<a name="l00881"></a>00881 
<a name="l00882"></a>00882   <span class="comment">!PRINT*, MLAY, SUMLAY</span>
<a name="l00883"></a>00883 
<a name="l00884"></a>00884 
<a name="l00885"></a>00885   <span class="comment">! Density/Av-dependent==================================================</span>
<a name="l00886"></a>00886   <span class="comment">!</span>
<a name="l00887"></a>00887   <span class="comment">! VW 02/07 the treatment for the H2 and CO photodissociation was corrected</span>
<a name="l00888"></a>00888   <span class="comment">! for larger and smaller values of H2, CO column densities and Av not in the </span>
<a name="l00889"></a>00889   <span class="comment">! data tables. I also added the choice of using this approximation in gg_control.d</span>
<a name="l00890"></a>00890   <span class="comment">!</span>
<a name="l00891"></a>00891   <span class="comment">! ====== Rxn ITYPE 13</span>
<a name="l00892"></a>00892   <span class="comment">! ITYPE 2: Gas phase photodissociations/ionisations by UV</span>
<a name="l00893"></a>00893   <span class="keyword">do</span> J=<a class="code" href="namespaceglobal__variables.html#a72678d4a3e42c7707c53312a0bfd820a">type_id_start</a>(3),<a class="code" href="namespaceglobal__variables.html#a8e042ab32439646714871e722e3b8c18">type_id_stop</a>(3)
<a name="l00894"></a>00894     <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J)=<a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)*EXP(-<a class="code" href="namespaceglobal__variables.html#a6e0c0b9d7b2d7abb8cbc7e2a23f547f8">RATE_C</a>(J)*<a class="code" href="namespaceglobal__variables.html#a70719d43ec2f69b5c28c61897ab75aab">visual_extinction</a>)*<a class="code" href="namespaceglobal__variables.html#a22c25f3a7738bb754b2da9a33197668b">UV_FLUX</a>
<a name="l00895"></a>00895 
<a name="l00896"></a>00896     <span class="comment">! MODIFY THE H2 AND CO PHOTODISSOCIATION if IS_ABSORPTION EQ 1</span>
<a name="l00897"></a>00897     <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#af8a4262f63596ad8657d1cf0ac3b3840">IS_ABSORPTION</a>.EQ.1) <span class="keyword">then</span> 
<a name="l00898"></a>00898 
<a name="l00899"></a>00899       <span class="comment">! ====== Compute the H2 self-shielding</span>
<a name="l00900"></a>00900       <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J).EQ.<a class="code" href="namespaceglobal__variables.html#a332b8c2284d5cc1745d4ca18c15b0e94">YH2</a>) <span class="keyword">then</span>
<a name="l00901"></a>00901         TETABIS=1.D0
<a name="l00902"></a>00902 
<a name="l00903"></a>00903         <a class="code" href="namespaceglobal__variables.html#abbcb53eabba6615b09054867432db21e">NH2</a> = <a class="code" href="namespaceglobal__variables.html#a70719d43ec2f69b5c28c61897ab75aab">visual_extinction</a>/<a class="code" href="namespaceglobal__variables.html#a032ebc8d525bc95b1df9f75738ed4568">AV_NH_ratio</a> * XNH2
<a name="l00904"></a>00904 
<a name="l00905"></a>00905         <span class="comment">! ======= Linear extrapolation of the shielding factors</span>
<a name="l00906"></a>00906         <span class="keyword">do</span> L=1,<a class="code" href="namespaceshielding.html#a574c0dc650bc48ec8a009e4d7d76702c">NL1</a>-1
<a name="l00907"></a>00907           <span class="keyword">if</span> ((<a class="code" href="namespaceshielding.html#a2c746ef62645d68a4fbde6802aa2f475">N1H2</a>(L).LE.<a class="code" href="namespaceglobal__variables.html#abbcb53eabba6615b09054867432db21e">NH2</a>).AND.(<a class="code" href="namespaceshielding.html#a2c746ef62645d68a4fbde6802aa2f475">N1H2</a>(L+1).GE.<a class="code" href="namespaceglobal__variables.html#abbcb53eabba6615b09054867432db21e">NH2</a>)) <span class="keyword">then</span>
<a name="l00908"></a>00908             TETABIS=<a class="code" href="namespaceshielding.html#a8e09964d8ac5fda8b17352f7c249f197">T1H2</a>(L)+(<a class="code" href="namespaceglobal__variables.html#abbcb53eabba6615b09054867432db21e">NH2</a>-<a class="code" href="namespaceshielding.html#a2c746ef62645d68a4fbde6802aa2f475">N1H2</a>(L))*(<a class="code" href="namespaceshielding.html#a8e09964d8ac5fda8b17352f7c249f197">T1H2</a>(L+1)-<a class="code" href="namespaceshielding.html#a8e09964d8ac5fda8b17352f7c249f197">T1H2</a>(L))/(<a class="code" href="namespaceshielding.html#a2c746ef62645d68a4fbde6802aa2f475">N1H2</a>(L+1)-<a class="code" href="namespaceshielding.html#a2c746ef62645d68a4fbde6802aa2f475">N1H2</a>(L))
<a name="l00909"></a>00909           <span class="keyword">endif</span>
<a name="l00910"></a>00910         <span class="keyword">enddo</span>
<a name="l00911"></a>00911         <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#abbcb53eabba6615b09054867432db21e">NH2</a>.GT.<a class="code" href="namespaceshielding.html#a2c746ef62645d68a4fbde6802aa2f475">N1H2</a>(<a class="code" href="namespaceshielding.html#a574c0dc650bc48ec8a009e4d7d76702c">NL1</a>)) TETABIS = <a class="code" href="namespaceshielding.html#a8e09964d8ac5fda8b17352f7c249f197">T1H2</a>(<a class="code" href="namespaceshielding.html#a574c0dc650bc48ec8a009e4d7d76702c">NL1</a>)
<a name="l00912"></a>00912 
<a name="l00913"></a>00913         <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J)=2.54D-11*TETABIS
<a name="l00914"></a>00914 
<a name="l00915"></a>00915         <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J)=<a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J)*<a class="code" href="namespaceglobal__variables.html#a22c25f3a7738bb754b2da9a33197668b">UV_FLUX</a>
<a name="l00916"></a>00916       <span class="keyword">endif</span>
<a name="l00917"></a>00917 
<a name="l00918"></a>00918       <span class="comment">! ====== Compute the CO self-shielding</span>
<a name="l00919"></a>00919       <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J).EQ.<a class="code" href="namespaceglobal__variables.html#aeb9d5362587d4aa7bc7261745f0ca1a4">YCO</a>) <span class="keyword">then</span>
<a name="l00920"></a>00920 
<a name="l00921"></a>00921         TETABIS1=1.D0
<a name="l00922"></a>00922         TETABIS2=1.D0
<a name="l00923"></a>00923         TETABIS3=1.D0
<a name="l00924"></a>00924 
<a name="l00925"></a>00925         <a class="code" href="namespaceglobal__variables.html#abbcb53eabba6615b09054867432db21e">NH2</a> = <a class="code" href="namespaceglobal__variables.html#a70719d43ec2f69b5c28c61897ab75aab">visual_extinction</a>/<a class="code" href="namespaceglobal__variables.html#a032ebc8d525bc95b1df9f75738ed4568">AV_NH_ratio</a> * XNH2
<a name="l00926"></a>00926         <a class="code" href="namespaceglobal__variables.html#ad83c677657aaaf49b0a64b3e693eceb1">NCO</a> = <a class="code" href="namespaceglobal__variables.html#a70719d43ec2f69b5c28c61897ab75aab">visual_extinction</a>/<a class="code" href="namespaceglobal__variables.html#a032ebc8d525bc95b1df9f75738ed4568">AV_NH_ratio</a> * XNCO
<a name="l00927"></a>00927 
<a name="l00928"></a>00928         <span class="comment">! ======= Linear extrapolation of the three shileding factors</span>
<a name="l00929"></a>00929         <span class="keyword">do</span> L=1,<a class="code" href="namespaceshielding.html#ab99c284239692df65a426df8b1e68625">NL2</a>-1
<a name="l00930"></a>00930           <span class="keyword">if</span> ((<a class="code" href="namespaceshielding.html#a51716b1fa843b83ec33cd1f0743f11db">N2CO</a>(L).LE.<a class="code" href="namespaceglobal__variables.html#ad83c677657aaaf49b0a64b3e693eceb1">NCO</a>).AND.(<a class="code" href="namespaceshielding.html#a51716b1fa843b83ec33cd1f0743f11db">N2CO</a>(L+1).GE.<a class="code" href="namespaceglobal__variables.html#ad83c677657aaaf49b0a64b3e693eceb1">NCO</a>))  &amp;
<a name="l00931"></a>00931           TETABIS2=<a class="code" href="namespaceshielding.html#a2f65fb76cdf1337a478cb42625a49269">T2CO</a>(L)+(<a class="code" href="namespaceglobal__variables.html#ad83c677657aaaf49b0a64b3e693eceb1">NCO</a>-<a class="code" href="namespaceshielding.html#a51716b1fa843b83ec33cd1f0743f11db">N2CO</a>(L))*(<a class="code" href="namespaceshielding.html#a2f65fb76cdf1337a478cb42625a49269">T2CO</a>(L+1)-<a class="code" href="namespaceshielding.html#a2f65fb76cdf1337a478cb42625a49269">T2CO</a>(L))&amp;
<a name="l00932"></a>00932           /(<a class="code" href="namespaceshielding.html#a51716b1fa843b83ec33cd1f0743f11db">N2CO</a>(L+1)-<a class="code" href="namespaceshielding.html#a51716b1fa843b83ec33cd1f0743f11db">N2CO</a>(L))
<a name="l00933"></a>00933         <span class="keyword">enddo</span>
<a name="l00934"></a>00934 
<a name="l00935"></a>00935         <span class="keyword">do</span> L=1,<a class="code" href="namespaceshielding.html#a76320caf3f16f25879bc44f7094066cd">NL3</a>-1
<a name="l00936"></a>00936           <span class="keyword">if</span> ((<a class="code" href="namespaceshielding.html#a5d93f423aa99ec9a84632038757558c3">N2H2</a>(L).LE.<a class="code" href="namespaceglobal__variables.html#abbcb53eabba6615b09054867432db21e">NH2</a>).AND.(<a class="code" href="namespaceshielding.html#a5d93f423aa99ec9a84632038757558c3">N2H2</a>(L+1).GE.<a class="code" href="namespaceglobal__variables.html#abbcb53eabba6615b09054867432db21e">NH2</a>)) &amp;
<a name="l00937"></a>00937           TETABIS1=<a class="code" href="namespaceshielding.html#a8b394bda6e8e5bc14599e4eafc80f78f">T2H2</a>(L)+(<a class="code" href="namespaceglobal__variables.html#abbcb53eabba6615b09054867432db21e">NH2</a>-<a class="code" href="namespaceshielding.html#a5d93f423aa99ec9a84632038757558c3">N2H2</a>(L))*(<a class="code" href="namespaceshielding.html#a8b394bda6e8e5bc14599e4eafc80f78f">T2H2</a>(L+1)-<a class="code" href="namespaceshielding.html#a8b394bda6e8e5bc14599e4eafc80f78f">T2H2</a>(L))&amp;
<a name="l00938"></a>00938           /(<a class="code" href="namespaceshielding.html#a5d93f423aa99ec9a84632038757558c3">N2H2</a>(L+1)-<a class="code" href="namespaceshielding.html#a5d93f423aa99ec9a84632038757558c3">N2H2</a>(L))
<a name="l00939"></a>00939           <span class="keyword">if</span> ((<a class="code" href="namespaceshielding.html#ad4fed1d0c424a76e4b44f4f71affb2d1">AV2</a>(L).LE.<a class="code" href="namespaceglobal__variables.html#a70719d43ec2f69b5c28c61897ab75aab">visual_extinction</a>).AND.(<a class="code" href="namespaceshielding.html#ad4fed1d0c424a76e4b44f4f71affb2d1">AV2</a>(L+1).GE.<a class="code" href="namespaceglobal__variables.html#a70719d43ec2f69b5c28c61897ab75aab">visual_extinction</a>)) &amp;
<a name="l00940"></a>00940           TETABIS3=<a class="code" href="namespaceshielding.html#a1690dfbe83464cfc30413a7586d2703f">T2AV</a>(L)+(<a class="code" href="namespaceglobal__variables.html#a70719d43ec2f69b5c28c61897ab75aab">visual_extinction</a>-<a class="code" href="namespaceshielding.html#ad4fed1d0c424a76e4b44f4f71affb2d1">AV2</a>(L))*(<a class="code" href="namespaceshielding.html#a1690dfbe83464cfc30413a7586d2703f">T2AV</a>(L+1)-<a class="code" href="namespaceshielding.html#a1690dfbe83464cfc30413a7586d2703f">T2AV</a>(L))&amp;
<a name="l00941"></a>00941           /(<a class="code" href="namespaceshielding.html#ad4fed1d0c424a76e4b44f4f71affb2d1">AV2</a>(L+1)-<a class="code" href="namespaceshielding.html#ad4fed1d0c424a76e4b44f4f71affb2d1">AV2</a>(L))
<a name="l00942"></a>00942         <span class="keyword">enddo</span>
<a name="l00943"></a>00943 
<a name="l00944"></a>00944         <span class="comment">! Saturate the rate coefficient if necessary (when density or Av are out of </span>
<a name="l00945"></a>00945         <span class="comment">! the shielding array, from the photodiss files)</span>
<a name="l00946"></a>00946 
<a name="l00947"></a>00947         <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#ad83c677657aaaf49b0a64b3e693eceb1">NCO</a>.GT.<a class="code" href="namespaceshielding.html#a51716b1fa843b83ec33cd1f0743f11db">N2CO</a>(<a class="code" href="namespaceshielding.html#ab99c284239692df65a426df8b1e68625">NL2</a>)) TETABIS2 = <a class="code" href="namespaceshielding.html#a2f65fb76cdf1337a478cb42625a49269">T2CO</a>(<a class="code" href="namespaceshielding.html#ab99c284239692df65a426df8b1e68625">NL2</a>)
<a name="l00948"></a>00948         <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#abbcb53eabba6615b09054867432db21e">NH2</a>.GT.<a class="code" href="namespaceshielding.html#a5d93f423aa99ec9a84632038757558c3">N2H2</a>(<a class="code" href="namespaceshielding.html#a76320caf3f16f25879bc44f7094066cd">NL3</a>)) TETABIS1 = <a class="code" href="namespaceshielding.html#a8b394bda6e8e5bc14599e4eafc80f78f">T2H2</a>(<a class="code" href="namespaceshielding.html#a76320caf3f16f25879bc44f7094066cd">NL3</a>)
<a name="l00949"></a>00949         <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a70719d43ec2f69b5c28c61897ab75aab">visual_extinction</a>.GT.<a class="code" href="namespaceshielding.html#ad4fed1d0c424a76e4b44f4f71affb2d1">AV2</a>(<a class="code" href="namespaceshielding.html#a76320caf3f16f25879bc44f7094066cd">NL3</a>))  TETABIS3 = <a class="code" href="namespaceshielding.html#a1690dfbe83464cfc30413a7586d2703f">T2AV</a>(<a class="code" href="namespaceshielding.html#a76320caf3f16f25879bc44f7094066cd">NL3</a>)
<a name="l00950"></a>00950 
<a name="l00951"></a>00951         <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J)=1.03D-10*TETABIS1*TETABIS2*TETABIS3
<a name="l00952"></a>00952         <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J)=<a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J)*<a class="code" href="namespaceglobal__variables.html#a22c25f3a7738bb754b2da9a33197668b">UV_FLUX</a>
<a name="l00953"></a>00953 
<a name="l00954"></a>00954       <span class="keyword">endif</span>
<a name="l00955"></a>00955 
<a name="l00956"></a>00956     <span class="keyword">endif</span>
<a name="l00957"></a>00957 
<a name="l00958"></a>00958   <span class="keyword">enddo</span>
<a name="l00959"></a>00959 
<a name="l00960"></a>00960   <span class="comment">! Continually time-dependent grain rates================================</span>
<a name="l00961"></a>00961   <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#aad1529a525462ea536c9fa3f8a6d7595">IS_GRAIN_REACTIONS</a>.NE.0) <span class="keyword">then</span>
<a name="l00962"></a>00962 
<a name="l00963"></a>00963     <span class="comment">! ====== Rxn ITYPE 99</span>
<a name="l00964"></a>00964     <span class="comment">! ITYPE 99: Adsorption on grains</span>
<a name="l00965"></a>00965     <span class="keyword">do</span> J=<a class="code" href="namespaceglobal__variables.html#a72678d4a3e42c7707c53312a0bfd820a">type_id_start</a>(99),<a class="code" href="namespaceglobal__variables.html#a8e042ab32439646714871e722e3b8c18">type_id_stop</a>(99)
<a name="l00966"></a>00966       <span class="comment">! ========= Set accretion rates</span>
<a name="l00967"></a>00967       <a class="code" href="namespaceglobal__variables.html#a8ef7180d64cb02178c1d82322a6ff6bf">ACCRETION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))=<a class="code" href="namespaceglobal__variables.html#ac46ea159454e21892985c1e4ee3df55c">CONDSP</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))*TSQ*Y(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))*<a class="code" href="namespaceglobal__variables.html#ad8c6e0f43cbfebacfed34e1f1921ef92">H_number_density</a>
<a name="l00968"></a>00968       <a class="code" href="namespaceglobal__variables.html#a8ef7180d64cb02178c1d82322a6ff6bf">ACCRETION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J))=<a class="code" href="namespaceglobal__variables.html#a8ef7180d64cb02178c1d82322a6ff6bf">ACCRETION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))
<a name="l00969"></a>00969       <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J)=<a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)*<a class="code" href="namespaceglobal__variables.html#ad7d83bc1fcb7d6d1545cba39d875052a">branching_ratio</a>(J)*<a class="code" href="namespaceglobal__variables.html#a8ef7180d64cb02178c1d82322a6ff6bf">ACCRETION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))/Y(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))/<a class="code" href="namespaceglobal__variables.html#a9cfac828196dd36b6608931be24d610f">GTODN</a>
<a name="l00970"></a>00970     <span class="keyword">enddo</span>
<a name="l00971"></a>00971 
<a name="l00972"></a>00972     <span class="comment">! ====== Rxn ITYPE 14</span>
<a name="l00973"></a>00973     <span class="comment">! ITYPE 14: Grain surface reactions</span>
<a name="l00974"></a>00974     <span class="keyword">do</span> J=<a class="code" href="namespaceglobal__variables.html#a72678d4a3e42c7707c53312a0bfd820a">type_id_start</a>(14),<a class="code" href="namespaceglobal__variables.html#a8e042ab32439646714871e722e3b8c18">type_id_stop</a>(14)
<a name="l00975"></a>00975       IMOD1=0
<a name="l00976"></a>00976       IMOD2=0
<a name="l00977"></a>00977       BARR=1.0d0
<a name="l00978"></a>00978       <span class="comment">! --------- Calculate activation energy barrier multiplier</span>
<a name="l00979"></a>00979       <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a2364767b28e470f4523dd802ae736aaa">ACTIVATION_ENERGY</a>(J).GE.1.0D-40) <span class="keyword">then</span>
<a name="l00980"></a>00980         ACTIV=<a class="code" href="namespaceglobal__variables.html#a2364767b28e470f4523dd802ae736aaa">ACTIVATION_ENERGY</a>(J)/<a class="code" href="namespaceglobal__variables.html#ab165b9b5b824a85985f8b99f82e1ae67">dust_temperature</a>
<a name="l00981"></a>00981         <span class="comment">! ------------ Choose fastest of classical or tunnelling</span>
<a name="l00982"></a>00982         <span class="keyword">if</span> (ACTIV.GT.<a class="code" href="namespaceglobal__variables.html#aadf3aa76653f3696ab133c40eb1afe28">quantum_activation_energy</a>(J)) ACTIV=<a class="code" href="namespaceglobal__variables.html#aadf3aa76653f3696ab133c40eb1afe28">quantum_activation_energy</a>(J)
<a name="l00983"></a>00983         BARR=EXP(-ACTIV)
<a name="l00984"></a>00984       <span class="keyword">endif</span>
<a name="l00985"></a>00985 
<a name="l00986"></a>00986       <span class="comment">! --------- Thermal hopping diffusion method</span>
<a name="l00987"></a>00987       <a class="code" href="namespaceglobal__variables.html#a017b2f55c589525ff03429dcb468d921">THERMAL_DIFFUSION_RATE_1</a>(J)=<a class="code" href="namespaceglobal__variables.html#a61ca7748d102a947d8902ba4f2adda23">THERMAL_HOPING_RATE</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))
<a name="l00988"></a>00988       <a class="code" href="namespaceglobal__variables.html#ad0c7ad20fea426f50d7303242db3e88e">THERMAL_DIFFUSION_RATE_2</a>(J)=<a class="code" href="namespaceglobal__variables.html#a61ca7748d102a947d8902ba4f2adda23">THERMAL_HOPING_RATE</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J))
<a name="l00989"></a>00989 
<a name="l00990"></a>00990       <span class="comment">! --------- Check for JH,JH2</span>
<a name="l00991"></a>00991       <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J).EQ.<a class="code" href="namespaceglobal__variables.html#ac482cca882b0a18a0ff5036b6c1f28f6">YJH</a>)  IMOD1=1
<a name="l00992"></a>00992       <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J).EQ.<a class="code" href="namespaceglobal__variables.html#a440f32b1e4e9ec4a4e326ddf7bf38786">YJH2</a>) IMOD1=2
<a name="l00993"></a>00993       <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(2,J).EQ.<a class="code" href="namespaceglobal__variables.html#ac482cca882b0a18a0ff5036b6c1f28f6">YJH</a>)  IMOD2=1
<a name="l00994"></a>00994       <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(2,J).EQ.<a class="code" href="namespaceglobal__variables.html#a440f32b1e4e9ec4a4e326ddf7bf38786">YJH2</a>) IMOD2=2
<a name="l00995"></a>00995 
<a name="l00996"></a>00996       <span class="comment">! --------- QM for JH,JH2 only - others are too heavy</span>
<a name="l00997"></a>00997       <span class="keyword">if</span> (IMOD1+IMOD2.NE.0) <span class="keyword">then</span>
<a name="l00998"></a>00998         <span class="comment">! ------------ QM1 - Tunnelling (if it&#39;s faster than thermal)</span>
<a name="l00999"></a>00999         <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a6133a2ce729a3d2e5cebd02c0073edfb">GRAIN_TUNNELING_DIFFUSION</a>.EQ.1) <span class="keyword">then</span>
<a name="l01000"></a>01000           <span class="keyword">if</span> ((IMOD1.NE.0).AND.(<a class="code" href="namespaceglobal__variables.html#afcafaf2ac8c668ec6c995e3164501deb">TUNNELING_RATE_TYPE_1</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J)).GT.<a class="code" href="namespaceglobal__variables.html#a017b2f55c589525ff03429dcb468d921">THERMAL_DIFFUSION_RATE_1</a>(J))) <span class="keyword">then</span>
<a name="l01001"></a>01001             <a class="code" href="namespaceglobal__variables.html#a017b2f55c589525ff03429dcb468d921">THERMAL_DIFFUSION_RATE_1</a>(J)=<a class="code" href="namespaceglobal__variables.html#afcafaf2ac8c668ec6c995e3164501deb">TUNNELING_RATE_TYPE_1</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))
<a name="l01002"></a>01002           <span class="keyword">endif</span>
<a name="l01003"></a>01003           <span class="keyword">if</span> ((IMOD2.NE.0).AND.(<a class="code" href="namespaceglobal__variables.html#afcafaf2ac8c668ec6c995e3164501deb">TUNNELING_RATE_TYPE_1</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J)).GT.<a class="code" href="namespaceglobal__variables.html#ad0c7ad20fea426f50d7303242db3e88e">THERMAL_DIFFUSION_RATE_2</a>(J))) <span class="keyword">then</span>
<a name="l01004"></a>01004             <a class="code" href="namespaceglobal__variables.html#ad0c7ad20fea426f50d7303242db3e88e">THERMAL_DIFFUSION_RATE_2</a>(J)=<a class="code" href="namespaceglobal__variables.html#afcafaf2ac8c668ec6c995e3164501deb">TUNNELING_RATE_TYPE_1</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J))
<a name="l01005"></a>01005           <span class="keyword">endif</span>
<a name="l01006"></a>01006         <span class="keyword">endif</span>
<a name="l01007"></a>01007         <span class="comment">! ------------ QM2 - Tunnelling: use estimated width of lowest energy band (if it&#39;s faster than thermal)</span>
<a name="l01008"></a>01008         <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a6133a2ce729a3d2e5cebd02c0073edfb">GRAIN_TUNNELING_DIFFUSION</a>.EQ.2) <span class="keyword">then</span>
<a name="l01009"></a>01009           <span class="keyword">if</span> ((IMOD1.NE.0).AND.(<a class="code" href="namespaceglobal__variables.html#a24b2dcb22f33a22432a4e116348a2e1b">TUNNELING_RATE_TYPE_2</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J)).GT.<a class="code" href="namespaceglobal__variables.html#a017b2f55c589525ff03429dcb468d921">THERMAL_DIFFUSION_RATE_1</a>(J))) <span class="keyword">then</span>
<a name="l01010"></a>01010             <a class="code" href="namespaceglobal__variables.html#a017b2f55c589525ff03429dcb468d921">THERMAL_DIFFUSION_RATE_1</a>(J)=<a class="code" href="namespaceglobal__variables.html#a24b2dcb22f33a22432a4e116348a2e1b">TUNNELING_RATE_TYPE_2</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))
<a name="l01011"></a>01011           <span class="keyword">endif</span>
<a name="l01012"></a>01012           <span class="keyword">if</span> ((IMOD2.NE.0).AND.(<a class="code" href="namespaceglobal__variables.html#a24b2dcb22f33a22432a4e116348a2e1b">TUNNELING_RATE_TYPE_2</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J)).GT.<a class="code" href="namespaceglobal__variables.html#ad0c7ad20fea426f50d7303242db3e88e">THERMAL_DIFFUSION_RATE_2</a>(J))) <span class="keyword">then</span>
<a name="l01013"></a>01013             <a class="code" href="namespaceglobal__variables.html#ad0c7ad20fea426f50d7303242db3e88e">THERMAL_DIFFUSION_RATE_2</a>(J)=<a class="code" href="namespaceglobal__variables.html#a24b2dcb22f33a22432a4e116348a2e1b">TUNNELING_RATE_TYPE_2</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J))
<a name="l01014"></a>01014           <span class="keyword">endif</span>
<a name="l01015"></a>01015         <span class="keyword">endif</span>
<a name="l01016"></a>01016         <span class="comment">! ------------ QM3 - Fastest out of thermal, QM1, QM2 rates</span>
<a name="l01017"></a>01017         <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a6133a2ce729a3d2e5cebd02c0073edfb">GRAIN_TUNNELING_DIFFUSION</a>.EQ.3) <span class="keyword">then</span>
<a name="l01018"></a>01018           <span class="keyword">if</span> (IMOD1.NE.0) <span class="keyword">then</span>
<a name="l01019"></a>01019             <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#afcafaf2ac8c668ec6c995e3164501deb">TUNNELING_RATE_TYPE_1</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J)).GT.<a class="code" href="namespaceglobal__variables.html#a017b2f55c589525ff03429dcb468d921">THERMAL_DIFFUSION_RATE_1</a>(J)) <span class="keyword">then</span>
<a name="l01020"></a>01020               <a class="code" href="namespaceglobal__variables.html#a017b2f55c589525ff03429dcb468d921">THERMAL_DIFFUSION_RATE_1</a>(J) = <a class="code" href="namespaceglobal__variables.html#afcafaf2ac8c668ec6c995e3164501deb">TUNNELING_RATE_TYPE_1</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))
<a name="l01021"></a>01021             <span class="keyword">endif</span>
<a name="l01022"></a>01022             <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a24b2dcb22f33a22432a4e116348a2e1b">TUNNELING_RATE_TYPE_2</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J)).GT.<a class="code" href="namespaceglobal__variables.html#a017b2f55c589525ff03429dcb468d921">THERMAL_DIFFUSION_RATE_1</a>(J)) <span class="keyword">then</span>
<a name="l01023"></a>01023               <a class="code" href="namespaceglobal__variables.html#a017b2f55c589525ff03429dcb468d921">THERMAL_DIFFUSION_RATE_1</a>(J) = <a class="code" href="namespaceglobal__variables.html#a24b2dcb22f33a22432a4e116348a2e1b">TUNNELING_RATE_TYPE_2</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))
<a name="l01024"></a>01024             <span class="keyword">endif</span>
<a name="l01025"></a>01025           <span class="keyword">endif</span>
<a name="l01026"></a>01026           <span class="keyword">if</span> (IMOD2.NE.0) <span class="keyword">then</span>
<a name="l01027"></a>01027             <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#afcafaf2ac8c668ec6c995e3164501deb">TUNNELING_RATE_TYPE_1</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J)).GT.<a class="code" href="namespaceglobal__variables.html#ad0c7ad20fea426f50d7303242db3e88e">THERMAL_DIFFUSION_RATE_2</a>(J))  <span class="keyword">then</span>
<a name="l01028"></a>01028               <a class="code" href="namespaceglobal__variables.html#ad0c7ad20fea426f50d7303242db3e88e">THERMAL_DIFFUSION_RATE_2</a>(J) = <a class="code" href="namespaceglobal__variables.html#afcafaf2ac8c668ec6c995e3164501deb">TUNNELING_RATE_TYPE_1</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J))
<a name="l01029"></a>01029             <span class="keyword">endif</span>
<a name="l01030"></a>01030             <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a24b2dcb22f33a22432a4e116348a2e1b">TUNNELING_RATE_TYPE_2</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J)).GT.<a class="code" href="namespaceglobal__variables.html#ad0c7ad20fea426f50d7303242db3e88e">THERMAL_DIFFUSION_RATE_2</a>(J))  <span class="keyword">then</span>
<a name="l01031"></a>01031               <a class="code" href="namespaceglobal__variables.html#ad0c7ad20fea426f50d7303242db3e88e">THERMAL_DIFFUSION_RATE_2</a>(J) = <a class="code" href="namespaceglobal__variables.html#a24b2dcb22f33a22432a4e116348a2e1b">TUNNELING_RATE_TYPE_2</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J))
<a name="l01032"></a>01032             <span class="keyword">endif</span>
<a name="l01033"></a>01033           <span class="keyword">endif</span>
<a name="l01034"></a>01034         <span class="keyword">endif</span>
<a name="l01035"></a>01035       <span class="keyword">endif</span>
<a name="l01036"></a>01036 
<a name="l01037"></a>01037       <span class="comment">! --------- Modify according to MODIFY_RATE_FLAG switch:</span>
<a name="l01038"></a>01038       <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a68aaab28bc1e9bd07e95a925026e9ca1">MODIFY_RATE_FLAG</a>.NE.0) <span class="keyword">then</span>
<a name="l01039"></a>01039         <span class="comment">! ------------ if H+H-&gt;H2 is only modified rxn:</span>
<a name="l01040"></a>01040         <span class="keyword">if</span> ((<a class="code" href="namespaceglobal__variables.html#a68aaab28bc1e9bd07e95a925026e9ca1">MODIFY_RATE_FLAG</a>.EQ.-1).AND.(IMOD1.NE.1.OR.IMOD2.NE.1)) <span class="keyword">then</span>
<a name="l01041"></a>01041           IMOD1=0
<a name="l01042"></a>01042           IMOD2=0
<a name="l01043"></a>01043         <span class="keyword">endif</span>
<a name="l01044"></a>01044 
<a name="l01045"></a>01045         <span class="comment">! ------------ if only H is modified:</span>
<a name="l01046"></a>01046         <span class="keyword">if</span> ((<a class="code" href="namespaceglobal__variables.html#a68aaab28bc1e9bd07e95a925026e9ca1">MODIFY_RATE_FLAG</a>.EQ.1).AND.(IMOD1.NE.1)) IMOD1=0
<a name="l01047"></a>01047         <span class="keyword">if</span> ((<a class="code" href="namespaceglobal__variables.html#a68aaab28bc1e9bd07e95a925026e9ca1">MODIFY_RATE_FLAG</a>.EQ.1).AND.(IMOD2.NE.1)) IMOD2=0
<a name="l01048"></a>01048 
<a name="l01049"></a>01049         <span class="comment">! ------------ Set to modify all rates, if selected (just atoms)</span>
<a name="l01050"></a>01050         <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a68aaab28bc1e9bd07e95a925026e9ca1">MODIFY_RATE_FLAG</a>.EQ.3) <span class="keyword">then</span>
<a name="l01051"></a>01051           <span class="keyword">if</span> ((<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J).EQ.<a class="code" href="namespaceglobal__variables.html#ac482cca882b0a18a0ff5036b6c1f28f6">YJH</a>).OR.&amp;
<a name="l01052"></a>01052           (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J).EQ.<span class="stringliteral">&#39;JHe        &#39;</span>).OR.&amp;
<a name="l01053"></a>01053           (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J).EQ.<span class="stringliteral">&#39;JC         &#39;</span>).OR.&amp;
<a name="l01054"></a>01054           (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J).EQ.<span class="stringliteral">&#39;JN         &#39;</span>).OR.&amp;
<a name="l01055"></a>01055           (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J).EQ.<span class="stringliteral">&#39;JO         &#39;</span>).OR.&amp;
<a name="l01056"></a>01056           (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J).EQ.<span class="stringliteral">&#39;JS         &#39;</span>).OR.&amp;
<a name="l01057"></a>01057           (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J).EQ.<span class="stringliteral">&#39;JSi        &#39;</span>).OR.&amp;
<a name="l01058"></a>01058           (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J).EQ.<span class="stringliteral">&#39;JFe        &#39;</span>).OR.&amp;
<a name="l01059"></a>01059           (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J).EQ.<span class="stringliteral">&#39;JNa        &#39;</span>).OR.&amp;
<a name="l01060"></a>01060           (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J).EQ.<span class="stringliteral">&#39;JMg        &#39;</span>).OR.&amp;
<a name="l01061"></a>01061           (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J).EQ.<span class="stringliteral">&#39;JP         &#39;</span>).OR.&amp;
<a name="l01062"></a>01062           (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J).EQ.<span class="stringliteral">&#39;JCl        &#39;</span>)) IMOD1=3
<a name="l01063"></a>01063           <span class="keyword">if</span> ((<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(2,J).EQ.<a class="code" href="namespaceglobal__variables.html#ac482cca882b0a18a0ff5036b6c1f28f6">YJH</a>).OR.&amp;
<a name="l01064"></a>01064           (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(2,J).EQ.<span class="stringliteral">&#39;JHe        &#39;</span>).OR.&amp;
<a name="l01065"></a>01065           (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(2,J).EQ.<span class="stringliteral">&#39;JC         &#39;</span>).OR.&amp;
<a name="l01066"></a>01066           (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(2,J).EQ.<span class="stringliteral">&#39;JN         &#39;</span>).OR.&amp;
<a name="l01067"></a>01067           (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(2,J).EQ.<span class="stringliteral">&#39;JO         &#39;</span>).OR.&amp;
<a name="l01068"></a>01068           (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(2,J).EQ.<span class="stringliteral">&#39;JS         &#39;</span>).OR.&amp;
<a name="l01069"></a>01069           (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(2,J).EQ.<span class="stringliteral">&#39;JSi        &#39;</span>).OR.&amp;
<a name="l01070"></a>01070           (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(2,J).EQ.<span class="stringliteral">&#39;JFe        &#39;</span>).OR.&amp;
<a name="l01071"></a>01071           (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(2,J).EQ.<span class="stringliteral">&#39;JNa        &#39;</span>).OR.&amp;
<a name="l01072"></a>01072           (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(2,J).EQ.<span class="stringliteral">&#39;JMg        &#39;</span>).OR.&amp;
<a name="l01073"></a>01073           (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(2,J).EQ.<span class="stringliteral">&#39;JP         &#39;</span>).OR.&amp;
<a name="l01074"></a>01074           (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(2,J).EQ.<span class="stringliteral">&#39;JCl        &#39;</span>)) IMOD2=3
<a name="l01075"></a>01075         <span class="keyword">endif</span>
<a name="l01076"></a>01076 
<a name="l01077"></a>01077         <span class="comment">! ------------ Modify rates (THERMAL_DIFFUSION_RATE_1 &amp; THERMAL_DIFFUSION_RATE_2) according to their own evap/acc rates</span>
<a name="l01078"></a>01078         YMOD1=Y(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))
<a name="l01079"></a>01079         YMOD2=Y(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J))
<a name="l01080"></a>01080         call <a class="code" href="namespaceode__solver.html#ab3252c79536b1c3506f8fd613dce0251">modify_specific_rates</a>(J,IMOD1,IMOD2,BARR,YMOD1,YMOD2)
<a name="l01081"></a>01081       <span class="keyword">endif</span>
<a name="l01082"></a>01082 
<a name="l01083"></a>01083       DIFF=<a class="code" href="namespaceglobal__variables.html#a017b2f55c589525ff03429dcb468d921">THERMAL_DIFFUSION_RATE_1</a>(J)+<a class="code" href="namespaceglobal__variables.html#ad0c7ad20fea426f50d7303242db3e88e">THERMAL_DIFFUSION_RATE_2</a>(J)
<a name="l01084"></a>01084 
<a name="l01085"></a>01085       <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J)=<a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)*<a class="code" href="namespaceglobal__variables.html#ad7d83bc1fcb7d6d1545cba39d875052a">branching_ratio</a>(J)*BARR*DIFF*<a class="code" href="namespaceglobal__variables.html#a9cfac828196dd36b6608931be24d610f">GTODN</a>/<a class="code" href="namespaceglobal__variables.html#ad8c6e0f43cbfebacfed34e1f1921ef92">H_number_density</a>
<a name="l01086"></a>01086       <span class="comment">! reaction_rates(J)=0.D0</span>
<a name="l01087"></a>01087     <span class="keyword">enddo</span>
<a name="l01088"></a>01088 
<a name="l01089"></a>01089     <span class="comment">! Grain surface reactions (Cosmic Rays) DTEMP=70K</span>
<a name="l01090"></a>01090     <span class="comment">! ====== Rxn ITYPE 21</span>
<a name="l01091"></a>01091     <span class="comment">! ITYPE 21: Grain surface reactions</span>
<a name="l01092"></a>01092     <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a72678d4a3e42c7707c53312a0bfd820a">type_id_start</a>(21).NE.0) <span class="keyword">then</span>
<a name="l01093"></a>01093        <span class="keyword">do</span> J=<a class="code" href="namespaceglobal__variables.html#a72678d4a3e42c7707c53312a0bfd820a">type_id_start</a>(21),<a class="code" href="namespaceglobal__variables.html#a8e042ab32439646714871e722e3b8c18">type_id_stop</a>(21)
<a name="l01094"></a>01094             IMOD1=0
<a name="l01095"></a>01095             IMOD2=0
<a name="l01096"></a>01096             BARRCR=1.0d0
<a name="l01097"></a>01097             <span class="comment">! --------- Calculate activation energy barrier multiplier</span>
<a name="l01098"></a>01098             <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a2364767b28e470f4523dd802ae736aaa">ACTIVATION_ENERGY</a>(J).GE.1.0D-40) <span class="keyword">then</span>
<a name="l01099"></a>01099                ACTIVCR=<a class="code" href="namespaceglobal__variables.html#a2364767b28e470f4523dd802ae736aaa">ACTIVATION_ENERGY</a>(J)/<a class="code" href="namespaceglobal__variables.html#a90a711b3b4b07b0409a3d620b63bc3a2">PEAK_GRAIN_TEMPERATURE</a>
<a name="l01100"></a>01100                <span class="comment">! ------------ Choose fastest of classical or tunnelling</span>
<a name="l01101"></a>01101                <span class="keyword">if</span> (ACTIVCR.GT.<a class="code" href="namespaceglobal__variables.html#aadf3aa76653f3696ab133c40eb1afe28">quantum_activation_energy</a>(J)) ACTIVCR=<a class="code" href="namespaceglobal__variables.html#aadf3aa76653f3696ab133c40eb1afe28">quantum_activation_energy</a>(J)
<a name="l01102"></a>01102                BARRCR=EXP(-ACTIVCR)
<a name="l01103"></a>01103             <span class="keyword">endif</span>
<a name="l01104"></a>01104 
<a name="l01105"></a>01105             <span class="comment">! --------- Thermal hopping diffusion method</span>
<a name="l01106"></a>01106             <a class="code" href="namespaceglobal__variables.html#a007555b61f6e85c8b0d3b91011128ed3">CR_DIFFUSION_RATE_1</a>(J)=<a class="code" href="namespaceglobal__variables.html#a9cdae96536bbf5236fcac9adfc614c48">CR_HOPING_RATE</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))
<a name="l01107"></a>01107             <a class="code" href="namespaceglobal__variables.html#ae614c99cbe0ea8f90e23711cb949f59a">CR_DIFFUSION_RATE_2</a>(J)=<a class="code" href="namespaceglobal__variables.html#a9cdae96536bbf5236fcac9adfc614c48">CR_HOPING_RATE</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J))
<a name="l01108"></a>01108 
<a name="l01109"></a>01109             <span class="comment">! --------- Check for JH,JH2</span>
<a name="l01110"></a>01110             <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J).EQ.<a class="code" href="namespaceglobal__variables.html#ac482cca882b0a18a0ff5036b6c1f28f6">YJH</a>)  IMOD1=1
<a name="l01111"></a>01111             <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J).EQ.<a class="code" href="namespaceglobal__variables.html#a440f32b1e4e9ec4a4e326ddf7bf38786">YJH2</a>) IMOD1=2
<a name="l01112"></a>01112             <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(2,J).EQ.<a class="code" href="namespaceglobal__variables.html#ac482cca882b0a18a0ff5036b6c1f28f6">YJH</a>)  IMOD2=1
<a name="l01113"></a>01113             <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(2,J).EQ.<a class="code" href="namespaceglobal__variables.html#a440f32b1e4e9ec4a4e326ddf7bf38786">YJH2</a>) IMOD2=2
<a name="l01114"></a>01114             <span class="comment">!if (REACTION_SUBSTANCES_NAMES(1,J).EQ.YJO)  IMOD1=4</span>
<a name="l01115"></a>01115             <span class="comment">!if (REACTION_SUBSTANCES_NAMES(2,J).EQ.YJO)  IMOD2=4</span>
<a name="l01116"></a>01116 
<a name="l01117"></a>01117             <span class="comment">! --------- QM for JH,JH2 only - others are too heavy</span>
<a name="l01118"></a>01118             <span class="keyword">if</span> (IMOD1+IMOD2.NE.0) <span class="keyword">then</span>
<a name="l01119"></a>01119               <span class="comment">! ------------ QM1 - Tunnelling (if it&#39;s faster than thermal)</span>
<a name="l01120"></a>01120               <span class="keyword">if</span> (grain_tunneling_diffusion.EQ.1) <span class="keyword">then</span>
<a name="l01121"></a>01121                 <span class="keyword">if</span> ((IMOD1.NE.0).AND.(<a class="code" href="namespaceglobal__variables.html#afcafaf2ac8c668ec6c995e3164501deb">TUNNELING_RATE_TYPE_1</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J)).GT.<a class="code" href="namespaceglobal__variables.html#a007555b61f6e85c8b0d3b91011128ed3">CR_DIFFUSION_RATE_1</a>(J))) <span class="keyword">then</span>
<a name="l01122"></a>01122                   <a class="code" href="namespaceglobal__variables.html#a007555b61f6e85c8b0d3b91011128ed3">CR_DIFFUSION_RATE_1</a>(J)=<a class="code" href="namespaceglobal__variables.html#afcafaf2ac8c668ec6c995e3164501deb">TUNNELING_RATE_TYPE_1</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))
<a name="l01123"></a>01123                 <span class="keyword">endif</span>
<a name="l01124"></a>01124                 <span class="keyword">if</span> ((IMOD2.NE.0).AND.(<a class="code" href="namespaceglobal__variables.html#afcafaf2ac8c668ec6c995e3164501deb">TUNNELING_RATE_TYPE_1</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J)).GT.<a class="code" href="namespaceglobal__variables.html#ae614c99cbe0ea8f90e23711cb949f59a">CR_DIFFUSION_RATE_2</a>(J))) <span class="keyword">then</span>
<a name="l01125"></a>01125                   <a class="code" href="namespaceglobal__variables.html#ae614c99cbe0ea8f90e23711cb949f59a">CR_DIFFUSION_RATE_2</a>(J)=<a class="code" href="namespaceglobal__variables.html#afcafaf2ac8c668ec6c995e3164501deb">TUNNELING_RATE_TYPE_1</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J))
<a name="l01126"></a>01126                 <span class="keyword">endif</span>
<a name="l01127"></a>01127               <span class="keyword">endif</span>
<a name="l01128"></a>01128               <span class="comment">! ------------ QM2 - Tunnelling: use estimated width of lowest energy band (if it&#39;s faster than thermal)</span>
<a name="l01129"></a>01129               <span class="keyword">if</span> (grain_tunneling_diffusion.EQ.2) <span class="keyword">then</span>
<a name="l01130"></a>01130                 <span class="keyword">if</span> ((IMOD1.NE.0).AND.(<a class="code" href="namespaceglobal__variables.html#a24b2dcb22f33a22432a4e116348a2e1b">TUNNELING_RATE_TYPE_2</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J)).GT.<a class="code" href="namespaceglobal__variables.html#a007555b61f6e85c8b0d3b91011128ed3">CR_DIFFUSION_RATE_1</a>(J))) <span class="keyword">then</span>
<a name="l01131"></a>01131                   <a class="code" href="namespaceglobal__variables.html#a007555b61f6e85c8b0d3b91011128ed3">CR_DIFFUSION_RATE_1</a>(J)=<a class="code" href="namespaceglobal__variables.html#a24b2dcb22f33a22432a4e116348a2e1b">TUNNELING_RATE_TYPE_2</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))
<a name="l01132"></a>01132                 <span class="keyword">endif</span>
<a name="l01133"></a>01133                 <span class="keyword">if</span> ((IMOD2.NE.0).AND.(<a class="code" href="namespaceglobal__variables.html#a24b2dcb22f33a22432a4e116348a2e1b">TUNNELING_RATE_TYPE_2</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J)).GT.<a class="code" href="namespaceglobal__variables.html#ae614c99cbe0ea8f90e23711cb949f59a">CR_DIFFUSION_RATE_2</a>(J))) <span class="keyword">then</span>
<a name="l01134"></a>01134                   <a class="code" href="namespaceglobal__variables.html#ae614c99cbe0ea8f90e23711cb949f59a">CR_DIFFUSION_RATE_2</a>(J)=<a class="code" href="namespaceglobal__variables.html#a24b2dcb22f33a22432a4e116348a2e1b">TUNNELING_RATE_TYPE_2</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J))
<a name="l01135"></a>01135                 <span class="keyword">endif</span>
<a name="l01136"></a>01136               <span class="keyword">endif</span>
<a name="l01137"></a>01137               <span class="comment">! ------------ QM3 - Fastest out of thermal, QM1, QM2 rates</span>
<a name="l01138"></a>01138               <span class="keyword">if</span> (grain_tunneling_diffusion.EQ.3) <span class="keyword">then</span>
<a name="l01139"></a>01139                 <span class="keyword">if</span> (IMOD1.NE.0) <span class="keyword">then</span>
<a name="l01140"></a>01140                   <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#afcafaf2ac8c668ec6c995e3164501deb">TUNNELING_RATE_TYPE_1</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J)).GT.<a class="code" href="namespaceglobal__variables.html#a007555b61f6e85c8b0d3b91011128ed3">CR_DIFFUSION_RATE_1</a>(J)) <span class="keyword">then</span>
<a name="l01141"></a>01141                     <a class="code" href="namespaceglobal__variables.html#a007555b61f6e85c8b0d3b91011128ed3">CR_DIFFUSION_RATE_1</a>(J)=<a class="code" href="namespaceglobal__variables.html#afcafaf2ac8c668ec6c995e3164501deb">TUNNELING_RATE_TYPE_1</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))
<a name="l01142"></a>01142                   <span class="keyword">endif</span>
<a name="l01143"></a>01143                   <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a24b2dcb22f33a22432a4e116348a2e1b">TUNNELING_RATE_TYPE_2</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J)).GT.<a class="code" href="namespaceglobal__variables.html#a007555b61f6e85c8b0d3b91011128ed3">CR_DIFFUSION_RATE_1</a>(J)) <span class="keyword">then</span>
<a name="l01144"></a>01144                     <a class="code" href="namespaceglobal__variables.html#a007555b61f6e85c8b0d3b91011128ed3">CR_DIFFUSION_RATE_1</a>(J)=<a class="code" href="namespaceglobal__variables.html#a24b2dcb22f33a22432a4e116348a2e1b">TUNNELING_RATE_TYPE_2</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))
<a name="l01145"></a>01145                   <span class="keyword">endif</span>
<a name="l01146"></a>01146                 <span class="keyword">endif</span>
<a name="l01147"></a>01147                 <span class="keyword">if</span> (IMOD2.NE.0) <span class="keyword">then</span>
<a name="l01148"></a>01148                   <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#afcafaf2ac8c668ec6c995e3164501deb">TUNNELING_RATE_TYPE_1</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J)).GT.<a class="code" href="namespaceglobal__variables.html#ae614c99cbe0ea8f90e23711cb949f59a">CR_DIFFUSION_RATE_2</a>(J)) <span class="keyword">then</span>
<a name="l01149"></a>01149                     <a class="code" href="namespaceglobal__variables.html#ae614c99cbe0ea8f90e23711cb949f59a">CR_DIFFUSION_RATE_2</a>(J)=<a class="code" href="namespaceglobal__variables.html#afcafaf2ac8c668ec6c995e3164501deb">TUNNELING_RATE_TYPE_1</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J))
<a name="l01150"></a>01150                   <span class="keyword">endif</span>
<a name="l01151"></a>01151                   <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a24b2dcb22f33a22432a4e116348a2e1b">TUNNELING_RATE_TYPE_2</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J)).GT.<a class="code" href="namespaceglobal__variables.html#ae614c99cbe0ea8f90e23711cb949f59a">CR_DIFFUSION_RATE_2</a>(J)) <span class="keyword">then</span>
<a name="l01152"></a>01152                     <a class="code" href="namespaceglobal__variables.html#ae614c99cbe0ea8f90e23711cb949f59a">CR_DIFFUSION_RATE_2</a>(J)=<a class="code" href="namespaceglobal__variables.html#a24b2dcb22f33a22432a4e116348a2e1b">TUNNELING_RATE_TYPE_2</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J))
<a name="l01153"></a>01153                   <span class="keyword">endif</span>
<a name="l01154"></a>01154                 <span class="keyword">endif</span>
<a name="l01155"></a>01155               <span class="keyword">endif</span>
<a name="l01156"></a>01156             <span class="keyword">endif</span>
<a name="l01157"></a>01157 
<a name="l01158"></a>01158             <span class="comment">! --------- Modify according to MODIFY_RATE_FLAG switch:</span>
<a name="l01159"></a>01159             <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a68aaab28bc1e9bd07e95a925026e9ca1">MODIFY_RATE_FLAG</a>.NE.0) <span class="keyword">then</span>
<a name="l01160"></a>01160                <span class="comment">! ------------ If H+H-&gt;H2 is only modified rxn:</span>
<a name="l01161"></a>01161                <span class="keyword">if</span> ((<a class="code" href="namespaceglobal__variables.html#a68aaab28bc1e9bd07e95a925026e9ca1">MODIFY_RATE_FLAG</a>.EQ.-1).AND.(IMOD1.NE.1.OR.IMOD2.NE.1)) <span class="keyword">then</span>
<a name="l01162"></a>01162                   IMOD1=0
<a name="l01163"></a>01163                   IMOD2=0
<a name="l01164"></a>01164                <span class="keyword">endif</span>
<a name="l01165"></a>01165 
<a name="l01166"></a>01166                <span class="comment">! ------------ If only H is modified:</span>
<a name="l01167"></a>01167                <span class="keyword">if</span> ((<a class="code" href="namespaceglobal__variables.html#a68aaab28bc1e9bd07e95a925026e9ca1">MODIFY_RATE_FLAG</a>.EQ.1).AND.(IMOD1.NE.1)) IMOD1=0
<a name="l01168"></a>01168                <span class="keyword">if</span> ((<a class="code" href="namespaceglobal__variables.html#a68aaab28bc1e9bd07e95a925026e9ca1">MODIFY_RATE_FLAG</a>.EQ.1).AND.(IMOD2.NE.1)) IMOD2=0
<a name="l01169"></a>01169 
<a name="l01170"></a>01170                <span class="comment">! ------------ Set to modify all rates, if selected (just atoms)</span>
<a name="l01171"></a>01171                <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a68aaab28bc1e9bd07e95a925026e9ca1">MODIFY_RATE_FLAG</a>.EQ.3) <span class="keyword">then</span>
<a name="l01172"></a>01172                   <span class="keyword">if</span> ((<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J).EQ.<a class="code" href="namespaceglobal__variables.html#ac482cca882b0a18a0ff5036b6c1f28f6">YJH</a>).OR.&amp;
<a name="l01173"></a>01173                       (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J).EQ.<span class="stringliteral">&#39;JHe        &#39;</span>).OR.&amp;
<a name="l01174"></a>01174                       (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J).EQ.<span class="stringliteral">&#39;JC         &#39;</span>).OR.&amp;
<a name="l01175"></a>01175                       (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J).EQ.<span class="stringliteral">&#39;JN         &#39;</span>).OR.&amp;
<a name="l01176"></a>01176                       (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J).EQ.<span class="stringliteral">&#39;JO         &#39;</span>).OR.&amp;
<a name="l01177"></a>01177                       (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J).EQ.<span class="stringliteral">&#39;JS         &#39;</span>).OR.&amp;
<a name="l01178"></a>01178                       (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J).EQ.<span class="stringliteral">&#39;JSi        &#39;</span>).OR.&amp;
<a name="l01179"></a>01179                       (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J).EQ.<span class="stringliteral">&#39;JFe        &#39;</span>).OR.&amp;
<a name="l01180"></a>01180                       (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J).EQ.<span class="stringliteral">&#39;JNa        &#39;</span>).OR.&amp;
<a name="l01181"></a>01181                       (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J).EQ.<span class="stringliteral">&#39;JMg        &#39;</span>).OR.&amp;
<a name="l01182"></a>01182                       (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J).EQ.<span class="stringliteral">&#39;JP         &#39;</span>).OR.&amp;
<a name="l01183"></a>01183                       (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J).EQ.<span class="stringliteral">&#39;JCl        &#39;</span>)) IMOD1=3
<a name="l01184"></a>01184                   <span class="keyword">if</span> ((<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(2,J).EQ.<a class="code" href="namespaceglobal__variables.html#ac482cca882b0a18a0ff5036b6c1f28f6">YJH</a>).OR.&amp;
<a name="l01185"></a>01185                       (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(2,J).EQ.<span class="stringliteral">&#39;JHe        &#39;</span>).OR.&amp;
<a name="l01186"></a>01186                       (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(2,J).EQ.<span class="stringliteral">&#39;JC         &#39;</span>).OR.&amp;
<a name="l01187"></a>01187                       (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(2,J).EQ.<span class="stringliteral">&#39;JN         &#39;</span>).OR.&amp;
<a name="l01188"></a>01188                       (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(2,J).EQ.<span class="stringliteral">&#39;JO         &#39;</span>).OR.&amp;
<a name="l01189"></a>01189                       (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(2,J).EQ.<span class="stringliteral">&#39;JS         &#39;</span>).OR.&amp;
<a name="l01190"></a>01190                       (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(2,J).EQ.<span class="stringliteral">&#39;JSi        &#39;</span>).OR.&amp;
<a name="l01191"></a>01191                       (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(2,J).EQ.<span class="stringliteral">&#39;JFe        &#39;</span>).OR.&amp;
<a name="l01192"></a>01192                       (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(2,J).EQ.<span class="stringliteral">&#39;JNa        &#39;</span>).OR.&amp;
<a name="l01193"></a>01193                       (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(2,J).EQ.<span class="stringliteral">&#39;JMg        &#39;</span>).OR.&amp;
<a name="l01194"></a>01194                       (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(2,J).EQ.<span class="stringliteral">&#39;JP         &#39;</span>).OR.&amp;
<a name="l01195"></a>01195                       (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(2,J).EQ.<span class="stringliteral">&#39;JCl        &#39;</span>)) IMOD2=3
<a name="l01196"></a>01196                <span class="keyword">endif</span>
<a name="l01197"></a>01197 
<a name="l01198"></a>01198                   <span class="comment">! ------------ Modify rates (THERMAL_DIFFUSION_RATE_1 &amp; THERMAL_DIFFUSION_RATE_2) according to their own evap/acc rates</span>
<a name="l01199"></a>01199                   YMOD1=Y(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))
<a name="l01200"></a>01200                   YMOD2=Y(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J))
<a name="l01201"></a>01201                   call <a class="code" href="namespaceode__solver.html#ae6ef1750c55da0b1e6dea87e151074fc">modify_specific_rates_cr</a>(J,IMOD1,IMOD2,BARRCR,YMOD1,YMOD2)
<a name="l01202"></a>01202             <span class="keyword">endif</span>
<a name="l01203"></a>01203 
<a name="l01204"></a>01204             DIFFCR=<a class="code" href="namespaceglobal__variables.html#a007555b61f6e85c8b0d3b91011128ed3">CR_DIFFUSION_RATE_1</a>(J)+<a class="code" href="namespaceglobal__variables.html#ae614c99cbe0ea8f90e23711cb949f59a">CR_DIFFUSION_RATE_2</a>(J)
<a name="l01205"></a>01205 
<a name="l01206"></a>01206             <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J)=(<a class="code" href="namespaceglobal__variables.html#abcb701fe084819f14c57fb80f7c2b849">CR_IONISATION_RATE</a>/1.3D-17)*<a class="code" href="namespaceglobal__variables.html#a403f3bbb5987b974e2929ce8aa4b930b">CRFE</a>*<a class="code" href="namespaceglobal__variables.html#a54a6d7ffd8bd175bdd1a736d0f9c7653">PEAK_DURATION</a>*<a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)*<a class="code" href="namespaceglobal__variables.html#ad7d83bc1fcb7d6d1545cba39d875052a">branching_ratio</a>(J)* &amp;
<a name="l01207"></a>01207                                BARRCR*DIFFCR*<a class="code" href="namespaceglobal__variables.html#a9cfac828196dd36b6608931be24d610f">GTODN</a>/<a class="code" href="namespaceglobal__variables.html#ad8c6e0f43cbfebacfed34e1f1921ef92">H_number_density</a>
<a name="l01208"></a>01208 
<a name="l01209"></a>01209        <span class="keyword">enddo</span>
<a name="l01210"></a>01210     <span class="keyword">endif</span>
<a name="l01211"></a>01211 
<a name="l01212"></a>01212     <span class="comment">! ====== Rxn ITYPE 19 - 20</span>
<a name="l01213"></a>01213     <span class="comment">! ITYPE 19: Photodissociations by UV photons on grain surfaces</span>
<a name="l01214"></a>01214     <span class="comment">! ITYPE 20: Photodissociations by UV photons on grain surfaces</span>
<a name="l01215"></a>01215     <span class="keyword">do</span> J=<a class="code" href="namespaceglobal__variables.html#a72678d4a3e42c7707c53312a0bfd820a">type_id_start</a>(19),<a class="code" href="namespaceglobal__variables.html#a8e042ab32439646714871e722e3b8c18">type_id_stop</a>(20)
<a name="l01216"></a>01216       <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J)=<a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)*EXP(-<a class="code" href="namespaceglobal__variables.html#a6e0c0b9d7b2d7abb8cbc7e2a23f547f8">RATE_C</a>(J)*<a class="code" href="namespaceglobal__variables.html#a70719d43ec2f69b5c28c61897ab75aab">visual_extinction</a>)*<a class="code" href="namespaceglobal__variables.html#a22c25f3a7738bb754b2da9a33197668b">UV_FLUX</a>
<a name="l01217"></a>01217     <span class="keyword">enddo</span>
<a name="l01218"></a>01218 
<a name="l01219"></a>01219 <span class="comment">! ============================================================</span>
<a name="l01220"></a>01220 <span class="comment">! Photodesorption, when used appears through ITYPES 66 and 67</span>
<a name="l01221"></a>01221 <span class="comment">! ============================================================</span>
<a name="l01222"></a>01222 <span class="comment">! ========= Rxn ITYPE 66</span>
<a name="l01223"></a>01223 <span class="comment">! ITYPE 66: Photodesorption by external UV</span>
<a name="l01224"></a>01224 <span class="comment">! 1.d8 is I_ISRF-FUV from Oberg et al. 2007, ApJ, 662, 23</span>
<a name="l01225"></a>01225     <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a72678d4a3e42c7707c53312a0bfd820a">type_id_start</a>(66).NE.0) <span class="keyword">then</span>
<a name="l01226"></a>01226         <span class="keyword">do</span> J = <a class="code" href="namespaceglobal__variables.html#a72678d4a3e42c7707c53312a0bfd820a">type_id_start</a>(66),<a class="code" href="namespaceglobal__variables.html#a8e042ab32439646714871e722e3b8c18">type_id_stop</a>(66)
<a name="l01227"></a>01227 <span class="comment">!---- Used for all species</span>
<a name="l01228"></a>01228            <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J)=<a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)/<a class="code" href="namespaceglobal__variables.html#a933099f4d1ff4364609731cc121b2aff">SITE_DENSITY</a>*<a class="code" href="namespaceglobal__variables.html#a22c25f3a7738bb754b2da9a33197668b">UV_FLUX</a>*1.d8*EXP(-2.*<a class="code" href="namespaceglobal__variables.html#a70719d43ec2f69b5c28c61897ab75aab">visual_extinction</a>)
<a name="l01229"></a>01229 <span class="comment">!---- Specific cases</span>
<a name="l01230"></a>01230            call <a class="code" href="namespaceode__solver.html#aabbb1f1957404228d2cadb4414cab7d4">photodesorption_special_cases</a>(J,SUMLAY)
<a name="l01231"></a>01231 <span class="comment">!---- If there is more than MLAY on the grain surface, then we take into account that only</span>
<a name="l01232"></a>01232 <span class="comment">!     the upper layers can photodesorb: this is done by assigning a reducing factor to the rate coefficient</span>
<a name="l01233"></a>01233            <span class="keyword">if</span>(SUMLAY.GE.MLAY) <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J) = <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J) * MLAY / SUMLAY
<a name="l01234"></a>01234         <span class="keyword">enddo</span>
<a name="l01235"></a>01235     <span class="keyword">endif</span>
<a name="l01236"></a>01236 
<a name="l01237"></a>01237 <span class="comment">! ========= Rxn ITYPE 67</span>
<a name="l01238"></a>01238 <span class="comment">! ITYPE 67: Photodesorption by CR generated UV</span>
<a name="l01239"></a>01239     <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a72678d4a3e42c7707c53312a0bfd820a">type_id_start</a>(67).NE.0) <span class="keyword">then</span>
<a name="l01240"></a>01240         <span class="keyword">do</span> J = <a class="code" href="namespaceglobal__variables.html#a72678d4a3e42c7707c53312a0bfd820a">type_id_start</a>(67),<a class="code" href="namespaceglobal__variables.html#a8e042ab32439646714871e722e3b8c18">type_id_stop</a>(67)
<a name="l01241"></a>01241 <span class="comment">!---- Used for all species</span>
<a name="l01242"></a>01242            <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J)=<a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)/<a class="code" href="namespaceglobal__variables.html#a933099f4d1ff4364609731cc121b2aff">SITE_DENSITY</a>*1.d4*UVCR
<a name="l01243"></a>01243            call <a class="code" href="namespaceode__solver.html#aabbb1f1957404228d2cadb4414cab7d4">photodesorption_special_cases</a>(J,SUMLAY)
<a name="l01244"></a>01244 <span class="comment">!---- If there is more than MLAY on the grain surface, then we take into account that only</span>
<a name="l01245"></a>01245 <span class="comment">!     the upper layers can photodesorb: this is done by assigning a reducing factor to the rate coefficient</span>
<a name="l01246"></a>01246            <span class="keyword">if</span>(SUMLAY.GE.MLAY) <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J) = <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J) * MLAY / SUMLAY
<a name="l01247"></a>01247         <span class="keyword">enddo</span>
<a name="l01248"></a>01248     <span class="keyword">endif</span>
<a name="l01249"></a>01249 
<a name="l01250"></a>01250     <span class="comment">! Useful for testing</span>
<a name="l01251"></a>01251     <span class="comment">! To disable some reaction types</span>
<a name="l01252"></a>01252     <span class="comment">!do j=type_id_start(14),type_id_stop(15)</span>
<a name="l01253"></a>01253     <span class="comment">!reaction_rates(j)=0.</span>
<a name="l01254"></a>01254     <span class="comment">!enddo</span>
<a name="l01255"></a>01255 
<a name="l01256"></a>01256     <span class="comment">!do j=type_id_start(17),type_id_stop(20)</span>
<a name="l01257"></a>01257     <span class="comment">!reaction_rates(j)=0.</span>
<a name="l01258"></a>01258     <span class="comment">!enddo</span>
<a name="l01259"></a>01259   <span class="keyword">endif</span>
<a name="l01260"></a>01260 
<a name="l01261"></a>01261   <span class="comment">! Continually time-dependent gas phase rates============================</span>
<a name="l01262"></a>01262   <span class="comment">! H2 formation</span>
<a name="l01263"></a>01263   <span class="comment">! branching_ratio(1) and branching_ratio(2) are zero if IS_GRAIN_REACTIONS=1</span>
<a name="l01264"></a>01264   <span class="comment">! cf GRAINRATE</span>
<a name="l01265"></a>01265   <span class="comment">! VW Fev 2012 - this process has been removed</span>
<a name="l01266"></a>01266   <span class="comment">!      do j=type_id_start(0),type_id_stop(0)</span>
<a name="l01267"></a>01267   <span class="comment">!      if ((REACTION_SUBSTANCES_NAMES(1,J).eq.YH).and.(REACTION_SUBSTANCES_NAMES(2,j).eq.YH)) then</span>
<a name="l01268"></a>01268   <span class="comment">!      reaction_rates(j)=branching_ratio(j)*A(j)*(T300**B(j))*GTODN/H_number_density/Y(reagent_1_idx(j))</span>
<a name="l01269"></a>01269   <span class="comment">!      endif</span>
<a name="l01270"></a>01270   <span class="comment">!      enddo</span>
<a name="l01271"></a>01271 
<a name="l01272"></a>01272   <span class="comment">! if rate acoefficients are too small, put them to 0</span>
<a name="l01273"></a>01273   <span class="keyword">where</span> (<a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>.lt.<a class="code" href="namespaceglobal__variables.html#a6623b4104772161e3879f413cba30c77">MINIMUM_RATE_COEFFICIENT</a>) <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>=0.d0
<a name="l01274"></a>01274 
<a name="l01275"></a>01275     return
<a name="l01276"></a>01276 <span class="keyword">    end subroutine set_dependant_rates</span>
<a name="l01277"></a>01277     
<a name="l01278"></a>01278 <span class="comment">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<a name="l01289"></a><a class="code" href="namespaceode__solver.html#ab3252c79536b1c3506f8fd613dce0251">01289</a>   <span class="keyword">subroutine </span><a class="code" href="namespaceode__solver.html#ab3252c79536b1c3506f8fd613dce0251">modify_specific_rates</a>(J,IMOD1,IMOD2,BARR,YMOD1,YMOD2)
<a name="l01290"></a>01290   use <span class="keywordflow">global_variables</span>
<a name="l01291"></a>01291   
<a name="l01292"></a>01292   <span class="keyword">implicit none</span>
<a name="l01293"></a>01293 
<a name="l01294"></a>01294   <span class="comment">! Inputs</span>
<a name="l01295"></a>01295   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: J <span class="comment">!&lt;[in] index of a given reaction</span>
<a name="l01296"></a>01296   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: IMOD1
<a name="l01297"></a>01297   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: IMOD2
<a name="l01298"></a>01298   <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(in)</span> :: BARR
<a name="l01299"></a>01299   <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(in)</span> :: YMOD1
<a name="l01300"></a>01300   <span class="keywordtype">real(double_precision)</span>, <span class="keywordtype">intent(in)</span> :: YMOD2
<a name="l01301"></a>01301   
<a name="l01302"></a>01302   <span class="comment">! Locals</span>
<a name="l01303"></a>01303   <span class="keywordtype">real(double_precision)</span> :: TESTREF1, TESTREF2, TESTNUM
<a name="l01304"></a>01304   <span class="keywordtype">integer</span> :: PICK
<a name="l01305"></a>01305 
<a name="l01306"></a>01306   <a class="code" href="namespaceglobal__variables.html#a23d1c70100c545659c1d81a3c4d4babd">EVAP_OVER_ACC_RATIO_1</a>(J) = 0.d0
<a name="l01307"></a>01307   <a class="code" href="namespaceglobal__variables.html#ac818b0a2765bbe1157f53f20e167143a">EVAP_OVER_ACC_RATIO_2</a>(J) = 0.d0
<a name="l01308"></a>01308 
<a name="l01309"></a>01309   <span class="comment">! --- Check value of x = t_acc/t_evap</span>
<a name="l01310"></a>01310   <span class="comment">! EVAPORATION_RATES = 1/t_evap</span>
<a name="l01311"></a>01311   <span class="comment">! ACCRETION_RATES = 1/t_acc</span>
<a name="l01312"></a>01312   <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a8ef7180d64cb02178c1d82322a6ff6bf">ACCRETION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J)).GT.0.d0) <span class="keyword">then</span>
<a name="l01313"></a>01313     <a class="code" href="namespaceglobal__variables.html#a23d1c70100c545659c1d81a3c4d4babd">EVAP_OVER_ACC_RATIO_1</a>(J) = <a class="code" href="namespaceglobal__variables.html#ad51816e8243bdccecada423cb0f8e067">EVAPORATION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J)) / <a class="code" href="namespaceglobal__variables.html#a8ef7180d64cb02178c1d82322a6ff6bf">ACCRETION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))
<a name="l01314"></a>01314   <span class="keyword">endif</span>
<a name="l01315"></a>01315   <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a8ef7180d64cb02178c1d82322a6ff6bf">ACCRETION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J)).GT.0.d0) <span class="keyword">then</span>
<a name="l01316"></a>01316     <a class="code" href="namespaceglobal__variables.html#ac818b0a2765bbe1157f53f20e167143a">EVAP_OVER_ACC_RATIO_2</a>(J)=<a class="code" href="namespaceglobal__variables.html#ad51816e8243bdccecada423cb0f8e067">EVAPORATION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J))/<a class="code" href="namespaceglobal__variables.html#a8ef7180d64cb02178c1d82322a6ff6bf">ACCRETION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J))
<a name="l01317"></a>01317   <span class="keyword">endif</span>
<a name="l01318"></a>01318   <span class="comment">! Hence x = 0 if t_evap or t_acc = 0</span>
<a name="l01319"></a>01319 
<a name="l01320"></a>01320   <span class="comment">! --- Assign max rates</span>
<a name="l01321"></a>01321 
<a name="l01322"></a>01322   <span class="keyword">if</span> (BARR.EQ.1.0d0) <span class="keyword">then</span>
<a name="l01323"></a>01323     <span class="keyword">if</span> (IMOD1.NE.0) <span class="keyword">then</span>
<a name="l01324"></a>01324       <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a23d1c70100c545659c1d81a3c4d4babd">EVAP_OVER_ACC_RATIO_1</a>(J).LT.1.0d0) <span class="keyword">then</span> <span class="comment">! accretion dominates</span>
<a name="l01325"></a>01325         <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a017b2f55c589525ff03429dcb468d921">THERMAL_DIFFUSION_RATE_1</a>(J).GT.<a class="code" href="namespaceglobal__variables.html#a8ef7180d64cb02178c1d82322a6ff6bf">ACCRETION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))) <span class="keyword">then</span>
<a name="l01326"></a>01326           <a class="code" href="namespaceglobal__variables.html#a017b2f55c589525ff03429dcb468d921">THERMAL_DIFFUSION_RATE_1</a>(J) = <a class="code" href="namespaceglobal__variables.html#a8ef7180d64cb02178c1d82322a6ff6bf">ACCRETION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))
<a name="l01327"></a>01327         <span class="keyword">endif</span>
<a name="l01328"></a>01328       <span class="keyword">else</span> <span class="comment">! evaporation dominates</span>
<a name="l01329"></a>01329         <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a017b2f55c589525ff03429dcb468d921">THERMAL_DIFFUSION_RATE_1</a>(J).GT.<a class="code" href="namespaceglobal__variables.html#ad51816e8243bdccecada423cb0f8e067">EVAPORATION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))) <span class="keyword">then</span>
<a name="l01330"></a>01330           <a class="code" href="namespaceglobal__variables.html#a017b2f55c589525ff03429dcb468d921">THERMAL_DIFFUSION_RATE_1</a>(J) = <a class="code" href="namespaceglobal__variables.html#ad51816e8243bdccecada423cb0f8e067">EVAPORATION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))
<a name="l01331"></a>01331         <span class="keyword">endif</span>
<a name="l01332"></a>01332       <span class="keyword">endif</span>
<a name="l01333"></a>01333     <span class="keyword">endif</span>
<a name="l01334"></a>01334 
<a name="l01335"></a>01335     <span class="keyword">if</span> (IMOD2.NE.0) <span class="keyword">then</span>
<a name="l01336"></a>01336       <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#ac818b0a2765bbe1157f53f20e167143a">EVAP_OVER_ACC_RATIO_2</a>(J).LT.1.0d0) <span class="keyword">then</span> <span class="comment">! accretion dominates</span>
<a name="l01337"></a>01337         <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#ad0c7ad20fea426f50d7303242db3e88e">THERMAL_DIFFUSION_RATE_2</a>(J).GT.<a class="code" href="namespaceglobal__variables.html#a8ef7180d64cb02178c1d82322a6ff6bf">ACCRETION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J))) <span class="keyword">then</span>
<a name="l01338"></a>01338           <a class="code" href="namespaceglobal__variables.html#ad0c7ad20fea426f50d7303242db3e88e">THERMAL_DIFFUSION_RATE_2</a>(J) = <a class="code" href="namespaceglobal__variables.html#a8ef7180d64cb02178c1d82322a6ff6bf">ACCRETION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J))
<a name="l01339"></a>01339         <span class="keyword">endif</span>
<a name="l01340"></a>01340       <span class="keyword">else</span> <span class="comment">! evaporation dominates</span>
<a name="l01341"></a>01341         <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#ad0c7ad20fea426f50d7303242db3e88e">THERMAL_DIFFUSION_RATE_2</a>(J).GT.<a class="code" href="namespaceglobal__variables.html#ad51816e8243bdccecada423cb0f8e067">EVAPORATION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J))) <span class="keyword">then</span>
<a name="l01342"></a>01342           <a class="code" href="namespaceglobal__variables.html#ad0c7ad20fea426f50d7303242db3e88e">THERMAL_DIFFUSION_RATE_2</a>(J) = <a class="code" href="namespaceglobal__variables.html#ad51816e8243bdccecada423cb0f8e067">EVAPORATION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J))
<a name="l01343"></a>01343         <span class="keyword">endif</span>
<a name="l01344"></a>01344       <span class="keyword">endif</span>
<a name="l01345"></a>01345     <span class="keyword">endif</span>
<a name="l01346"></a>01346   <span class="keyword">endif</span>
<a name="l01347"></a>01347 
<a name="l01348"></a>01348   <span class="comment">! --- Species rate to compare chosen by fastest diffusion rate</span>
<a name="l01349"></a>01349   <span class="keyword">if</span> (BARR.NE.1.0d0) <span class="keyword">then</span>
<a name="l01350"></a>01350     PICK=0
<a name="l01351"></a>01351 
<a name="l01352"></a>01352     TESTREF1=<a class="code" href="namespaceglobal__variables.html#a8ef7180d64cb02178c1d82322a6ff6bf">ACCRETION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))
<a name="l01353"></a>01353     <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a23d1c70100c545659c1d81a3c4d4babd">EVAP_OVER_ACC_RATIO_1</a>(J).GE.1.0d0) TESTREF1=<a class="code" href="namespaceglobal__variables.html#ad51816e8243bdccecada423cb0f8e067">EVAPORATION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))
<a name="l01354"></a>01354     TESTREF2=<a class="code" href="namespaceglobal__variables.html#a8ef7180d64cb02178c1d82322a6ff6bf">ACCRETION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J))
<a name="l01355"></a>01355     <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#ac818b0a2765bbe1157f53f20e167143a">EVAP_OVER_ACC_RATIO_2</a>(J).GE.1.0d0) TESTREF2=<a class="code" href="namespaceglobal__variables.html#ad51816e8243bdccecada423cb0f8e067">EVAPORATION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J))
<a name="l01356"></a>01356 
<a name="l01357"></a>01357     <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a017b2f55c589525ff03429dcb468d921">THERMAL_DIFFUSION_RATE_1</a>(J).GE.<a class="code" href="namespaceglobal__variables.html#ad0c7ad20fea426f50d7303242db3e88e">THERMAL_DIFFUSION_RATE_2</a>(J)) <span class="keyword">then</span>
<a name="l01358"></a>01358       TESTNUM=(<a class="code" href="namespaceglobal__variables.html#a017b2f55c589525ff03429dcb468d921">THERMAL_DIFFUSION_RATE_1</a>(J)+<a class="code" href="namespaceglobal__variables.html#ad0c7ad20fea426f50d7303242db3e88e">THERMAL_DIFFUSION_RATE_2</a>(J))*BARR*YMOD2*<a class="code" href="namespaceglobal__variables.html#a9cfac828196dd36b6608931be24d610f">GTODN</a>
<a name="l01359"></a>01359       <span class="keyword">if</span> (YMOD2*<a class="code" href="namespaceglobal__variables.html#a9cfac828196dd36b6608931be24d610f">GTODN</a>.LT.1.0d0) TESTNUM=(<a class="code" href="namespaceglobal__variables.html#a017b2f55c589525ff03429dcb468d921">THERMAL_DIFFUSION_RATE_1</a>(J)+<a class="code" href="namespaceglobal__variables.html#ad0c7ad20fea426f50d7303242db3e88e">THERMAL_DIFFUSION_RATE_2</a>(J))*BARR
<a name="l01360"></a>01360       <span class="keyword">if</span> (TESTNUM.GT.TESTREF1) PICK=1
<a name="l01361"></a>01361     <span class="keyword">endif</span>
<a name="l01362"></a>01362     <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#ad0c7ad20fea426f50d7303242db3e88e">THERMAL_DIFFUSION_RATE_2</a>(J).GT.<a class="code" href="namespaceglobal__variables.html#a017b2f55c589525ff03429dcb468d921">THERMAL_DIFFUSION_RATE_1</a>(J)) <span class="keyword">then</span>
<a name="l01363"></a>01363       TESTNUM=(<a class="code" href="namespaceglobal__variables.html#a017b2f55c589525ff03429dcb468d921">THERMAL_DIFFUSION_RATE_1</a>(J)+<a class="code" href="namespaceglobal__variables.html#ad0c7ad20fea426f50d7303242db3e88e">THERMAL_DIFFUSION_RATE_2</a>(J))*BARR*YMOD1*<a class="code" href="namespaceglobal__variables.html#a9cfac828196dd36b6608931be24d610f">GTODN</a>
<a name="l01364"></a>01364       <span class="keyword">if</span> (YMOD1*<a class="code" href="namespaceglobal__variables.html#a9cfac828196dd36b6608931be24d610f">GTODN</a>.LT.1.0d0) TESTNUM=(<a class="code" href="namespaceglobal__variables.html#a017b2f55c589525ff03429dcb468d921">THERMAL_DIFFUSION_RATE_1</a>(J)+<a class="code" href="namespaceglobal__variables.html#ad0c7ad20fea426f50d7303242db3e88e">THERMAL_DIFFUSION_RATE_2</a>(J))*BARR
<a name="l01365"></a>01365       <span class="keyword">if</span> (TESTNUM.GT.TESTREF2) PICK=2
<a name="l01366"></a>01366     <span class="keyword">endif</span>
<a name="l01367"></a>01367 
<a name="l01368"></a>01368     <span class="keyword">if</span> (PICK.EQ.1) <span class="keyword">then</span>
<a name="l01369"></a>01369       <a class="code" href="namespaceglobal__variables.html#a017b2f55c589525ff03429dcb468d921">THERMAL_DIFFUSION_RATE_1</a>(J)=TESTREF1/BARR/YMOD2/<a class="code" href="namespaceglobal__variables.html#a9cfac828196dd36b6608931be24d610f">GTODN</a>
<a name="l01370"></a>01370       <span class="keyword">if</span> (YMOD2*<a class="code" href="namespaceglobal__variables.html#a9cfac828196dd36b6608931be24d610f">GTODN</a>.LT.1.0d0) <a class="code" href="namespaceglobal__variables.html#a017b2f55c589525ff03429dcb468d921">THERMAL_DIFFUSION_RATE_1</a>(J)=TESTREF1/BARR
<a name="l01371"></a>01371       <a class="code" href="namespaceglobal__variables.html#ad0c7ad20fea426f50d7303242db3e88e">THERMAL_DIFFUSION_RATE_2</a>(J)=0.d0
<a name="l01372"></a>01372     <span class="keyword">endif</span>
<a name="l01373"></a>01373 
<a name="l01374"></a>01374     <span class="keyword">if</span> (PICK.EQ.2) <span class="keyword">then</span>
<a name="l01375"></a>01375       <a class="code" href="namespaceglobal__variables.html#ad0c7ad20fea426f50d7303242db3e88e">THERMAL_DIFFUSION_RATE_2</a>(J)=TESTREF2/BARR/YMOD1/<a class="code" href="namespaceglobal__variables.html#a9cfac828196dd36b6608931be24d610f">GTODN</a>
<a name="l01376"></a>01376       <span class="keyword">if</span> (YMOD1*<a class="code" href="namespaceglobal__variables.html#a9cfac828196dd36b6608931be24d610f">GTODN</a>.LT.1.0d0) <a class="code" href="namespaceglobal__variables.html#ad0c7ad20fea426f50d7303242db3e88e">THERMAL_DIFFUSION_RATE_2</a>(J)=TESTREF2/BARR
<a name="l01377"></a>01377       <a class="code" href="namespaceglobal__variables.html#a017b2f55c589525ff03429dcb468d921">THERMAL_DIFFUSION_RATE_1</a>(J)=0.d0
<a name="l01378"></a>01378     <span class="keyword">endif</span>
<a name="l01379"></a>01379 
<a name="l01380"></a>01380   <span class="keyword">endif</span>
<a name="l01381"></a>01381 
<a name="l01382"></a>01382   return
<a name="l01383"></a>01383 <span class="keyword">  end subroutine modify_specific_rates</span>
<a name="l01384"></a>01384 
<a name="l01385"></a>01385 <span class="comment">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<a name="l01396"></a><a class="code" href="namespaceode__solver.html#ae6ef1750c55da0b1e6dea87e151074fc">01396</a>   <span class="keyword">subroutine </span><a class="code" href="namespaceode__solver.html#ae6ef1750c55da0b1e6dea87e151074fc">modify_specific_rates_cr</a>(J,IMOD1,IMOD2,BARRCR,YMOD1,YMOD2)
<a name="l01397"></a>01397 
<a name="l01398"></a>01398   use <span class="keywordflow">global_variables</span>
<a name="l01399"></a>01399 
<a name="l01400"></a>01400   <span class="keyword">implicit none</span>
<a name="l01401"></a>01401 
<a name="l01402"></a>01402   <span class="keywordtype">integer</span> :: J,IMOD1,IMOD2, PICK
<a name="l01403"></a>01403   <span class="keywordtype">real(double_precision)</span> :: BARRCR,YMOD1,YMOD2, TESTREF1, TESTREF2, TESTNUM
<a name="l01404"></a>01404 
<a name="l01405"></a>01405   <a class="code" href="namespaceglobal__variables.html#a23d1c70100c545659c1d81a3c4d4babd">EVAP_OVER_ACC_RATIO_1</a>(J)=0.0d0
<a name="l01406"></a>01406   <a class="code" href="namespaceglobal__variables.html#ac818b0a2765bbe1157f53f20e167143a">EVAP_OVER_ACC_RATIO_2</a>(J)=0.0d0
<a name="l01407"></a>01407 
<a name="l01408"></a>01408   <span class="comment">! --- Check value of x = t_acc/t_evap</span>
<a name="l01409"></a>01409   <span class="comment">! EVAPORATION_RATES = 1/t_evap</span>
<a name="l01410"></a>01410   <span class="comment">! ACCRETION_RATES = 1/t_acc</span>
<a name="l01411"></a>01411   <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a8ef7180d64cb02178c1d82322a6ff6bf">ACCRETION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J)).GT.0.0d0) <span class="keyword">then</span>
<a name="l01412"></a>01412      <a class="code" href="namespaceglobal__variables.html#a23d1c70100c545659c1d81a3c4d4babd">EVAP_OVER_ACC_RATIO_1</a>(J) = <a class="code" href="namespaceglobal__variables.html#a621bd19199d43b32968f92bd60fda8af">EVAPORATION_RATESCR</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J)) / <a class="code" href="namespaceglobal__variables.html#a8ef7180d64cb02178c1d82322a6ff6bf">ACCRETION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))
<a name="l01413"></a>01413   <span class="keyword">endif</span>
<a name="l01414"></a>01414   <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a8ef7180d64cb02178c1d82322a6ff6bf">ACCRETION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J)).GT.0.0d0) <span class="keyword">then</span>
<a name="l01415"></a>01415      <a class="code" href="namespaceglobal__variables.html#ac818b0a2765bbe1157f53f20e167143a">EVAP_OVER_ACC_RATIO_2</a>(J)=<a class="code" href="namespaceglobal__variables.html#a621bd19199d43b32968f92bd60fda8af">EVAPORATION_RATESCR</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J))/<a class="code" href="namespaceglobal__variables.html#a8ef7180d64cb02178c1d82322a6ff6bf">ACCRETION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J))
<a name="l01416"></a>01416   <span class="keyword">endif</span>
<a name="l01417"></a>01417   <span class="comment">! Hence x = 0 if t_evap or t_acc = 0</span>
<a name="l01418"></a>01418 
<a name="l01419"></a>01419   <span class="comment">! --- Assign max rates</span>
<a name="l01420"></a>01420 
<a name="l01421"></a>01421   <span class="keyword">if</span> (BARRCR.EQ.1.0d0) <span class="keyword">then</span>
<a name="l01422"></a>01422      <span class="keyword">if</span> (IMOD1.NE.0) <span class="keyword">then</span>
<a name="l01423"></a>01423         <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a23d1c70100c545659c1d81a3c4d4babd">EVAP_OVER_ACC_RATIO_1</a>(J).LT.1.0d0) <span class="keyword">then</span> <span class="comment">! accretion dominates</span>
<a name="l01424"></a>01424           <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a007555b61f6e85c8b0d3b91011128ed3">CR_DIFFUSION_RATE_1</a>(J).GT.<a class="code" href="namespaceglobal__variables.html#a8ef7180d64cb02178c1d82322a6ff6bf">ACCRETION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))) <span class="keyword">then</span>
<a name="l01425"></a>01425             <a class="code" href="namespaceglobal__variables.html#a007555b61f6e85c8b0d3b91011128ed3">CR_DIFFUSION_RATE_1</a>(J) = <a class="code" href="namespaceglobal__variables.html#a8ef7180d64cb02178c1d82322a6ff6bf">ACCRETION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))
<a name="l01426"></a>01426           <span class="keyword">endif</span>
<a name="l01427"></a>01427         <span class="keyword">else</span> <span class="comment">! evaporation dominates</span>
<a name="l01428"></a>01428           <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a007555b61f6e85c8b0d3b91011128ed3">CR_DIFFUSION_RATE_1</a>(J).GT.<a class="code" href="namespaceglobal__variables.html#a621bd19199d43b32968f92bd60fda8af">EVAPORATION_RATESCR</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))) <span class="keyword">then</span>
<a name="l01429"></a>01429             <a class="code" href="namespaceglobal__variables.html#a007555b61f6e85c8b0d3b91011128ed3">CR_DIFFUSION_RATE_1</a>(J) = <a class="code" href="namespaceglobal__variables.html#a621bd19199d43b32968f92bd60fda8af">EVAPORATION_RATESCR</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))
<a name="l01430"></a>01430           <span class="keyword">endif</span>
<a name="l01431"></a>01431         <span class="keyword">endif</span>
<a name="l01432"></a>01432      <span class="keyword">endif</span>
<a name="l01433"></a>01433 
<a name="l01434"></a>01434      <span class="keyword">if</span> (IMOD2.NE.0) <span class="keyword">then</span>
<a name="l01435"></a>01435         <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#ac818b0a2765bbe1157f53f20e167143a">EVAP_OVER_ACC_RATIO_2</a>(J).LT.1.0d0) <span class="keyword">then</span> <span class="comment">! accretion dominates</span>
<a name="l01436"></a>01436           <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#ae614c99cbe0ea8f90e23711cb949f59a">CR_DIFFUSION_RATE_2</a>(J).GT.<a class="code" href="namespaceglobal__variables.html#a8ef7180d64cb02178c1d82322a6ff6bf">ACCRETION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J))) <span class="keyword">then</span>
<a name="l01437"></a>01437             <a class="code" href="namespaceglobal__variables.html#ae614c99cbe0ea8f90e23711cb949f59a">CR_DIFFUSION_RATE_2</a>(J) = <a class="code" href="namespaceglobal__variables.html#a8ef7180d64cb02178c1d82322a6ff6bf">ACCRETION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J))
<a name="l01438"></a>01438           <span class="keyword">endif</span>
<a name="l01439"></a>01439         <span class="keyword">else</span> <span class="comment">! evaporation dominates</span>
<a name="l01440"></a>01440           <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#ae614c99cbe0ea8f90e23711cb949f59a">CR_DIFFUSION_RATE_2</a>(J).GT.<a class="code" href="namespaceglobal__variables.html#a621bd19199d43b32968f92bd60fda8af">EVAPORATION_RATESCR</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J))) <span class="keyword">then</span>
<a name="l01441"></a>01441             <a class="code" href="namespaceglobal__variables.html#ae614c99cbe0ea8f90e23711cb949f59a">CR_DIFFUSION_RATE_2</a>(J) = <a class="code" href="namespaceglobal__variables.html#a621bd19199d43b32968f92bd60fda8af">EVAPORATION_RATESCR</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J))
<a name="l01442"></a>01442           <span class="keyword">endif</span>
<a name="l01443"></a>01443         <span class="keyword">endif</span>
<a name="l01444"></a>01444      <span class="keyword">endif</span>
<a name="l01445"></a>01445   <span class="keyword">endif</span>
<a name="l01446"></a>01446 
<a name="l01447"></a>01447   <span class="comment">! --- Species rate to compare chosen by fastest diffusion rate</span>
<a name="l01448"></a>01448   <span class="keyword">if</span> (BARRCR.NE.1.0d0) <span class="keyword">then</span>
<a name="l01449"></a>01449      PICK=0
<a name="l01450"></a>01450 
<a name="l01451"></a>01451      TESTREF1=<a class="code" href="namespaceglobal__variables.html#a8ef7180d64cb02178c1d82322a6ff6bf">ACCRETION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))
<a name="l01452"></a>01452      <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a23d1c70100c545659c1d81a3c4d4babd">EVAP_OVER_ACC_RATIO_1</a>(J).GE.1.0d0) TESTREF1=<a class="code" href="namespaceglobal__variables.html#a621bd19199d43b32968f92bd60fda8af">EVAPORATION_RATESCR</a>(<a class="code" href="namespaceglobal__variables.html#a7cc721e2ee8b247ad605a946fcfcbad5">reagent_1_idx</a>(J))
<a name="l01453"></a>01453      TESTREF2=<a class="code" href="namespaceglobal__variables.html#a8ef7180d64cb02178c1d82322a6ff6bf">ACCRETION_RATES</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J))
<a name="l01454"></a>01454      <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#ac818b0a2765bbe1157f53f20e167143a">EVAP_OVER_ACC_RATIO_2</a>(J).GE.1.0d0) TESTREF2=<a class="code" href="namespaceglobal__variables.html#a621bd19199d43b32968f92bd60fda8af">EVAPORATION_RATESCR</a>(<a class="code" href="namespaceglobal__variables.html#adecd2291a9eef60df015d209ac481b10">reagent_2_idx</a>(J))
<a name="l01455"></a>01455 
<a name="l01456"></a>01456      <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a007555b61f6e85c8b0d3b91011128ed3">CR_DIFFUSION_RATE_1</a>(J).GE.<a class="code" href="namespaceglobal__variables.html#ae614c99cbe0ea8f90e23711cb949f59a">CR_DIFFUSION_RATE_2</a>(J)) <span class="keyword">then</span>
<a name="l01457"></a>01457         TESTNUM=(<a class="code" href="namespaceglobal__variables.html#a007555b61f6e85c8b0d3b91011128ed3">CR_DIFFUSION_RATE_1</a>(J)+<a class="code" href="namespaceglobal__variables.html#ae614c99cbe0ea8f90e23711cb949f59a">CR_DIFFUSION_RATE_2</a>(J))*BARRCR*YMOD2*<a class="code" href="namespaceglobal__variables.html#a9cfac828196dd36b6608931be24d610f">GTODN</a>
<a name="l01458"></a>01458         <span class="keyword">if</span> (YMOD2*<a class="code" href="namespaceglobal__variables.html#a9cfac828196dd36b6608931be24d610f">GTODN</a>.LT.1.0d0) TESTNUM=(<a class="code" href="namespaceglobal__variables.html#a007555b61f6e85c8b0d3b91011128ed3">CR_DIFFUSION_RATE_1</a>(J)+<a class="code" href="namespaceglobal__variables.html#ae614c99cbe0ea8f90e23711cb949f59a">CR_DIFFUSION_RATE_2</a>(J))*BARRCR
<a name="l01459"></a>01459         <span class="keyword">if</span> (TESTNUM.GT.TESTREF1) PICK = 1
<a name="l01460"></a>01460      <span class="keyword">endif</span>
<a name="l01461"></a>01461      <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#ae614c99cbe0ea8f90e23711cb949f59a">CR_DIFFUSION_RATE_2</a>(J).GT.<a class="code" href="namespaceglobal__variables.html#a007555b61f6e85c8b0d3b91011128ed3">CR_DIFFUSION_RATE_1</a>(J)) <span class="keyword">then</span>
<a name="l01462"></a>01462         TESTNUM=(<a class="code" href="namespaceglobal__variables.html#a007555b61f6e85c8b0d3b91011128ed3">CR_DIFFUSION_RATE_1</a>(J)+<a class="code" href="namespaceglobal__variables.html#ae614c99cbe0ea8f90e23711cb949f59a">CR_DIFFUSION_RATE_2</a>(J))*BARRCR*YMOD1*<a class="code" href="namespaceglobal__variables.html#a9cfac828196dd36b6608931be24d610f">GTODN</a>
<a name="l01463"></a>01463         <span class="keyword">if</span> (YMOD1*<a class="code" href="namespaceglobal__variables.html#a9cfac828196dd36b6608931be24d610f">GTODN</a>.LT.1.0d0) TESTNUM=(<a class="code" href="namespaceglobal__variables.html#a007555b61f6e85c8b0d3b91011128ed3">CR_DIFFUSION_RATE_1</a>(J)+<a class="code" href="namespaceglobal__variables.html#ae614c99cbe0ea8f90e23711cb949f59a">CR_DIFFUSION_RATE_2</a>(J))*BARRCR
<a name="l01464"></a>01464         <span class="keyword">if</span> (TESTNUM.GT.TESTREF2) PICK = 2
<a name="l01465"></a>01465      <span class="keyword">endif</span>
<a name="l01466"></a>01466 
<a name="l01467"></a>01467      <span class="keyword">if</span> (PICK.EQ.1) <span class="keyword">then</span>
<a name="l01468"></a>01468         <a class="code" href="namespaceglobal__variables.html#a007555b61f6e85c8b0d3b91011128ed3">CR_DIFFUSION_RATE_1</a>(J)=TESTREF1/BARRCR/YMOD2/<a class="code" href="namespaceglobal__variables.html#a9cfac828196dd36b6608931be24d610f">GTODN</a>
<a name="l01469"></a>01469         <span class="keyword">if</span> (YMOD2*<a class="code" href="namespaceglobal__variables.html#a9cfac828196dd36b6608931be24d610f">GTODN</a>.LT.1.0d0) <a class="code" href="namespaceglobal__variables.html#a007555b61f6e85c8b0d3b91011128ed3">CR_DIFFUSION_RATE_1</a>(J)=TESTREF1/BARRCR
<a name="l01470"></a>01470         <a class="code" href="namespaceglobal__variables.html#ae614c99cbe0ea8f90e23711cb949f59a">CR_DIFFUSION_RATE_2</a>(J) = 0.0d0
<a name="l01471"></a>01471      <span class="keyword">endif</span>
<a name="l01472"></a>01472 
<a name="l01473"></a>01473      <span class="keyword">if</span> (PICK.EQ.2) <span class="keyword">then</span>
<a name="l01474"></a>01474         <a class="code" href="namespaceglobal__variables.html#ae614c99cbe0ea8f90e23711cb949f59a">CR_DIFFUSION_RATE_2</a>(J)=TESTREF2/BARRCR/YMOD1/<a class="code" href="namespaceglobal__variables.html#a9cfac828196dd36b6608931be24d610f">GTODN</a>
<a name="l01475"></a>01475         <span class="keyword">if</span> (YMOD1*<a class="code" href="namespaceglobal__variables.html#a9cfac828196dd36b6608931be24d610f">GTODN</a>.LT.1.0d0) <a class="code" href="namespaceglobal__variables.html#ae614c99cbe0ea8f90e23711cb949f59a">CR_DIFFUSION_RATE_2</a>(J)=TESTREF2/BARRCR
<a name="l01476"></a>01476         <a class="code" href="namespaceglobal__variables.html#a007555b61f6e85c8b0d3b91011128ed3">CR_DIFFUSION_RATE_1</a>(J) = 0.0d0
<a name="l01477"></a>01477      <span class="keyword">endif</span>
<a name="l01478"></a>01478 
<a name="l01479"></a>01479   <span class="keyword">endif</span>
<a name="l01480"></a>01480 
<a name="l01481"></a>01481 RETURN
<a name="l01482"></a>01482 <span class="keyword">end subroutine modify_specific_rates_cr</span>
<a name="l01483"></a>01483 
<a name="l01484"></a>01484 <span class="comment">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<a name="l01498"></a><a class="code" href="namespaceode__solver.html#aabbb1f1957404228d2cadb4414cab7d4">01498</a> <span class="keyword">subroutine </span><a class="code" href="namespaceode__solver.html#aabbb1f1957404228d2cadb4414cab7d4">photodesorption_special_cases</a>(J,SUMLAY)
<a name="l01499"></a>01499 
<a name="l01500"></a>01500 use <span class="keywordflow">global_variables</span>
<a name="l01501"></a>01501 
<a name="l01502"></a>01502 <span class="keyword">implicit none</span>
<a name="l01503"></a>01503 
<a name="l01504"></a>01504 <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: J <span class="comment">!&lt;[in] index of a given reaction</span>
<a name="l01505"></a>01505 <span class="keywordtype">REAL(double_precision)</span>, <span class="keywordtype">INTENT(IN)</span> :: SUMLAY
<a name="l01506"></a>01506 <span class="keywordtype">REAL(double_precision)</span> :: LTD
<a name="l01507"></a>01507 <span class="keywordtype">REAL(double_precision)</span> :: fH2O
<a name="l01508"></a>01508 
<a name="l01509"></a>01509 <span class="comment">!------ Photodesorption of CO2: photodesorbs as either CO2 or CO</span>
<a name="l01510"></a>01510 <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#ab165b9b5b824a85985f8b99f82e1ae67">dust_temperature</a>.LE.3.5E+01) <span class="keyword">then</span>
<a name="l01511"></a>01511     <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(4,J) == <span class="stringliteral">&#39;CO2        &#39;</span>) <span class="keyword">then</span>
<a name="l01512"></a>01512         <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J) = <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J) * 1.2E-03 * (1.d0 - EXP(-SUMLAY/2.9E+00) ) / <a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)
<a name="l01513"></a>01513     <span class="keyword">endif</span>
<a name="l01514"></a>01514     <span class="keyword">if</span>((<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(4,J) == <span class="stringliteral">&#39;CO         &#39;</span> .AND. <a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(5,J) == <span class="stringliteral">&#39;O          &#39;</span>) .OR. &amp;
<a name="l01515"></a>01515        (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(4,J) == <span class="stringliteral">&#39;O          &#39;</span> .AND. <a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(5,J) == <span class="stringliteral">&#39;CO         &#39;</span>)) <span class="keyword">then</span>
<a name="l01516"></a>01516         <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J) = <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J) * 1.1E-03 * (1.d0 - EXP(-SUMLAY/4.6E+00) ) / <a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)
<a name="l01517"></a>01517     <span class="keyword">endif</span>
<a name="l01518"></a>01518 elseif(<a class="code" href="namespaceglobal__variables.html#ab165b9b5b824a85985f8b99f82e1ae67">dust_temperature</a>.GT.3.5E+01) <span class="keyword">then</span>
<a name="l01519"></a>01519     <span class="keyword">if</span> (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(4,J) == <span class="stringliteral">&#39;CO2        &#39;</span>) <span class="keyword">then</span>
<a name="l01520"></a>01520         <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J) = <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J) * 2.2E-03 * (1.d0 - EXP(-SUMLAY/5.8E+00) ) / <a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)
<a name="l01521"></a>01521     <span class="keyword">endif</span>
<a name="l01522"></a>01522     <span class="keyword">if</span>((<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(4,J) == <span class="stringliteral">&#39;CO         &#39;</span> .AND. <a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(5,J) == <span class="stringliteral">&#39;O          &#39;</span>) .OR. &amp;
<a name="l01523"></a>01523        (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(4,J) == <span class="stringliteral">&#39;O          &#39;</span> .AND. <a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(5,J) == <span class="stringliteral">&#39;CO         &#39;</span>)) <span class="keyword">then</span>
<a name="l01524"></a>01524        <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J) = <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J) * 2.2E-04 * SUMLAY / <a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)
<a name="l01525"></a>01525     <span class="keyword">endif</span>
<a name="l01526"></a>01526 <span class="keyword">endif</span>
<a name="l01527"></a>01527 <span class="comment">!------ Photodesorption of CO</span>
<a name="l01528"></a>01528 <span class="keyword">if</span>(<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J) == <span class="stringliteral">&#39;JCO        &#39;</span> .AND. <a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(4,J) == <span class="stringliteral">&#39;CO         &#39;</span>) <span class="keyword">then</span>
<a name="l01529"></a>01529    <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J) = <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J) * ( 2.7E-03 - 1.7E-04 * (<a class="code" href="namespaceglobal__variables.html#ab165b9b5b824a85985f8b99f82e1ae67">dust_temperature</a> - 15E+00)) / <a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)
<a name="l01530"></a>01530 <span class="keyword">endif</span>
<a name="l01531"></a>01531 <span class="comment">!------ Photodesorption of N2</span>
<a name="l01532"></a>01532 <span class="keyword">if</span>(<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J) == <span class="stringliteral">&#39;JN2        &#39;</span> .AND. <a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(4,J) == <span class="stringliteral">&#39;N2         &#39;</span>) <span class="keyword">then</span>
<a name="l01533"></a>01533    <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J) = <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J) * 4.0E-04 / <a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)
<a name="l01534"></a>01534 <span class="keyword">endif</span>
<a name="l01535"></a>01535 <span class="comment">!------ Photodesorption of CH3OH</span>
<a name="l01536"></a>01536 <span class="keyword">if</span>(<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J) == <span class="stringliteral">&#39;JCH3OH     &#39;</span> .AND. <a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(4,J) == <span class="stringliteral">&#39;CH3OH      &#39;</span>) <span class="keyword">then</span>
<a name="l01537"></a>01537    <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J) = <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J) * 2.1E-03 / <a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)
<a name="l01538"></a>01538 <span class="keyword">endif</span>
<a name="l01539"></a>01539 <span class="comment">!------ Photodesorption of H2O</span>
<a name="l01540"></a>01540 <span class="keyword">if</span>(<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(1,J) == <span class="stringliteral">&#39;JH2O       &#39;</span>) <span class="keyword">then</span>
<a name="l01541"></a>01541    LTD = 6.0E-01 + 2.4E-02 * <a class="code" href="namespaceglobal__variables.html#ab165b9b5b824a85985f8b99f82e1ae67">dust_temperature</a>
<a name="l01542"></a>01542    fH2O = 4.2E-01 + 2.0E-03 * <a class="code" href="namespaceglobal__variables.html#ab165b9b5b824a85985f8b99f82e1ae67">dust_temperature</a>
<a name="l01543"></a>01543    <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J) = <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J) * 1.0E-03 * (1.3E+00 + 3.2E-02*<a class="code" href="namespaceglobal__variables.html#ab165b9b5b824a85985f8b99f82e1ae67">dust_temperature</a>) &amp;
<a name="l01544"></a>01544            &amp; * (1.d0 - EXP(-SUMLAY/LTD) ) * fH2O / <a class="code" href="namespaceglobal__variables.html#a3f4130ced3d35c33206a483412cb7410">RATE_A</a>(J)
<a name="l01545"></a>01545    <span class="keyword">if</span>((<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(4,J) == <span class="stringliteral">&#39;OH         &#39;</span> .AND. <a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(5,J) == <span class="stringliteral">&#39;H          &#39;</span>) .OR. &amp;
<a name="l01546"></a>01546       (<a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(4,J) == <span class="stringliteral">&#39;H          &#39;</span> .AND. <a class="code" href="namespaceglobal__variables.html#a90b37647e2ee578bfb44d897576125a3">REACTION_SUBSTANCES_NAMES</a>(5,J) == <span class="stringliteral">&#39;OH         &#39;</span>)) <span class="keyword">then</span>
<a name="l01547"></a>01547       <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J) = <a class="code" href="namespaceglobal__variables.html#aae6fa36dba38d4d8a3ee5c284327614d">reaction_rates</a>(J) * (1.0E+00 - fH2O)/fH2O
<a name="l01548"></a>01548    <span class="keyword">endif</span>
<a name="l01549"></a>01549 <span class="keyword">endif</span>
<a name="l01550"></a>01550 
<a name="l01551"></a>01551 <span class="keyword">end subroutine photodesorption_special_cases</span>
<a name="l01552"></a>01552 
<a name="l01553"></a>01553 <span class="comment">! ======================================================================</span>
<a name="l01554"></a>01554 
<a name="l01555"></a>01555 <span class="keyword">end module ode_solver</span>
</pre></div></div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Wed May 28 2014 for <a href= http://code.google.com/p/nautilus/>Nautilus</a> by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
